{"doc_key": "030", "sentences": [["During", "the", "BlackMatter", "attack", ",", "it", "was", "discovered", "that", "the", "attacker", "gained", "initial", "access", "by", "potentially", "exploiting", "vulnerabilities", "in", "Microsoft", "Exchange", "."], ["Once", "they", "obtained", "access", ",", "the", "attackers", "made", "sure", "to", "have", "additional", "remote", "access", "to", "various", "internal", "systems", "beyond", "the", "first", "point", "of", "entry", "."], ["In", "a", "different", "incident", "involving", "the", "BlackCat", "attack", ",", "the", "actors", "utilized", "reverse-ssh", "as", "their", "tool", "of", "choice", "."], ["They", "compiled", "it", "with", "the", "C2", "server", "address", "embedded", "and", "used", "it", "to", "establish", "reverse", "SSH", "tunnels", ",", "providing", "the", "attacker", "with", "reverse", "shells", "."], ["The", "tool", "was", "deployed", "to", "the", "C", ":", "\\", "directory", "and", "named", "``", "system", "''", ",", "``", "Windows", "''", ",", "or", "``", "cache", "task", "''", "."], ["Additionally", ",", "to", "conceal", "it", "from", "detection", ",", "the", "attackers", "hid", "it", "by", "writing", "to", "an", "alternate", "data", "stream", "(", "ADS", ")", "of", "the", "C", ":", "\\", "directory", "using", "the", "following", "command", ":"], ["c", ":", "\\windows\\system32\\schtasks.exe", "/run", "/tn", "microsoft\\windows\\wininet\\cachetask"], ["In", "order", "to", "ensure", "that", "the", "malicious", "file", "would", "continue", "to", "execute", "on", "a", "system", ",", "attackers", "used", "the", "``", "image", "file", "execution", "option", "''", "debugger", "registry", "key", "."], ["They", "added", "this", "key", "to", "the", "system", "'s", "registry", "using", "a", "specific", "command", "to", "achieve", "their", "goal", "."], ["This", "command", "is", "as", "follows", ":"], ["c", ":", "\\windows\\system32\\reg.exe", "add", "hklm\\software\\microsoft\\windows", "nt\\currentversion\\image", "file", "execution", "options\\taskmgr.exe", "/v", "debugger", "/t", "reg_sz", "/d", "c", ":", "\\system"], ["During", "the", "BlackMatter", "attack", ",", "the", "\u200bgroup", "employed", "a", "different", "tool", "called", "GO", "Simple", "Tunnel", "(", "GOST", ")", "but", "utilized", "a", "similar", "technique", "."], ["GOST", "is", "a", "tunneling", "tool", "based", "on", "Go", "language", "that", "was", "utilized", "to", "create", "a", "reverse", "SSH", "tunnel", "to", "an", "attacker-controlled", "C2", "server", "."], ["The", "name", "of", "the", "Gost", "file", "deployed", "was", "``", "system.exe", "''", ",", "which", "is", "comparable", "to", "the", "file", "name", "utilized", "during", "the", "BlackCat", "attack", "for", "reverse-ssh", "."], ["Attackers", "disabled", "logs", "for", "the", "task", "scheduler", "before", "setting", "up", "the", "reverse-ssh", "scheduled", "task", "tool", ",", "as", "detailed", "in", "the", "IOC", "section", "below", "."], ["Finally", ",", "they", "loaded", "the", "anti-rootkit", "tool", "Gmer", "into", "select", "systems", "with", "the", "following", "command", ":"], ["c", ":", "\\users", "<", "username", ">", "\\downloads\\gmer\\gmer.exe"], ["To", "collect", "local", "and", "domain", "user", "credentials", "on", "select", "key", "systems", ",", "the", "LSASS", "process", "memory", "was", "dumped", "and", "credentials", "were", "extracted", "using", "Microsoft", "Sysinternals", "Procdump", "and", "Dumpert", "tools", "."], ["The", "following", "commands", "were", "used", "for", "this", "purpose", ":"], ["c", ":", "\\windows\\system\\procdump.exe", "-accepteula", "-ma", "lsass.exe", "lsass.dmp"], ["c", ":", "\\windows\\system\\dumpert.exe", "lsass.exe"], ["During", "the", "BlackMatter", "attack", ",", "attackers", "directly", "employed", "comsvcs.dll", "to", "dump", "LSASS", "memory", "with", "the", "help", "of", "the", "following", "PowerShell", "command", ":"], ["powershell", "rundll32.exe", "c", ":", "\\windows\\system32\\comsvcs.dll", ",", "minidump", "(", "get-process", "lsass", ")", ".id", "c", ":", "\\temp\\lsass.dmp", "full"], ["In", "addition", "to", "Windows", "login", "credentials", ",", "during", "the", "BlackCat", "attack", ",", "a", "tool", "named", "``", "steal.exe", "''", "was", "utilized", "to", "gather", "additional", "data", "."], ["Furthermore", ",", "information", "was", "collected", "from", "Active", "Directory", "and", "its", "key", "servers", "using", "ADRecon", "via", "the", "following", "PowerShell", "command", ":"], ["c", ":", "\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe", "-exec", "bypass", ".\\adrecon.ps1"], ["During", "the", "BlackMatter", "attack", ",", "the", "attackers", "tried", "to", "find", "additional", "ways", "to", "maintain", "their", "access", "."], ["They", "explored", "an", "existing", "TeamViewer", "installation", "and", "also", "examined", "the", "keepass", "password", "manager", "configuration", "using", "the", "following", "commands", ":"], ["The", "tool", "'s", "activity", "can", "be", "detected", "by", "monitoring", "processes", "created", "by", "wmipsrv.exe", "that", "terminate", "with", "the", "following", "string", ":"], ["In", "addition", ",", "the", "attackers", "frequently", "used", "this", "tool", "to", "issue", "a", "command", "that", "enabled", "WinRM", "service", "network", "connections", "through", "the", "firewall", ",", "possibly", "for", "accessing", "prepared", "scripts", "."], ["By", "leveraging", "WinRM", ",", "attackers", "could", "run", "PowerShell", "commands", "on", "remote", "machines", "."], ["This", "tool", "can", "be", "identified", "by", "searching", "for", "processes", "initiated", "by", "``", "wsmprovhost.exe", "''", "."], ["The", "attackers", "disabled", "logging", "for", "active", "directory", "web", "services", ",", "hardware", "events", ",", "and", "internet", "explorer", "using", "the", "following", "commands", ":"], ["c", ":", "\\windows\\system32\\wevtutil.exe", "set-log", "active", "directory", "web", "services", "/enabled", ":", "false"], ["c", ":", "\\windows\\system32\\wevtutil.exe", "set-log", "hardwareevents", "/enabled", ":", "false"], ["c", ":", "\\windows\\system32\\wevtutil.exe", "set-log", "internet", "explorer", "/enabled", ":", "false"], ["The", "attackers", "used", "Microsoft", "Remote", "Desktop", "to", "obtain", "GUI", "access", "to", "target", "systems", "."], ["Prior", "to", "gaining", "remote", "admin", "access", ",", "they", "executed", "the", "following", "impacket", "command", ":"], ["``", "cmd.exe", "/q", "/c", "reg", "add", "hkey_local_machine\\system\\currentcontrolset\\control\\lsa", "/v", "disablerestrictedadmin", "/t", "reg_dword", "/d", "0", "1", ">", "\\127.0.0.1\\admin", "$", "__", "<", "timestamp", ">", ".", "<", "num", ">", "2", ">", "&", "1", "''", "."], ["Interestingly", ",", "an", "OPSEC", "mistake", "was", "made", "during", "shell", "upload", "and", "download", "commands", ",", "which", "revealed", "their", "use", "of", "Kali", "Linux", "for", "remote", "command", "execution", "."], ["While", "it", "is", "unlikely", "that", "the", "attackers", "had", "a", "Kali", "Linux", "installation", "within", "the", "victim", "'s", "network", ",", "they", "likely", "achieved", "remote", "control", "of", "the", "systems", "through", "SSH", "tunnels", "as", "previously", "described", "."], ["The", "document", "exfiltration", "may", "have", "been", "carried", "out", "through", "the", "execution", "of", "similar", "upload/download", "commands", "."], ["In", "both", "attacks", ",", "the", "attackers", "performed", "multiple", "actions", "to", "prepare", "the", "systems", "before", "executing", "the", "ransomware", "to", "ensure", "maximum", "success", "."], ["At", "the", "time", "of", "the", "incident", ",", "the", "perpetrator", "accessed", "the", "domain", "controller", "and", "launched", "the", "group", "policy", "management", "interface", "."], ["Next", ",", "the", "attacker", "introduced", "and", "ran", "a", "file", "known", "as", "``", "apply.ps1", ".", "''", "The", "execution", "command", "utilized", "was", ":"], ["``", "c", ":", "\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe", "-exec", "bypass", ".\\apply.ps1", "''", "."], ["This", "action", "led", "to", "the", "immediate", "storage", "of", "group", "policy", "files", "on", "the", "disk", "."], ["Following", "this", ",", "the", "attackers", "used", "a", "command", "to", "enforce", "the", "deployment", "of", "the", "group", "policy", "."], ["Shortly", "before", "the", "commencement", "of", "BlackCat", "ransomware", "'s", "encryption", "of", "files", ",", "the", "intruders", "initiated", "a", "script", "named", "``", "defender.vbs", ".", "''"], ["In", "the", "case", "of", "the", "BlackMatter", "attack", ",", "a", "file", "named", "``", "def.vbs", "''", "was", "executed", "just", "minutes", "before", "encryption", "commenced", "."], ["The", "command", "used", "to", "execute", "this", "file", "was", "``", "cmd.exe", "/c", "\\", "<", "domaincontroller", ">", "\\netlogon\\def.vbs", "''", "."], ["Soon", "after", "encryption", "began", ",", "a", "ransomware", "file", "with", "the", "same", "name", "format", "as", "the", "BlackCat", "attack", ",", "<", "num", ">", ".exe", ",", "was", "dropped", "on", "domain", "servers", "in", "the", "SYSVOL", "folder", "."], ["Since", "this", "folder", "is", "accessible", "through", "the", "NETLOGON", "network", "share", ",", "it", "allowed", "all", "domain", "users", "to", "access", "the", "file", "."], ["Once", "the", "files", "were", "encrypted", ",", "all", "systems", "could", "execute", "them", "remotely", "."], ["The", "commands", "used", "for", "remote", "execution", "included", "``", "cmd.exe", "-c", "\\", "<", "domain", "controller", ">", "\\netlogon", "<", "num", ">", ".exe", "--", "access-token", "<", "token", ">", "''", "or", "``", "cmd.exe", "-c", "\\", "<", "domain", "controller", ">", "\\netlogon", "<", "num", ">", ".exe", "''", "."], ["Additionally", ",", "the", "BlackCat", "attack", "deployed", "several", "other", "commands", "that", "improved", "its", "effectiveness", "during", "execution", "."], ["One", "such", "command", "was", "``", "c", ":", "\\windows\\system32\\cmd.exe", "/c", "fsutil", "behavior", "set", "symlinkevaluation", "r2l:1", "''", "."]], "ner": [[[2, 3, "MP"], [10, 10, "MP"], [17, 20, "MF"]], [[28, 28, "MP"]], [[53, 54, "MP"]], [[66, 66, "MP"], [71, 72, "SO"], [80, 81, "MF"], [86, 86, "MP"]], [[91, 92, "MF"]], [[126, 126, "MP"]], [], [[172, 172, "MP"], [182, 183, "SF"]], [[193, 193, "SF"]], [], [], [[228, 229, "MP"], [232, 232, "MP"], [242, 242, "MF"]], [[250, 250, "MF"], [265, 266, "MF"], [271, 272, "SO"]], [[283, 283, "MF"], [296, 297, "MP"]], [[301, 301, "MP"], [303, 303, "SF"], [312, 312, "MF"]], [[332, 332, "MF"]], [], [[350, 354, "SF"], [371, 373, "MF"], [375, 376, "MF"]], [], [], [], [[400, 401, "MP"], [403, 403, "MP"], [406, 406, "MF"], [409, 410, "MF"]], [], [[439, 441, "TF"], [445, 446, "MP"], [452, 452, "MF"]], [[474, 474, "MF"]], [], [[493, 493, "MP"]], [[504, 504, "MP"], [508, 509, "TF"], [514, 517, "TF"]], [[523, 524, "MF"]], [[547, 547, "MP"], [550, 551, "MF"], [558, 559, "SO"], [564, 564, "SF"]], [[574, 574, "MF"], [576, 576, "MP"], [579, 579, "MP"]], [], [[601, 601, "MP"]], [], [], [], [[650, 650, "MP"], [652, 654, "MF"], [657, 657, "SF"]], [], [], [[724, 724, "MP"], [730, 731, "MF"]], [[740, 740, "MP"], [761, 762, "MF"]], [[768, 769, "TF"], [780, 781, "MF"]], [[788, 788, "MP"]], [[813, 813, "MP"], [821, 824, "SF"]], [[829, 829, "MP"], [838, 838, "MF"]], [], [[864, 866, "MF"]], [[875, 875, "MP"], [878, 878, "MF"]], [[893, 894, "MP"], [907, 907, "MF"]], [[915, 916, "MP"], [922, 922, "MF"]], [], [[968, 971, "MF"], [976, 977, "SO"]], [], [], [], [[1062, 1063, "MP"], [1067, 1067, "MF"]], []], "relations": [[[10, 10, 17, 20, "EX"], [2, 3, 71, 72, "ST"], [2, 3, 71, 72, "RF"], [2, 3, 182, 183, "RD"], [2, 3, 91, 92, "WR"], [2, 3, 10, 10, "CO"], [2, 3, 28, 28, "CO"], [2, 3, 53, 54, "CO"], [2, 3, 86, 86, "CO"], [2, 3, 66, 66, "CO"], [2, 3, 126, 126, "CO"], [2, 3, 172, 172, "CO"]], [], [], [[66, 66, 80, 81, "WR"]], [], [], [], [[172, 172, 182, 183, "WR"]], [[193, 193, 182, 183, "CO"]], [], [], [[228, 229, 71, 72, "ST"], [228, 229, 71, 72, "RF"], [228, 229, 91, 92, "WR"], [228, 229, 193, 193, "RD"], [228, 229, 193, 193, "RD"], [228, 229, 193, 193, "WR"], [232, 232, 242, 242, "WR"], [228, 229, 265, 266, "WR"], [228, 229, 271, 272, "ST"], [228, 229, 271, 272, "RF"], [228, 229, 303, 303, "RD"], [228, 229, 312, 312, "WR"], [228, 229, 232, 232, "CO"], [228, 229, 296, 297, "CO"], [228, 229, 301, 301, "CO"]], [[250, 250, 242, 242, "CO"]], [[296, 297, 283, 283, "EX"]], [[301, 301, 303, 303, "WR"], [301, 301, 332, 332, "WR"]], [], [], [], [], [], [], [[400, 401, 250, 250, "WR"], [400, 401, 265, 266, "WR"], [400, 401, 271, 272, "ST"], [400, 401, 271, 272, "RF"], [400, 401, 312, 312, "WR"], [400, 401, 350, 354, "CD"], [400, 401, 371, 373, "EX"], [400, 401, 375, 376, "EX"], [403, 403, 406, 406, "EX"], [403, 403, 409, 410, "WR"], [400, 401, 474, 474, "WR"], [400, 401, 403, 403, "CO"], [400, 401, 445, 446, "CO"]], [], [[445, 446, 439, 441, "WR"], [445, 446, 452, 452, "EX"]], [], [], [[493, 493, 474, 474, "WR"], [493, 493, 523, 524, "WR"], [493, 493, 504, 504, "CO"], [493, 493, 547, 547, "CO"], [493, 493, 601, 601, "CO"], [493, 493, 788, 788, "CO"], [493, 493, 875, 875, "CO"]], [[504, 504, 508, 509, "RD"], [504, 504, 514, 517, "RD"]], [], [[547, 547, 523, 524, "WR"], [547, 547, 550, 551, "EX"], [547, 547, 564, 564, "RD"], [547, 547, 558, 559, "ST"], [547, 547, 564, 564, "WR"], [550, 551, 574, 574, "CO"]], [[576, 576, 574, 574, "EX"], [576, 576, 579, 579, "FR"]], [], [[601, 601, 650, 650, "CO"], [601, 601, 576, 576, "CO"]], [], [], [], [[650, 650, 652, 654, "EX"], [650, 650, 657, 657, "CD"]], [], [], [[724, 724, 730, 731, "EX"], [724, 724, 740, 740, "CO"]], [[740, 740, 761, 762, "EX"], [740, 740, 768, 769, "WR"], [740, 740, 780, 781, "EX"]], [], [[788, 788, 813, 813, "CO"], [788, 788, 829, 829, "CO"]], [[813, 813, 821, 824, "RD"]], [[829, 829, 838, 838, "WR"], [829, 829, 838, 838, "EX"], [829, 829, 864, 866, "WR"]], [], [], [[875, 875, 878, 878, "EX"], [875, 875, 893, 894, "CO"], [875, 875, 915, 916, "CO"]], [[893, 894, 907, 907, "EX"]], [[915, 916, 922, 922, "WR"], [915, 916, 922, 922, "EX"], [915, 916, 968, 971, "WR"], [915, 916, 976, 977, "ST"]], [], [], [], [], [], [[1062, 1063, 1067, 1067, "EX"]], []]}