{"doc_key": "104", "sentences": [["In", "the", "process", "of", "reverse", "engineering", "Rombertik", ",", "Talos", "discovered", "multiple", "layers", "of", "obfuscation", "and", "anti-analysis", "functionality", "."], ["If", "the", "sample", "detected", "it", "was", "being", "analyzed", "or", "debugged", "it", "would", "ultimately", "destroy", "the", "master", "boot", "record", "(", "MBR", ")", "."], ["However", ",", "unlike", "Dyre", "which", "was", "designed", "to", "target", "banking", "information", ",", "Rombertik", "collects", "information", "from", "all", "websites", "in", "an", "indiscriminate", "manner", "."], ["The", "attackers", "attempt", "to", "convince", "the", "user", "to", "check", "the", "attached", "documents", "to", "see", "if", "their", "business", "aligns", "with", "the", "target", "user", "'", "s", "organization", "."], ["If", "the", "user", "downloads", "and", "unzips", "the", "file", ",", "the", "user", "then", "sees", "a", "file", "that", "looks", "like", "a", "document", "thumbnail", "."], ["SCR", "screensaver", "executable", "file", "that", "contains", "Rombertik", "."], ["Once", "the", "user", "double", "clicks", "to", "open", "the", "file", ",", "Rombertik", "will", "begin", "the", "process", "of", "compromising", "the", "system", "."], ["Upon", "execution", ",", "Rombertik", "will", "stall", "and", "then", "run", "through", "a", "first", "set", "of", "anti-analysis", "checks", "to", "see", "if", "it", "is", "running", "within", "a", "sandbox", "."], ["Once", "these", "checks", "are", "complete", ",", "Rombertik", "will", "proceed", "to", "decrypt", "and", "install", "itself", "on", "the", "victims", "computer", "to", "maintain", "persistence", "."], ["After", "installation", ",", "it", "will", "then", "launch", "a", "second", "copy", "of", "itself", "and", "overwrite", "the", "second", "copy", "with", "the", "malware", "'", "s", "core", "functionality", "."], ["Before", "Rombertik", "begins", "the", "process", "of", "spying", "on", "users", ",", "Rombertik", "will", "perform", "once", "last", "check", "to", "ensure", "it", "is", "not", "being", "analyzed", "in", "memory", "."], ["If", "this", "check", "fails", ",", "Rombertik", "will", "attempt", "to", "destroy", "the", "Master", "Boot", "Record", "and", "restart", "the", "computer", "to", "render", "it", "unusable", "."], ["In", "this", "case", ",", "the", "unpacked", "Rombertik", "sample", "is", "28KB", "while", "the", "packed", "version", "is", "1264KB", "."], ["Over", "97", "%", "of", "the", "packed", "file", "is", "dedicated", "to", "making", "the", "file", "look", "legitimate", "by", "including", "75", "images", "and", "over", "8000", "functions", "that", "are", "never", "used", "."], ["A", "common", "technique", "to", "evade", "sandboxes", "is", "to", "sleep", "for", "extended", "lengths", "of", "time", "with", "the", "intention", "of", "forcing", "the", "sandbox", "to", "time", "out", "before", "the", "malware", "``", "wakes", "up", "''", "and", "begins", "executing", "."], ["Rombertik", "instead", "writes", "a", "byte", "of", "random", "data", "to", "memory", "960", "Million", "times", "."], ["If", "an", "analysis", "tool", "attempted", "to", "log", "all", "of", "the", "960", "Million", "write", "instructions", ",", "the", "log", "would", "grow", "to", "over", "100", "gigabytes", "."], ["After", "intentionally", "stalling", "by", "writing", "to", "memory", "repeatedly", ",", "Rombertik", "checks", "to", "see", "if", "analysis", "tools", "have", "modified", "code", "in", "the", "Windows", "API", "ZwGetWriteWatch", "routine", "."], ["It", "does", "this", "by", "calling", "ZwGetWriteWatch", "with", "invalid", "arguments", "."], ["If", "the", "routine", "does", "not", "return", "with", "a", "specific", "error", ",", "Rombertik", "terminates", "."], ["Once", "the", "sandbox", "check", "is", "complete", ",", "Rombertik", "calls", "the", "Windows", "API", "OutputDebugString", "function", "335,000", "times", "as", "an", "anti-debugging", "mechanism", "."], ["Finally", ",", "an", "anti-analysis", "function", "within", "the", "packer", "is", "called", "to", "check", "the", "username", "and", "filename", "of", "the", "executing", "process", "for", "strings", "like", "``", "malwar", "''", ",", "``", "sampl", "''", ",", "``", "viru", "''", ",", "and", "``", "sandb", "''", "."], ["If", "the", "packer", "detects", "any", "of", "these", "substrings", ",", "it", "will", "stop", "unpacking", "and", "terminate", "."], ["At", "this", "point", ",", "the", "initial", "anti-analysis", "checks", "are", "complete", "."], ["Once", "the", "packer", "has", "run", "through", "initial", "anti-analysis", "checks", ",", "it", "will", "check", "to", "see", "if", "it", "is", "executing", "from", "%", "AppData", "%", "sr\\yfoye.exe", "."], ["If", "the", "packer", "is", "not", "executing", "from", "there", ",", "it", "will", "proceed", "to", "install", "itself", "in", "order", "to", "ensure", "persistence", "across", "system", "reboots", "before", "continuing", "on", "to", "execute", "the", "payload", "."], ["To", "install", "itself", ",", "Rombertik", "first", "creates", "a", "VBS", "script", "named", "``", "fgf.vbs", "''", ",", "which", "is", "used", "to", "kick", "off", "Rombertik", "every", "time", "the", "user", "logs", "in", ",", "and", "places", "the", "script", "into", "the", "user", "'", "s", "Startup", "folder", "."], ["Rombertik", "then", "creates", "%", "AppData", "%", "sr\\yfoye.bat", "and", "moves", "the", "packed", "version", "of", "itself", "into", "%", "AppData", "%", "sr\\yfoye.exe", "."], ["If", "Rombertik", "detects", "it", "is", "already", "executing", "from", "%", "AppData", "%", "sr\\yfoye.exe", ",", "the", "malware", "will", "then", "begin", "decrypting", "and", "executing", "the", "main", "unpacking", "code", "in", "memory", "."], ["Rombertik", "will", "then", "proceed", "to", "execute", "yfoye.exe", "a", "second", "time", "to", "create", "a", "new", "instance", "of", "the", "process", "."], ["Once", "the", "unpacking", "is", "complete", ",", "Rombertik", "will", "overwrite", "the", "memory", "of", "the", "new", "process", "with", "the", "unpacked", "executable", "code", "."], ["A", "Nasty", "Trap", "DoorOnce", "the", "unpacked", "version", "of", "Rombertik", "within", "the", "second", "copy", "of", "yfoye.exe", "begins", "executing", ",", "one", "last", "anti-analysis", "function", "is", "run", "--", "which", "turns", "out", "to", "be", "particularly", "nasty", "if", "the", "check", "fails", "."], ["The", "function", "computes", "a", "32-bit", "hash", "of", "a", "resource", "in", "memory", ",", "and", "compares", "it", "to", "the", "PE", "Compile", "Timestamp", "of", "the", "unpacked", "sample", "."], ["If", "the", "resource", "or", "compile", "time", "has", "been", "altered", ",", "the", "malware", "acts", "destructively", "."], ["It", "first", "attempts", "to", "overwrite", "the", "Master", "Boot", "Record", "(", "MBR", ")", "of", "PhysicalDisk0", ",", "which", "renders", "the", "computer", "inoperable", "."], ["If", "the", "malware", "does", "not", "have", "permissions", "to", "overwrite", "the", "MBR", ",", "it", "will", "instead", "destroy", "all", "files", "in", "the", "user", "'s", "home", "folder", "(", "e.", "g", "."], ["C", ":", "\\Documents", "and", "Settings\\Administrator\\", ")", "by", "encrypting", "each", "file", "with", "a", "randomly", "generated", "RC4", "key", "."], ["After", "the", "MBR", "is", "overwritten", ",", "or", "the", "home", "folder", "has", "been", "encrypted", ",", "the", "computer", "is", "restarted", "."], ["The", "Master", "Boot", "Record", "starts", "with", "code", "that", "is", "executed", "before", "the", "Operating", "System", "."], ["The", "MBR", "also", "contains", "information", "about", "the", "disk", "partitions", "."], ["The", "altered", "MBR", "overwrites", "the", "bytes", "for", "these", "partitions", "with", "Null", "bytes", ",", "making", "it", "even", "more", "difficult", "to", "recover", "data", "from", "the", "sabotaged", "hard", "drive", "."], ["Once", "the", "computer", "is", "restarted", ",", "the", "victim", "'", "s", "computer", "will", "be", "stuck", "at", "this", "screen", "until", "the", "Operating", "System", "is", "reinstalled", ":", "Effectively", ",", "Rombertik", "begins", "to", "behave", "like", "a", "wiper", "malware", "sample", ",", "trashing", "the", "user", "'", "s", "computer", "if", "it", "detects", "it", "'", "s", "being", "analyzed", "."], ["The", "Actual", "MalwareAt", "this", "point", ",", "Rombertik", "will", "assume", "that", "all", "anti-analysis", "checks", "have", "passed", "and", "will", "actually", "begin", "doing", "what", "was", "originally", "intended", "--", "stealing", "user", "data", "."], ["Rombertik", "will", "scan", "the", "user", "'", "s", "currently", "running", "process", "to", "determine", "if", "a", "web", "browser", "is", "currently", "running", "."], ["If", "Rombertik", "detects", "an", "instance", "of", "Firefox", ",", "Chrome", ",", "or", "Internet", "Explorer", ",", "it", "will", "inject", "itself", "into", "the", "process", "and", "hook", "API", "functions", "that", "handle", "plain", "text", "data", "."], ["Once", "accomplished", ",", "Rombertik", "is", "then", "able", "to", "read", "any", "plain-text", "data", "the", "user", "might", "type", "into", "their", "browser", "and", "capture", "this", "input", "before", "it", "gets", "encrypted", "if", "the", "input", "is", "to", "be", "sent", "over", "HTTPS", "."], ["This", "enables", "the", "malware", "to", "collect", "data", "such", "as", "usernames", "and", "passwords", "from", "almost", "any", "website", "."]], "ner": [[[6, 6, "MP"]], [[37, 37, "SF"]], [[52, 52, "MP"], [54, 54, "TF"]], [[64, 64, "MP"], [69, 69, "TP"], [73, 74, "MF"]], [[91, 91, "TP"], [96, 96, "MF"], [99, 99, "TP"], [108, 109, "MF"]], [[111, 113, "MF"], [117, 117, "MP"]], [[121, 121, "TP"], [127, 127, "MF"], [129, 129, "MP"]], [[153, 153, "MP"]], [[171, 171, "MP"], [175, 175, "MP"], [178, 178, "MF"], [181, 182, "TP"]], [[190, 190, "MP"], [198, 198, "MF"], [206, 206, "MP"]], [[213, 213, "MP"], [222, 222, "MP"], [226, 227, "MP"]], [[243, 243, "MP"]], [[267, 267, "MP"]], [], [[332, 332, "MP"]], [[341, 341, "MP"]], [], [[388, 388, "MP"], [400, 402, "MF"]], [[405, 405, "MP"], [410, 410, "MP"]], [[426, 426, "MP"]], [[436, 436, "MP"], [441, 441, "MP"], [447, 447, "MP"]], [[453, 453, "MP"], [463, 463, "SF"], [465, 465, "SF"]], [], [[512, 512, "MP"]], [[524, 524, "MP"], [527, 527, "MP"], [537, 540, "MF"]], [[551, 551, "MP"], [571, 571, "MP"]], [[577, 577, "MP"], [581, 582, "MF"], [585, 585, "MF"], [594, 594, "MP"], [598, 599, "TP"], [605, 605, "MF"], [608, 612, "SF"]], [[614, 614, "MP"], [617, 620, "MF"], [629, 632, "MF"]], [[635, 635, "MP"], [642, 645, "MF"], [648, 648, "MP"], [652, 652, "MF"], [657, 658, "MF"]], [[662, 662, "MP"], [668, 668, "MF"], [675, 676, "MP"]], [[687, 687, "MP"], [691, 695, "MF"], [698, 700, "MF"]], [[710, 710, "MP"], [716, 716, "MF"], [722, 722, "MP"]], [[740, 740, "MP"], [743, 744, "TF"], [756, 758, "MF"]], [[775, 775, "MP"]], [[779, 779, "MP"], [789, 789, "SF"], [792, 792, "SF"]], [[802, 802, "MP"], [812, 812, "MP"], [820, 823, "SF"]], [[835, 835, "MP"], [842, 843, "TF"]], [[862, 862, "TP"]], [[865, 867, "SF"]], [[880, 880, "SF"]], [[891, 891, "SF"]], [[923, 923, "TP"], [932, 932, "SF"], [938, 938, "TP"], [942, 942, "MP"], [949, 949, "MP"]], [[973, 973, "MP"]], [[996, 996, "MP"], [1004, 1005, "SF"], [1010, 1011, "SF"]], [[1017, 1017, "MP"], [1022, 1022, "TP"], [1024, 1024, "TP"], [1027, 1028, "TP"], [1030, 1030, "MP"], [1039, 1040, "MP"], [1043, 1045, "TF"]], [[1050, 1050, "MP"], [1057, 1058, "TF"]], [[1087, 1087, "MP"], [1093, 1093, "TF"], [1095, 1095, "TF"]]], "relations": [[[6, 6, 37, 37, "RD"], [6, 6, 37, 37, "RD"], [6, 6, 37, 37, "WR"], [6, 6, 37, 37, "RD"], [6, 6, 37, 37, "RD"], [6, 6, 37, 37, "WR"]], [], [[52, 52, 37, 37, "RD"], [52, 52, 37, 37, "RD"], [52, 52, 37, 37, "WR"], [52, 52, 37, 37, "RD"], [52, 52, 37, 37, "RD"], [52, 52, 37, 37, "WR"], [52, 52, 69, 69, "FR"]], [[64, 64, 73, 74, "WR"], [69, 69, 73, 74, "RD"], [69, 69, 91, 91, "CO"], [69, 69, 99, 99, "CO"]], [[91, 91, 96, 96, "WR"], [99, 99, 108, 109, "RD"], [108, 109, 111, 113, "CO"], [108, 109, 127, 127, "CO"]], [[117, 117, 108, 109, "RD"], [117, 117, 121, 121, "FR"]], [[121, 121, 129, 129, "FR"], [129, 129, 127, 127, "EX"], [129, 129, 153, 153, "FR"], [129, 129, 171, 171, "CO"], [129, 129, 190, 190, "CO"]], [], [[171, 171, 175, 175, "FR"], [171, 171, 181, 182, "FR"], [181, 182, 178, 178, "WR"]], [[190, 190, 206, 206, "FR"], [206, 206, 198, 198, "EX"], [206, 206, 222, 222, "CO"]], [[213, 213, 198, 198, "RD"], [222, 222, 226, 227, "FR"], [213, 213, 388, 388, "CO"], [213, 213, 243, 243, "CO"], [213, 213, 267, 267, "CO"], [213, 213, 341, 341, "CO"]], [], [], [], [[332, 332, 463, 463, "RD"], [332, 332, 463, 463, "RD"], [332, 332, 463, 463, "WR"], [332, 332, 206, 206, "CO"], [332, 332, 802, 802, "CO"]], [], [], [[388, 388, 405, 405, "CO"], [388, 388, 426, 426, "CO"], [388, 388, 436, 436, "CO"], [388, 388, 453, 453, "CO"]], [[405, 405, 410, 410, "FR"], [410, 410, 400, 402, "RD"]], [], [[436, 436, 441, 441, "FR"], [441, 441, 447, 447, "CO"]], [[453, 453, 463, 463, "RD"], [453, 453, 465, 465, "RD"]], [], [[512, 512, 465, 465, "RD"], [512, 512, 465, 465, "RD"], [512, 512, 465, 465, "WR"], [512, 512, 524, 524, "CO"]], [[527, 527, 537, 540, "RD"], [527, 527, 551, 551, "CO"]], [[571, 571, 537, 540, "RD"], [571, 571, 598, 599, "FR"]], [[598, 599, 594, 594, "FR"], [577, 577, 581, 582, "WR"], [577, 577, 608, 612, "RD"], [581, 582, 605, 605, "CO"], [581, 582, 585, 585, "CO"], [577, 577, 594, 594, "CO"], [577, 577, 614, 614, "CO"], [577, 577, 635, 635, "CO"], [577, 577, 648, 648, "CO"], [577, 577, 662, 662, "CO"], [577, 577, 687, 687, "CO"]], [[614, 614, 617, 620, "WR"], [614, 614, 629, 632, "WR"]], [[635, 635, 642, 645, "EX"], [648, 648, 652, 652, "EX"], [648, 648, 657, 658, "EX"]], [[662, 662, 668, 668, "EX"], [662, 662, 675, 676, "FR"]], [[687, 687, 691, 695, "WR"], [687, 687, 698, 700, "RD"]], [[710, 710, 716, 716, "WR"], [710, 710, 722, 722, "FR"], [722, 722, 716, 716, "WR"], [722, 722, 740, 740, "CO"], [710, 710, 775, 775, "CO"], [710, 710, 779, 779, "CO"]], [[740, 740, 743, 744, "WR"], [740, 740, 756, 758, "RD"]], [], [[779, 779, 789, 789, "UK"], [789, 789, 792, 792, "CO"]], [[812, 812, 835, 835, "FR"], [812, 812, 842, 843, "WR"], [812, 812, 862, 862, "FR"], [802, 802, 812, 812, "CO"]], [[835, 835, 820, 823, "RD"], [835, 835, 820, 823, "WR"], [835, 835, 842, 843, "EX"]], [[862, 862, 865, 867, "RD"], [862, 862, 865, 867, "RD"], [862, 862, 865, 867, "WR"], [862, 862, 880, 880, "RD"], [862, 862, 880, 880, "RD"], [862, 862, 880, 880, "WR"]], [], [[880, 880, 891, 891, "CO"]], [], [[923, 923, 865, 867, "RD"], [923, 923, 865, 867, "RD"], [923, 923, 865, 867, "WR"], [923, 923, 880, 880, "RD"], [923, 923, 891, 891, "RD"], [923, 923, 891, 891, "WR"], [923, 923, 932, 932, "RD"], [923, 923, 938, 938, "FR"], [938, 938, 942, 942, "FR"], [938, 938, 949, 949, "FR"], [949, 949, 1004, 1005, "RD"], [949, 949, 1004, 1005, "RD"], [949, 949, 1004, 1005, "WR"], [942, 942, 973, 973, "CO"], [942, 942, 996, 996, "CO"]], [], [[996, 996, 1004, 1005, "RD"], [1004, 1005, 1010, 1011, "CO"]], [[1017, 1017, 1022, 1022, "IJ"], [1017, 1017, 1024, 1024, "IJ"], [1017, 1017, 1027, 1028, "IJ"], [1030, 1030, 1039, 1040, "FR"], [1039, 1040, 1043, 1045, "WR"], [1017, 1017, 1030, 1030, "CO"], [1017, 1017, 1050, 1050, "CO"], [1017, 1017, 1087, 1087, "CO"], [1043, 1045, 1057, 1058, "CO"], [1043, 1045, 1093, 1093, "CO"], [1043, 1045, 1095, 1095, "CO"]], [], []]}