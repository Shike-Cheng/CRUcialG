{"doc_key": "036", "sentences": [["The", "attack", "campaign", "employed", "XLS", "maldocs", "and", "executables", "that", "were", "hosted", "on", "a", "file", "sharing", "platform", "called", "``", "snapfile.org", "''", "."], ["These", "harmful", "files", "were", "initially", "disguised", "as", "PDF", "documents", "with", "embedded", "links", "and", "delivered", "to", "targeted", "victims", "."], ["The", "XLS", "maldocs", "contained", "VBA", "macros", "designed", "to", "trigger", "the", "infection", "process", "."], ["The", "infection", "process", ",", "in", "turn", ",", "involved", "the", "creation", "of", "three", "key", "artifacts", "on", "the", "victim", "'s", "machine", ":", "a", "registry", "key", "for", "persistence", ",", "a", "malicious", "VB", "script", "intermediate", "component", "set", "up", "by", "the", "macro", "for", "persistence", ",", "and", "a", "PowerShell-based", "downloader", "script", "used", "to", "execute", "arbitrary", "code", "on", "the", "infected", "endpoint", "."], ["To", "ensure", "persistence", ",", "the", "VB", "script", "created", "a", "Registry", "Run", "specifically", "for", "the", "affected", "user", "."], ["Additionally", ",", "this", "campaign", "relied", "on", "the", "use", "of", "a", "Living", "off", "the", "Land", "Binary", "(", "LoLBin", ")", "to", "execute", "the", "malicious", "VBScript", "."], ["The", "attackers", "have", "been", "known", "to", "utilize", "the", "LoLBin", "DLL", "pcwutl.dll", ",", "a", "component", "of", "the", "operating", "system", ",", "to", "execute", "their", "VBScripts", "upon", "reboot", "or", "login", "."], ["To", "ensure", "persistence", "across", "reboots", ",", "the", "VBA", "macros", "used", "consistently", "create", "malicious", "VBS", "and", "PS1", "scripts", "."], ["The", "latest", "VBA", "code", "versions", "deployed", "by", "the", "attackers", "involve", "making", "HTTP", "requests", "using", "canary", "tokens", "from", "canarytokens.com", "."], ["When", "an", "object", "containing", "a", "canary", "token", "is", "opened", ",", "the", "token", "generates", "an", "HTTP", "request", "that", "alerts", "its", "owner", "to", "the", "object", "being", "opened", "."], ["In", "this", "campaign", ",", "the", "canary", "token", "is", "executed", "silently", "twice", "during", "macro", "execution", "."], ["Additionally", ",", "the", "final", "payload", "server", "in", "use", "will", "only", "deliver", "the", "payload", "if", "it", "receives", "two", "nearly", "simultaneous", "canary", "token", "requests", "."], ["This", "approach", "helps", "detect", "researchers", "who", "attempt", "to", "obtain", "the", "payload", "without", "registering", "with", "canary", "tokens", "and", "making", "an", "HTTP", "request", "."], ["The", "infection", "chain", "involves", "a", "downloader", "based", "on", "PS1", "and", "two", "sets", "of", "HTTP", "requests", "for", "canary", "tokens", "."], ["Automated", "sandboxed", "systems", "usually", "run", "the", "malicious", "macro", "that", "generates", "token", "requests", "."], ["The", "creation", "of", "the", "registry", "Run", "key", "and", "re-login", "of", "the", "infected", "user", "to", "execute", "the", "malicious", "PS1", ",", "which", "generates", "the", "request", "to", "download", "the", "next", "payload", ",", "is", "also", "detected", "by", "the", "sandbox", "."], ["A", "short", "interval", "between", "the", "HTTP", "token", "requests", "and", "PS1", "requesting", "the", "payload", "may", "suggest", "automated", "analysis", "of", "the", "maldocs", "and", "lead", "to", "blocking", "payload", "requests", "from", "the", "infected", "endpoint", "."], ["If", "token", "requests", "persist", ",", "but", "no", "requests", "are", "made", "to", "the", "payload", "server", ",", "this", "indicates", "that", "their", "payload", "server", "is", "blocked", ",", "and", "someone", "is", "responsible", "for", "it", "."], ["VBS", "executes", "the", "PS1", "on", "the", "endpoint", "."], ["The", "PowerShell", "script", "used", "in", "the", "attack", "downloads", "and", "executes", "the", "next", "payload", "(", "another", "PS1", "script", ")", "on", "the", "infected", "endpoint", "."], ["This", "PS1", "script", "is", "dropped", "by", "the", "macro", "and", "resides", "in", "the", "metadata", "of", "the", "maldoc", "."], ["The", "process", "also", "includes", "a", "PS1", "downloader", "script", "."], ["The", "PowerShell", "script", "featured", "in", "the", "attack", "serves", "the", "purpose", "of", "fetching", "another", "PowerShell", "script", "from", "a", "remote", "location", ",", "which", "is", "then", "executed", "on", "the", "victim", "'s", "endpoint", "."], ["The", "download", "process", "is", "attempted", "twice", "with", "a", "custom", "timeout", "of", "40", "seconds", "and", "a", "user", "agent", "that", "includes", "the", "username", "separated", "by", "a", "``", "|", "''", "character", "."], ["The", "use", "of", "canarytokens", "in", "this", "step", "indicates", "an", "attempt", "to", "evade", "detection", "and", "delay", "delivery", "of", "the", "final", "payload", "."], ["Typically", ",", "attackers", "leverage", "PDF", "files", "to", "prompt", "users", "to", "click", "on", "links", "that", "claim", "to", "resolve", "issues", "with", "document", "format", "or", "extension", "."], ["Once", "the", "victim", "clicks", "on", "the", "download", "button", ",", "the", "endpoint", "is", "infected", "with", "a", "second-stage", "payload", "that", "could", "be", "either", "a", "malicious", "XLS", "file", "or", "Windows", "executable", ",", "as", "previously", "described", "."], ["The", "initial", "stage", "of", "the", "infection", "chain", "utilizes", "malicious", "PDF", "files", "as", "the", "delivery", "mechanism", "."], ["Typically", ",", "the", "URLs", "associated", "with", "the", "download", "button", "in", "these", "PDF", "files", "host", "malicious", "XLS", "files", "that", "contain", "macros", "responsible", "for", "deploying", "subsequent", "VBS", "and", "PS1", "scripts", "."], ["However", ",", "a", "new", "variation", "of", "the", "attack", "has", "emerged", ",", "where", "the", "PDF", "file", "directs", "the", "user", "to", "a", "URL", "hosting", "a", "Windows", "executable", "(", "EXE", ")", "instead", "of", "an", "XLS", "file", "."], ["This", "ultimately", "leads", "to", "a", "similar", "infection", "chain", "involving", "intermediate", "VBS", "and", "final", "PS1-based", "downloaders", "."]], "ner": [[[2, 2, "MP"], [4, 5, "MF"], [7, 7, "MF"], [18, 18, "SO"]], [], [[41, 41, "MP"], [43, 44, "MP"], [49, 50, "MP"]], [[53, 54, "MP"], [73, 74, "MF"], [80, 83, "TF"], [94, 96, "TF"]], [[116, 116, "TF"]], [[126, 127, "MP"], [140, 140, "TP"], [145, 146, "TF"]], [[149, 149, "MP"], [158, 158, "SF"], [170, 170, "MF"]], [[183, 184, "MP"], [188, 189, "MF"], [191, 192, "MF"]], [[196, 197, "MP"], [208, 209, "MF"], [211, 211, "SO"]], [], [[244, 245, "MF"]], [[259, 259, "SO"], [268, 268, "SO"]], [[291, 292, "MF"]], [[304, 304, "MP"], [312, 313, "MP"]], [[318, 320, "MP"], [325, 325, "MF"]], [[358, 358, "MF"], [365, 365, "MP"]], [[372, 374, "TP"], [376, 379, "MP"], [386, 386, "MF"]], [[399, 399, "MF"], [410, 411, "SO"], [417, 418, "SO"]], [[429, 429, "MP"], [432, 432, "MF"]], [[438, 439, "MP"], [443, 443, "MP"], [452, 453, "MF"]], [[461, 462, "MF"], [475, 475, "MP"]], [[482, 484, "MP"]], [[487, 488, "MP"], [499, 500, "MF"], [503, 504, "SO"]], [[517, 517, "MP"], [531, 532, "MP"]], [[548, 548, "MF"], [564, 564, "MF"]], [[570, 571, "MF"]], [[596, 597, "MP"], [613, 614, "MF"], [616, 617, "MF"]], [[632, 633, "MF"], [636, 637, "MP"]], [[646, 647, "MP"], [654, 655, "MF"], [658, 658, "TP"], [663, 666, "MF"]], [[672, 672, "MP"], [691, 692, "MF"], [699, 700, "MP"]], [[702, 702, "MP"], [712, 712, "MF"], [715, 716, "TP"]]], "relations": [[[2, 2, 4, 5, "RD"], [2, 2, 7, 7, "RD"], [2, 2, 18, 18, "ST"], [2, 2, 18, 18, "RF"]], [], [[43, 44, 244, 245, "WR"], [41, 41, 49, 50, "CO"], [41, 41, 53, 54, "CO"], [41, 41, 126, 127, "CO"], [43, 44, 183, 184, "CO"], [43, 44, 196, 197, "CO"]], [[53, 54, 73, 74, "WR"], [53, 54, 80, 83, "WR"], [53, 54, 94, 96, "WR"], [53, 54, 116, 116, "WR"]], [], [[126, 127, 140, 140, "FR"], [140, 140, 145, 146, "EX"]], [[149, 149, 158, 158, "RD"], [149, 149, 158, 158, "WR"], [149, 149, 170, 170, "EX"]], [[183, 184, 188, 189, "WR"], [183, 184, 191, 192, "WR"]], [[196, 197, 208, 209, "WR"], [196, 197, 211, 211, "ST"], [196, 197, 211, 211, "RF"]], [], [], [[259, 259, 268, 268, "CO"]], [[291, 292, 208, 209, "CO"]], [[304, 304, 244, 245, "WR"], [304, 304, 291, 292, "WR"], [304, 304, 291, 292, "WR"], [304, 304, 372, 374, "FR"], [312, 313, 291, 292, "WR"]], [[318, 320, 325, 325, "EX"], [318, 320, 365, 365, "CO"]], [[365, 365, 358, 358, "WR"]], [[372, 374, 358, 358, "RD"], [372, 374, 358, 358, "EX"], [372, 374, 376, 379, "FR"], [376, 379, 386, 386, "WR"], [376, 379, 386, 386, "WR"], [376, 379, 399, 399, "WR"]], [[410, 411, 417, 418, "CO"]], [[429, 429, 386, 386, "WR"], [429, 429, 399, 399, "WR"], [429, 429, 432, 432, "EX"]], [[438, 439, 443, 443, "FR"], [438, 439, 452, 453, "EX"], [452, 453, 461, 462, "CO"]], [[475, 475, 461, 462, "UK"]], [[482, 484, 503, 504, "ST"], [482, 484, 503, 504, "RF"]], [[487, 488, 499, 500, "EX"], [487, 488, 503, 504, "ST"], [487, 488, 503, 504, "RF"], [487, 488, 517, 517, "CO"]], [[517, 517, 531, 532, "FR"], [531, 532, 548, 548, "WR"], [531, 532, 564, 564, "WR"], [531, 532, 570, 571, "WR"]], [], [], [[596, 597, 548, 548, "WR"], [596, 597, 564, 564, "WR"], [596, 597, 570, 571, "WR"], [596, 597, 613, 614, "WR"], [596, 597, 616, 617, "WR"], [596, 597, 646, 647, "CO"]], [[636, 637, 632, 633, "WR"]], [[646, 647, 654, 655, "WR"], [646, 647, 658, 658, "FR"], [658, 658, 663, 666, "WR"]], [[672, 672, 691, 692, "WR"], [699, 700, 691, 692, "RD"]], [[702, 702, 712, 712, "WR"], [702, 702, 715, 716, "FR"]]]}