{"doc_key": "035", "sentences": [["This", "operation", "utilized", "malicious", "Excel", "documents", ",", "also", "known", "as", "XLS", "maldocs", ",", "and", "executables", "hosted", "on", "the", "file", "sharing", "website", "``", "snapfile.org", "''", "."], ["The", "attackers", "delivered", "these", "harmful", "files", "to", "their", "targets", "disguised", "as", "PDF", "documents", "with", "embedded", "links", ".", "The", "XLS", "maldocs", "contain", "VBA", "macros", "that", "trigger", "the", "infection", "process", "."], ["This", "infection", "process", "is", "designed", "to", "create", "three", "critical", "artifacts", "on", "the", "victim", "'s", "device", ",", "namely", "a", "registry", "key", "for", "persistence", ",", "a", "malicious", "VB", "script", "component", "for", "intermediate", "execution", "set", "up", "by", "the", "macro", "for", "persistence", ",", "and", "a", "malicious", "PowerShell-based", "downloader", "script", ",", "which", "serves", "as", "the", "actual", "post-infection", "payload", "instrumentor", "used", "to", "run", "arbitrary", "code", "on", "the", "infected", "device", "."], ["To", "ensure", "persistence", ",", "the", "VB", "script", "creates", "a", "Registry", "Run", "for", "the", "affected", "user", "."], ["This", "campaign", "relies", "on", "a", "Living", "off", "the", "Land", "Binary", "(", "LoLBin", ")", "to", "execute", "the", "malicious", "VBScript", "."], ["In", "order", "to", "execute", "their", "VBScript", "on", "reboot", "or", "re-login", ",", "the", "attackers", "sometimes", "leverage", "a", "LoLBin", "DLL", "called", "pcwutl.dll", "that", "comes", "pre-installed", "with", "the", "operating", "system", "."], ["The", "VBA", "macros", "that", "they", "use", "are", "designed", "to", "create", "both", "malicious", "VBS", "and", "PS1", "scripts", "while", "also", "ensuring", "persistence", "across", "reboots", "."], ["The", "newest", "versions", "of", "these", "macros", "are", "capable", "of", "generating", "HTTP", "requests", "to", "canarytokens.com", "using", "a", "canary", "token", "."], ["When", "an", "object", "is", "opened", "with", "this", "token", ",", "an", "HTTP", "request", "is", "triggered", ",", "notifying", "the", "owner", "that", "the", "object", "has", "been", "accessed", "."], ["During", "the", "macro", "'s", "execution", ",", "the", "canary", "token", "is", "silently", "executed", "twice", "."], ["Moreover", ",", "in", "this", "particular", "campaign", ",", "the", "server", "that", "hosts", "the", "final", "payload", "will", "only", "deliver", "it", "if", "it", "receives", "two", "almost", "simultaneous", "requests", "to", "the", "token", "."], ["This", "method", "helps", "to", "catch", "out", "researchers", "who", "try", "to", "access", "the", "payload", "without", "utilizing", "canary", "tokens", "and", "making", "an", "HTTP", "request", "."], ["The", "method", "of", "infection", "includes", "a", "downloader", "based", "on", "PS1", "and", "two", "sets", "of", "HTTP", "requests", "for", "canary", "tokens", "."], ["Typically", ",", "automated", "sandbox", "systems", "execute", "the", "malicious", "macro", ",", "which", "generates", "token", "requests", "."], ["The", "creation", "of", "the", "registry", "Run", "key", "and", "re-login", "of", "the", "infected", "user", "to", "execute", "the", "malicious", "PS1", "that", "generates", "the", "request", "to", "download", "the", "next", "payload", "is", "also", "identified", "by", "the", "sandbox", "."], ["A", "low", "interval", "between", "the", "HTTP", "token", "requests", "and", "PS1", "requesting", "the", "payload", "could", "indicate", "automated", "analysis", "of", "the", "maldocs", "and", "may", "result", "in", "blocking", "payload", "requests", "from", "the", "infected", "endpoint", "."], ["If", "requests", "to", "the", "token", "continue", "but", "not", "to", "the", "payload", "server", ",", "this", "indicates", "that", "their", "payload", "server", "is", "blocked", "and", "by", "whom", "."], ["VBS", "executes", "the", "PS1", "on", "the", "endpoint", "."], ["The", "PowerShell", "script", "used", "in", "the", "attack", "downloads", "and", "executes", "the", "next", "payload", "(", "also", "a", "PS1", "script", ")", "on", "the", "infected", "endpoint", "."], ["This", "PS1", "script", "is", "dropped", "by", "the", "macro", "and", "resides", "in", "the", "metadata", "of", "the", "maldoc", "."], ["Additionally", ",", "there", "is", "a", "PS1", "downloader", "script", "involved", "in", "the", "process", "."], ["The", "PowerShell", "script", "utilized", "in", "the", "attack", "is", "responsible", "for", "downloading", "another", "PowerShell", "script", "from", "a", "remote", "location", ",", "which", "is", "subsequently", "executed", "on", "the", "victim", "'s", "endpoint", "."], ["The", "download", "is", "attempted", "twice", "with", "a", "custom", "timeout", "of", "40", "seconds", "and", "a", "user", "agent", "that", "includes", "the", "username", "separated", "by", "a", "``", "|", "''", "character", "."], ["It", "is", "believed", "that", "the", "use", "of", "canarytokens", "is", "to", "avoid", "detection", "and", "slow", "down", "the", "delivery", "of", "the", "final", "payload", "."], ["The", "attackers", "typically", "leverage", "PDF", "files", "to", "trick", "users", "into", "clicking", "on", "links", "designed", "to", "resolve", "format", "or", "extension", "issues", "."], ["Upon", "clicking", "the", "download", "button", ",", "the", "endpoint", "is", "hit", "with", "a", "second-stage", "payload", "that", "could", "be", "either", "a", "malicious", "XLS", "file", "or", "Windows", "executable", ",", "as", "previously", "described", "."], ["The", "attack", "begins", "with", "the", "delivery", "of", "malicious", "PDF", "files", "as", "the", "first", "stage", "of", "the", "infection", "chain", "."], ["The", "download", "buttons", "within", "these", "PDFs", "typically", "link", "to", "URLs", "hosting", "malicious", "XLS", "files", "that", "contain", "macros", "responsible", "for", "deploying", "subsequent", "VBS", "and", "PS1", "scripts", "."], ["In", "a", "second", "variation", ",", "the", "PDF", "will", "point", "to", "a", "URL", "that", "delivers", "a", "Windows", "executable", "(", "EXE", ")", "instead", "of", "the", "XLS", "file", ",", "which", "ultimately", "results", "in", "a", "similar", "infection", "chain", "consisting", "of", "intermediate", "VBS", "and", "final", "PS1-based", "downloaders", "."]], "ner": [[[1, 1, "MP"], [10, 11, "MF"], [14, 14, "MF"], [22, 22, "SO"]], [[44, 44, "MP"], [46, 47, "MP"], [51, 52, "MP"]], [[55, 56, "MP"], [72, 73, "MF"], [79, 81, "TF"], [96, 98, "TF"]], [[123, 124, "MP"], [127, 127, "SF"]], [[134, 135, "MP"], [145, 145, "TP"], [150, 151, "TF"]], [[158, 158, "MF"], [165, 165, "MP"], [172, 172, "SF"]], [[182, 183, "MP"], [192, 193, "MF"], [195, 196, "MF"]], [[209, 209, "MP"], [217, 217, "SO"], [220, 221, "MF"]], [[230, 230, "MF"]], [[255, 256, "MF"]], [[270, 270, "SO"], [279, 279, "SO"]], [[306, 307, "MF"]], [[323, 323, "MP"], [328, 329, "MP"]], [[336, 338, "MP"], [342, 342, "MF"]], [[366, 366, "MF"], [375, 375, "MF"], [381, 381, "MP"]], [[388, 390, "TP"], [392, 395, "MP"], [402, 402, "MF"]], [[419, 419, "MF"], [425, 426, "SO"], [432, 433, "SO"]], [[440, 440, "MP"], [443, 443, "MF"]], [[449, 450, "MP"], [454, 454, "MP"], [464, 465, "MF"]], [[473, 474, "MP"]], [[494, 496, "MF"]], [[503, 504, "MP"], [514, 514, "MF"], [518, 519, "SO"]], [[532, 532, "MP"], [545, 546, "MP"]], [[566, 566, "MF"], [579, 579, "MF"]], [[585, 586, "MF"]], [[605, 606, "MP"], [622, 623, "MF"], [625, 626, "MF"]], [[637, 637, "MP"], [640, 641, "MF"]], [[652, 653, "MP"], [663, 664, "MF"], [667, 667, "TP"], [672, 675, "MF"]], [[695, 695, "MP"], [714, 714, "MF"], [717, 718, "TP"]]], "relations": [[[1, 1, 10, 11, "RD"], [1, 1, 14, 14, "RD"], [1, 1, 22, 22, "ST"], [1, 1, 22, 22, "RF"], [1, 1, 134, 135, "CO"]], [[46, 47, 306, 307, "WR"], [44, 44, 51, 52, "CO"], [44, 44, 55, 56, "CO"], [46, 47, 182, 183, "CO"], [46, 47, 209, 209, "CO"]], [[55, 56, 72, 73, "WR"], [55, 56, 79, 81, "WR"], [55, 56, 96, 98, "WR"]], [[123, 124, 127, 127, "RD"], [123, 124, 127, 127, "WR"]], [[134, 135, 145, 145, "FR"], [145, 145, 150, 151, "EX"]], [[165, 165, 172, 172, "RD"], [165, 165, 158, 158, "EX"], [165, 165, 172, 172, "WR"]], [[182, 183, 192, 193, "WR"], [182, 183, 195, 196, "WR"], [182, 183, 255, 256, "EX"]], [[209, 209, 217, 217, "ST"], [209, 209, 217, 217, "RF"], [209, 209, 220, 221, "WR"]], [[230, 230, 255, 256, "CO"], [230, 230, 220, 221, "CO"]], [], [[270, 270, 279, 279, "CO"]], [], [[323, 323, 306, 307, "WR"], [323, 323, 306, 307, "WR"], [323, 323, 388, 390, "FR"], [328, 329, 306, 307, "WR"]], [[336, 338, 342, 342, "EX"], [336, 338, 381, 381, "CO"]], [[381, 381, 366, 366, "EX"], [381, 381, 375, 375, "WR"]], [[388, 390, 375, 375, "RD"], [388, 390, 375, 375, "EX"], [388, 390, 392, 395, "FR"], [392, 395, 402, 402, "WR"], [392, 395, 402, 402, "WR"], [392, 395, 419, 419, "WR"]], [[425, 426, 432, 433, "CO"]], [[440, 440, 402, 402, "WR"], [440, 440, 419, 419, "WR"], [440, 440, 443, 443, "EX"]], [[449, 450, 454, 454, "FR"], [449, 450, 464, 465, "EX"]], [[473, 474, 494, 496, "WR"]], [], [[503, 504, 514, 514, "EX"], [503, 504, 518, 519, "ST"], [503, 504, 518, 519, "RF"], [503, 504, 532, 532, "CO"]], [[532, 532, 545, 546, "FR"], [545, 546, 566, 566, "WR"], [545, 546, 579, 579, "WR"], [545, 546, 585, 586, "WR"]], [], [], [[605, 606, 566, 566, "WR"], [605, 606, 579, 579, "WR"], [605, 606, 585, 586, "WR"], [605, 606, 622, 623, "WR"], [605, 606, 625, 626, "WR"], [605, 606, 652, 653, "CO"]], [[637, 637, 640, 641, "WR"]], [[652, 653, 663, 664, "WR"], [652, 653, 667, 667, "FR"], [667, 667, 672, 675, "WR"], [672, 675, 714, 714, "CO"]], [[695, 695, 714, 714, "EX"], [695, 695, 714, 714, "UK"], [695, 695, 717, 718, "FR"]]]}