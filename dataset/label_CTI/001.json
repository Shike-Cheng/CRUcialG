{"doc_key": "001", "sentences": [["The", "email", "contains", "a", "ZIP", "attachment", "that", "holds", "a", "PE32", "executable", "."], ["The", "executable", ",", "written", "in", ".NET", ",", "functions", "as", "a", "downloader", "for", "the", "next", "stage", "of", "the", "infection", "chain", "."], ["When", "executed", ",", "the", "downloader", "reaches", "out", "to", "an", "IPFS", "gateway", "to", "retrieve", "a", "blob", "of", "data", "that", "has", "been", "hosted", "within", "the", "IPFS", "network", "as", "shown", "below", "."], ["This", "data", "contains", "an", "obfuscated", "PE32", "executable", "that", "functions", "as", "the", "next-stage", "malware", "payload", "."], ["The", "downloader", "takes", "the", "data", "from", "the", "IPFS", "gateway", "and", "stores", "each", "byte", "in", "an", "array", "."], ["It", "then", "uses", "a", "key", "value", "stored", "in", "the", "executable", "to", "convert", "the", "byte", "array", "into", "the", "next-stage", "PE32", "."], ["This", "is", "then", "reflectively", "loaded", "and", "executed", ",", "launching", "the", "next", "stage", "of", "the", "infection", "process", ",", "which", "in", "this", "case", "is", "a", "remote", "access", "trojan", "(", "RAT", ")", "called", "Agent", "Tesla", "."], ["In", "all", "three", "clusters", ",", "the", "initial", "payload", "functioned", "as", "a", "loader", "and", "operated", "similarly", ",", "however", ",", "the", "final", "payload", "hosted", "on", "the", "IPFS", "network", "was", "different", "in", "each", "cluster", "."], ["In", "most", "cases", ",", "the", "loader", "was", "not", "packed", ",", "but", "we", "did", "observe", "samples", "packed", "using", "UPX", "."], ["When", "executed", ",", "the", "loader", "first", "creates", "a", "directory", "structure", "within", "%", "APPDATA", "%", "using", "the", "following", "command", ":"], ["C", ":", "\\Windows\\system32\\cmd.exe", "/c", "cd", "%", "appdata", "%", "\\Microsoft", "&", "&", "mkdir", "Network"], ["The", "malware", "then", "attempts", "to", "retrieve", "Python", "3.10", "from", "the", "legitimate", "software", "provider", "using", "the", "cURL", "command", "."], ["The", "command", "line", "syntax", "used", "to", "initiate", "the", "download", "is", "shown", "below", "."], ["Once", "the", "ZIP", "archive", "has", "been", "retrieved", ",", "it", "is", "then", "unzipped", "into", "the", "directory", "that", "was", "previously", "created", "using", "the", "PowerShell", "``", "Expand-Archive", "''", "cmdlet", "."], ["C", ":", "\\Windows\\system32\\cmd.exe", "/c", "cd", "%", "appdata", "%", "\\Microsoft\\Network", "&", "&", "powershell", "Expand-Archive", "python-3.10.4-embed-amd64.zip", "-DestinationPath", "%", "appdata", "%", "\\Microsoft\\Network"], ["The", "malware", "then", "attempts", "to", "retrieve", "the", "final", "payload", "in", "the", "infection", "chain", ",", "storing", "it", "within", "the", "Network", "directory", "using", "the", "filename", "``", "Packages.txt", "''", "."], ["An", "example", "of", "the", "loader", "retrieving", "Hannabi", "Grabber", ",", "an", "information", "stealer", "written", "in", "Python", "is", "shown", "below", "."], ["The", "loader", "then", "uses", "the", "attrib.exe", "utility", "to", "set", "the", "System", "and", "Hidden", "flags", "on", "the", "previously", "created", "directory", "as", "well", "as", "the", "Python", "ZIP", "archive", "and", "final", "payload", "that", "was", "retrieved", "."], ["C", ":", "\\Windows\\system32\\cmd.exe", "/c", "attrib", "+S", "+H", "%", "appdata", "%", "\\Microsoft\\Network"], ["C", ":", "\\Windows\\system32\\cmd.exe", "/c", "attrib", "+S", "+H", "%", "appdata", "%", "\\Microsoft\\Network\\python-3.10.4-embed-amd64.zip"], ["C", ":", "\\Windows\\system32\\cmd.exe", "/c", "attrib", "+S", "+H", "%", "appdata", "%", "\\Microsoft\\Network\\Packages.txt"], ["Finally", ",", "the", "loader", "invokes", "the", "newly", "downloaded", "Python", "executable", "and", "passes", "the", "final", "payload", "as", "a", "command", "line", "argument", ",", "executing", "the", "next", "stage", "of", "the", "infection", "process", "."], ["C", ":", "\\Windows\\system32\\cmd.exe", "/c", "cd", "%", "appdata", "%", "\\Microsoft\\Network", "&", "&", "python.exe", "Packages.txt"], ["In", "some", "cases", ",", "the", "malware", "was", "also", "observed", "achieving", "persistence", "via", "adding", "entries", "into", "the", "Windows", "registry", "at", "the", "following", "locations", ":"], ["During", "our", "analysis", "of", "samples", "associated", "with", "this", "loader", ",", "we", "observed", "that", "the", "IPFS", "gateway", "that", "was", "being", "used", "was", "no", "longer", "servicing", "requests", ",", "however", ",", "Talos", "obtained", "the", "next-stage", "payloads", "manually", "via", "another", "IPFS", "gateways", "for", "analysis", "."], ["In", "one", "of", "the", "clusters", "leveraging", "this", "loader", ",", "we", "observed", "that", "the", "payload", "being", "hosted", "within", "the", "IPFS", "network", "was", "a", "Python", "script", "containing", "a", "large", "base64", "encoded", "blob", "along", "with", "the", "Python", "code", "responsible", "for", "decoding", "the", "base64", "."], ["After", "decoding", "all", "of", "the", "layers", ",", "the", "following", "is", "the", "deobfuscated", "reverse", "shell", "payload", "."], ["At", "the", "time", "of", "analysis", ",", "the", "C2", "server", "was", "no", "longer", "servicing", "requests", "on", "TCP/4444", "."], ["In", "another", "cluster", "we", "analyzed", ",", "we", "observed", "that", "the", "final", "payload", "hosted", "within", "IPFS", "was", "a", "Windows", "batch", "file", ",", "as", "shown", "below", ":"], ["When", "the", "batch", "file", "is", "retrieved", ",", "it", "is", "stored", "within", "the", "Network", "directory", "using", "the", "filename", "``", "Script.bat", "''", "."], ["Deleting", "volume", "shadow", "copies", "on", "the", "system", "."], ["Deleting", "directory", "contents", "stored", "within", "C", ":", "\\Users", "(", "typically", "associated", "with", "user", "profiles", ")", "."], ["Iterating", "through", "all", "mounted", "filesystems", "present", "on", "the", "system", "and", "deleting", "contents", "stored", "on", "them", "."], ["Fortunately", "for", "victims", ",", "in", "the", "samples", "analyzed", "the", "loader", "incorrectly", "attempts", "to", "invoke", "the", "batch", "file", "as", "shown", "below", "."], ["C", ":", "\\Windows\\system32\\cmd.exe", "/c", "cd", "%", "appdata", "%", "\\Microsoft\\Network", "&", "&", "powershell", "-Command", "start", "script.bat", "-Verb", "RunAs"], ["The", "final", "cluster", "of", "malware", "associated", "with", "this", "loader", "is", "responsible", "for", "retrieving", "and", "executing", "a", "Python-based", "information", "stealer", "called", "Hannabi", "Grabber", "."], ["It", "leverages", "Discord", "Webhooks", "for", "C2", "and", "data", "exfiltration", "."], ["It", "collects", "survey", "information", "from", "the", "infected", "machine", ",", "obtains", "the", "geographic", "location", "of", "the", "system", "via", "the", "IPInfo", "service", ",", "takes", "screenshots", "and", "eventually", "transmits", "that", "data", "to", "an", "attacker-controlled", "Discord", "server", "in", "JSON", "format", "."], ["In", "addition", "to", "the", "previously", "listed", "applications", ",", "the", "malware", "also", "supports", "retrieving", "password", "and", "cookie", "data", "from", "Chrome", ",", "as", "shown", "below", "."], ["Similar", "functionality", "also", "exists", "to", "target", "Mozilla", "Firefox", "browser", "data", "that", "may", "be", "present", "on", "the", "system", "."], ["The", "information", "stealer", "is", "particularly", "interested", "in", "Discord", "and", "Roblox", "data", "."], ["If", "discovered", ",", "the", "malware", "will", "attempt", "to", "bypass", "them", "to", "obtain", "Discord", "tokens", "from", "the", "victim", "."], ["Application", "data", "that", "is", "collected", "is", "stored", "within", "a", "directory", "structure", "inside", "of", "the", "%", "TEMP", "%", "directory", ",", "in", "a", "folder", "called", "``", "RedDiscord", "''", "that", "is", "created", "by", "the", "malware", "."], ["Before", "exfiltrating", "the", "data", ",", "the", "malware", "creates", "a", "ZIP", "archive", "within", "the", "RedDiscord", "directory", "called", "``", "Hannabi-", "<", "USERNAME", ">", ".zip", "''", "."], ["The", "malware", "first", "transmits", "beacon", "information", "and", "will", "then", "attempt", "to", "exfiltrate", "the", "newly", "created", "ZIP", "archive", "."], ["Typically", ",", "attackers", "will", "attempt", "to", "leverage", "PyInstaller", "or", "Py2EXE", "to", "compile", "their", "Python", "into", "a", "PE32", "file", "format", "prior", "to", "distributing", "it", "to", "victims", "."], ["This", "is", "a", "case", "where", "instead", ",", "the", "attacker", "chose", "to", "include", "a", "Python", "installation", "process", "during", "the", "infection", "and", "is", "leveraging", "Python", "directly", "to", "steal", "sensitive", "information", "from", "victims", "."]], "ner": [[[1, 1, "SO"], [9, 10, "MF"]], [[13, 13, "MF"]], [[36, 36, "MP"], [41, 42, "SO"], [48, 48, "MF"]], [[62, 62, "MF"], [66, 67, "MF"]], [[77, 77, "MP"], [80, 80, "MF"], [83, 84, "SO"]], [[93, 93, "MP"], [102, 102, "MF"], [111, 111, "MF"]], [[113, 113, "MP"], [136, 138, "MP"], [140, 140, "MP"], [143, 144, "MP"]], [[153, 153, "MP"], [166, 166, "MF"], [170, 171, "SO"]], [[183, 183, "MP"]], [[201, 201, "MP"], [208, 210, "SF"]], [], [[230, 230, "MP"], [235, 236, "TF"], [240, 241, "SO"]], [], [[262, 263, "TF"], [268, 268, "TF"]], [], [[307, 307, "MP"], [314, 314, "MF"], [321, 321, "MF"]], [], [[353, 353, "MP"], [357, 357, "TP"], [375, 377, "TF"], [380, 380, "MF"]], [], [], [], [[421, 421, "MP"], [426, 427, "TP"], [432, 432, "MF"]], [], [[466, 466, "MP"], [477, 478, "SF"]], [], [[532, 532, "MP"], [538, 538, "MF"], [543, 544, "SO"]], [], [], [[610, 610, "MF"], [613, 613, "SO"], [616, 618, "MF"]], [[626, 627, "MF"], [631, 631, "MF"], [642, 642, "MP"]], [[646, 648, "SF"]], [[658, 660, "SF"]], [[672, 673, "SF"], [683, 683, "SF"]], [], [], [[727, 727, "MP"], [731, 731, "MP"], [743, 744, "MP"]], [[746, 746, "MP"], [748, 749, "MP"], [751, 751, "SO"]], [[756, 756, "MP"], [774, 775, "TP"], [787, 788, "SO"]], [[802, 802, "MP"], [811, 811, "SF"]], [[823, 824, "SF"]], [[842, 842, "SF"], [844, 844, "SF"]], [[851, 851, "MP"], [856, 856, "SF"]], [[866, 866, "TF"], [888, 890, "TF"]], [[901, 901, "TF"], [904, 904, "MP"], [907, 908, "TF"], [914, 920, "TF"]], [[923, 923, "MP"], [926, 927, "TF"], [937, 938, "TF"]], [[942, 942, "MP"], [947, 947, "TP"], [949, 949, "TP"], [953, 953, "MF"], [956, 957, "MF"]], [[974, 974, "MP"], [979, 980, "TF"], [988, 988, "TP"], [992, 993, "TF"]]], "relations": [[[9, 10, 102, 102, "CO"]], [], [[36, 36, 1, 1, "ST"], [36, 36, 1, 1, "RF"], [36, 36, 13, 13, "EX"], [36, 36, 41, 42, "ST"], [36, 36, 41, 42, "RF"], [48, 48, 66, 67, "CO"], [48, 48, 62, 62, "CO"], [48, 48, 80, 80, "CO"], [41, 42, 83, 84, "CO"]], [], [[77, 77, 80, 80, "WR"], [77, 77, 83, 84, "ST"], [77, 77, 83, 84, "RF"], [77, 77, 93, 93, "CO"], [77, 77, 136, 138, "CO"], [77, 77, 140, 140, "CO"], [77, 77, 113, 113, "CO"], [77, 77, 143, 144, "CO"]], [[93, 93, 111, 111, "WR"]], [], [[153, 153, 111, 111, "RD"], [153, 153, 166, 166, "WR"], [153, 153, 166, 166, "WR"], [153, 153, 170, 171, "ST"], [153, 153, 170, 171, "RF"]], [[183, 183, 166, 166, "WR"], [183, 183, 170, 171, "ST"], [183, 183, 170, 171, "RF"], [183, 183, 170, 171, "ST"], [183, 183, 208, 210, "RD"], [183, 183, 170, 171, "RF"], [183, 183, 201, 201, "CO"], [183, 183, 201, 201, "CO"], [183, 183, 353, 353, "CO"], [183, 183, 421, 421, "CO"], [183, 183, 532, 532, "CO"]], [[201, 201, 208, 210, "WR"], [201, 201, 230, 230, "CO"], [201, 201, 307, 307, "CO"]], [], [[230, 230, 235, 236, "WR"], [230, 230, 240, 241, "ST"], [230, 230, 240, 241, "RF"], [230, 230, 262, 263, "RD"], [230, 230, 262, 263, "WR"], [235, 236, 268, 268, "CO"], [235, 236, 262, 263, "CO"]], [], [], [], [[307, 307, 314, 314, "RD"], [307, 307, 314, 314, "WR"], [314, 314, 321, 321, "CO"]], [], [[353, 353, 357, 357, "FR"], [357, 357, 375, 377, "CD"], [357, 357, 380, 380, "CD"]], [], [], [], [[421, 421, 426, 427, "FR"], [426, 427, 375, 377, "EX"], [426, 427, 432, 432, "RD"]], [], [[466, 466, 477, 478, "RD"], [466, 466, 477, 478, "WR"], [466, 466, 727, 727, "CO"], [466, 466, 802, 802, "CO"], [466, 466, 851, 851, "CO"], [466, 466, 923, 923, "CO"]], [], [[532, 532, 477, 478, "RD"], [532, 532, 477, 478, "RD"], [532, 532, 477, 478, "WR"], [532, 532, 538, 538, "WR"], [532, 532, 538, 538, "WR"], [532, 532, 543, 544, "ST"], [532, 532, 543, 544, "RF"], [543, 544, 613, 613, "CO"]], [], [], [[610, 610, 616, 618, "CO"]], [[642, 642, 538, 538, "WR"], [642, 642, 613, 613, "ST"], [642, 642, 646, 648, "RD"], [642, 642, 613, 613, "RF"], [642, 642, 658, 660, "RD"], [642, 642, 646, 648, "WR"], [642, 642, 672, 673, "RD"], [642, 642, 658, 660, "WR"], [642, 642, 672, 673, "WR"], [626, 627, 631, 631, "CO"]], [], [], [[672, 673, 683, 683, "CO"]], [], [], [[727, 727, 743, 744, "FR"], [731, 731, 743, 744, "CO"], [731, 731, 746, 746, "CO"], [731, 731, 756, 756, "CO"]], [[746, 746, 748, 749, "FR"], [748, 749, 751, 751, "ST"], [748, 749, 751, 751, "RF"]], [[756, 756, 774, 775, "IJ"], [756, 756, 787, 788, "ST"], [756, 756, 787, 788, "RF"]], [[802, 802, 811, 811, "RD"], [802, 802, 811, 811, "RD"], [802, 802, 811, 811, "WR"], [802, 802, 823, 824, "RD"], [802, 802, 823, 824, "RD"], [802, 802, 823, 824, "WR"], [802, 802, 842, 842, "RD"], [802, 802, 842, 842, "RD"], [802, 802, 842, 842, "WR"], [802, 802, 842, 842, "RD"], [802, 802, 844, 844, "RD"], [802, 802, 844, 844, "WR"]], [], [[842, 842, 844, 844, "CO"], [842, 842, 856, 856, "CO"]], [[851, 851, 888, 890, "WR"], [851, 851, 904, 904, "CO"]], [[866, 866, 888, 890, "CO"], [866, 866, 901, 901, "CO"]], [[904, 904, 907, 908, "WR"], [907, 908, 914, 920, "CO"], [907, 908, 937, 938, "CO"]], [[923, 923, 907, 908, "RD"]], [[942, 942, 947, 947, "FR"], [942, 942, 949, 949, "FR"], [947, 947, 953, 953, "RD"], [949, 949, 953, 953, "RD"], [947, 947, 956, 957, "WR"], [949, 949, 956, 957, "WR"], [942, 942, 974, 974, "CO"]], [[974, 974, 988, 988, "FR"], [974, 974, 992, 993, "WR"]]]}