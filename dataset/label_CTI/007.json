{"doc_key": "007", "sentences": [["Initial", "Access"], ["Malicious", "VBS", "macros", "concealed", "within", "remote", "templates", "execute", "when", "the", "user", "opens", "the", "document", "."], ["The", "macros", "download", "RAR", "archives", "containing", "LNK", "files", "."], ["These", "compressed", "archives", "usually", "contain", "just", "the", "LNK", "file", "."], ["Once", "opened", ",", "the", "LNKs", "will", "attempt", "to", "execute", "MSHTA.EXE", "to", "download", "and", "parse", "a", "remote", "XML", "file", "to", "execute", "a", "malicious", "PowerShell", "script", ":"], ["Gamaredon", "is", "known", "to", "use", "the", "domain", "xsph.ru", "."], ["The", "servers", "in", "this", "campaign", "only", "allow", "access", "from", "IP", "addresses", "inside", "the", "Ukrainian", "address", "space", "."], ["This", "PowerShell", "script", "decodes", "and", "executes", "a", "second", "PowerShell", "script", "(", "instrumentor", ")", ",", "which", "collects", "data", "from", "the", "victim", "and", "reports", "back", "to", "a", "remote", "server", "."], ["This", "script", "also", "allows", "the", "remote", "server", "to", "send", "a", "PowerShell", "command", "or", "binary", "blob", "containing", "encrypted", "VBScript", "(", "VBS", ")", "code", "to", "be", "executed", "locally", ":"], ["Second-stage", "PowerShell", "script", "that", "runs", "additional", "commands", "and", "payloads", "on", "the", "endpoint", "."], ["The", "instrumentor", "PowerShell", "script", "usually", "consists", "of", "a", "function", "that", "decodes", "the", "encrypted", "response", "from", "the", "command", "and", "control", "(", "C2", ")", "server", "and", "executes", "it", "as", "a", "VBScript", "object", "."], ["The", "PowerShell", "script", "also", "repeatedly", "captures", "the", "current", "user", "'s", "screen", "."], ["This", "code", "uses", "the", "``", "System.Windows.Forms", "''", "object", "to", "capture", "a", "copy", "of", "the", "virtual", "desktop", ",", "including", "setups", "with", "multiple", "screens", "."], ["The", "screen", "capture", "is", "executed", "nine", "times", ",", "but", "the", "resulting", "screenshot", "is", "always", "saved", "to", "``", "%", "TEMP", "%", "\\test.png", "''", ",", "which", "gets", "overwritten", "every", "time", "."], ["The", "resulting", "image", "(", "PNG", "file", ")", "is", "then", "converted", "to", "a", "base64-encoded", "string", ",", "stored", "in", "a", "variable", "and", "the", "screenshot", "image", "file", "is", "removed", "from", "the", "disk", "."], ["The", "script", "then", "proceeds", "to", "upload", "the", "victim", "'s", "information", "to", "the", "remote", "server", "."], ["The", "following", "information", "is", "then", "collected", "and", "exfiltrated", "to", "a", "hardcoded", "C2", "URL", "."], ["Upon", "sending", "the", "system", "information", ",", "the", "server", "response", "is", "parsed", "to", "see", "if", "there", "are", "commands", "to", "be", "executed", "."], ["If", "so", ",", "the", "remainder", "of", "the", "response", "is", "expected", "to", "be", "a", "PowerShell", "code", "that", "is", "passed", "directly", "to", "the", "command", "IEX", "."], ["The", "output", "of", "that", "command", "is", "then", "added", "to", "the", "variable", "``", "cmd", "''", "and", "sent", "back", "to", "the", "C2", "server", "."], ["If", "the", "response", "starts", "with", "any", "other", "character", ",", "it", "is", "treated", "as", "an", "encrypted", "blob", "and", "passed", "to", "the", "decoder", "function", ",", "along", "with", "the", "volume", "serial", "number", "to", "be", "decoded", "and", "executed", "as", "VBScript", "."], ["One", "of", "the", "payloads", "served", "to", "the", "instrumentor", "script", "was", "PowerShell", "code", "used", "to", "set", "an", "environmental", "variable", "with", "PowerShell", "code", "in", "it", "and", "a", "Registry", "RUN", "key", "to", "run", "every", "time", "the", "user", "logs", "in", "."], ["PowerShell", "script", "setting", "up", "the", "RUN", "key", "to", "execute", "another", "PowerShell", "script", "stored", "in", "the", "environment", "variable", "."], ["The", "Get-IP", "function", ":", "This", "function", "queries", "a", "DNS", "lookup", "service", "for", "an", "attacker-specified", "domain", "and", "uses", "one", "of", "the", "returned", "IP", "addresses", "as", "the", "IP", "to", "download", "the", "next", "payloads", "."], ["Next-stage", "payload", ":", "The", "PowerShell", "script", "uses", "the", "IP", "address", "to", "construct", "a", "URL", "that", "serves", "the", "next-stage", "PowerShell", "script", ",", "which", "is", "subsequently", "stored", "in", "``", "$", "env", ":", "Include", "''", "and", "executed", "when", "the", "user", "logs", "in", "(", "via", "the", "HKCU\\\\Run", "key", ")", "."], ["Persistence", "script", "fetching", "the", "remote", "location", "'s", "IP", "."], ["The", "PowerShell", "code", "residing", "in", "the", "environment", "variable", "is", "meant", "to", "provide", "the", "attackers", "with", "continued", "access", "to", "the", "infected", "endpoint", "with", "the", "capability", "to", "deploy", "additional", "payloads", "as", "desired", "."], ["PowerShell", "script", "stored", "in", "the", "env", "variable", "."], ["This", "script", "uses", "the", "same", "Get-IP", "(", ")", "function", "to", "get", "a", "random", "IP", "assigned", "to", "the", "domain", "and", "queries", "a", "URL", "constructed", "from", "the", "IP", "address", "and", "a", "hardcoded", "extended", "resource", "."], ["Just", "like", "the", "previous", "script", ",", "the", "computer", "name", "and", "volume", "serial", "number", "are", "used", "again", "in", "communications", "with", "the", "C2", "server", "."], ["The", "C2", "server", "uses", "them", "to", "encode", "the", "next-stage", "payload", "subsequently", "served", "to", "the", "script", "."], ["If", "the", "response", "from", "the", "C2", "starts", "with", "the", "string", "``", "http", "''", ",", "the", "content", "is", "treated", "as", "the", "URL", "to", "download", "the", "final", "payload", "binary", "."], ["The", "Volume", "Serial", "Number", "and", "Computer", "Name", "are", "passed", "to", "this", "URL", "and", "the", "response", "is", "decoded", "using", "the", "XorBytes", "function", "."], ["The", "decrypted", "binary", "is", "then", "saved", "to", "the", "``", "%", "TEMP", "%", "''", "folder", "with", "a", "name", "consisting", "of", "a", "random", "string", "of", "numbers", "and", "the", "``", ".exe", "''", "file", "extension", "and", "is", "executed", "."], ["Alternatively", ",", "if", "the", "response", "from", "the", "C2", "does", "not", "begin", "with", "the", "``", "http", "''", "string", ",", "the", "content", "is", "treated", "as", "a", "VBS", "and", "executed", "via", "a", "COM", "object", "."], ["One", "of", "the", "executables", "deployed", "by", "the", "attackers", "via", "the", "PowerShell", "script", "consisted", "of", "an", "information", "stealer", "that", "exfiltrates", "files", "of", "specific", "extensions", "from", "the", "infected", "endpoint", ":", ".doc", ",", ".docx", ",", ".xls", ",", ".rtf", ",", ".odt", ",", ".txt", ",", ".jpg", ",", ".jpeg", ",", ".pdf", ",", ".ps1", ",", ".rar", ",", ".zip", ",", ".7z", "and", ".mdb", "."], ["The", "malicious", "binary", "keeps", "track", "of", "what", "has", "been", "exfiltrated", "in", "a", "file", "named", "``", "profiles_c.ini", "''", "in", "the", "``", "%", "USERPROFILE", "%", "\\Appdata\\Local", "''", "folder", "."], ["The", "malware", "stores", "the", "MD5", "hash", "of", "a", "string", "containing", "the", "filename", ",", "file", "size", "and", "modification", "date", "of", "the", "exfiltrated", "file", "."], ["Once", "started", ",", "the", "malware", "scans", "all", "attached", "storage", "devices", "looking", "for", "files", "with", "the", "aforementioned", "extensions", "."], ["For", "each", "one", ",", "the", "malware", "makes", "a", "POST", "request", "with", "metadata", "about", "the", "exfiltrated", "file", "and", "its", "content", "."], ["POST", "data", "to", "exfiltrate", "files", "."], ["The", "raw", "content", "of", "the", "file", "comes", "after", "the", "metadata", "."], ["The", "request", "is", "made", "to", "a", "random", "URI", "under", "the", "parent", "C2", "domain", "."], ["The", "implant", "generates", "a", "random", "12-character", "string", "that", "acts", "as", "a", "subdomain", "for", "the", "C2", "domain", "to", "send", "requests", "to", ":"], ["The", "implant", "will", "also", "search", "for", "the", "relevant", "file", "extensions", "in", "fixed", "and", "remote", "drives", "and", "specifically", "in", "the", "``", "C", ":", "\\Users", "''", "folder", "."], ["The", "implant", "enumerates", "all", "the", "files", "recursively", "in", "the", "directories", "on", "the", "system", "while", "avoiding", "enumeration", "of", "any", "folder", "containing", "the", "following", "strings", "in", "the", "path", ":"], ["Avoiding", "these", "folders", "is", "likely", "an", "attempt", "by", "the", "malware", "to", "avoid", "exfiltrating", "system", "files", "thereby", "focussing", "on", "user", "files", "of", "interest", "only", "."], ["For", "each", "file", "exfiltrated", "to", "the", "C2", ",", "the", "implant", "calculates", "the", "MD5", "hash", "for", "the", "following", "information", "and", "stores", "it", "in", "the", "``", "%", "LocalAppData", "%", "\\profiles_c.ini", "''", "file", ":"], ["The", "implant", "also", "steals", "files", "from", "removable", "drives", "connected", "to", "the", "infected", "endpoint", "."], ["When", "the", "implant", "finds", "a", "removable", "drive", ",", "it", "looks", "for", "files", "with", "the", "file", "extensions", "listed", "earlier", "."], ["Once", "a", "file", "is", "found", ",", "the", "implant", "creates", "a", "randomly", "named", "folder", "in", "the", "%", "TEMP", "%", "directory", "and", "copies", "the", "original", "file", "from", "its", "original", "location", "to", ":"], ["%", "Temp", "%", "\\", "<", "randomly_named_folder", ">", "\\connect\\", "<", "removable_vol_serial_number", ">", "\\", "<", "original", "file", "path", ">"], ["For", "example", ",", "a", "user", "file", "found", "in", "a", "remote", "drive", "``", "E", ":", "''", "at", "path", "``", "E", ":", "\\top_secret_docs\\isengard.doc", "''", "will", "be", "copied", "to"], ["``", "%", "temp", "%", "\\randomly_named_folder\\connect\\", "<", "removable_vol_serial_number", ">", "\\top_secret_docs\\isengard.doc", "''"], ["The", "contents", "of", "the", "folder", "in", "the", "temp", "directory", "are", "subsequently", "exfiltrated", "to", "the", "C2", "."], ["DELIVER", "PAYLOADS"], ["As", "with", "this", "actor", "'s", "previous", "tools", "(", "e.g.", ",", "the", "PS1", "scripts", ")", ",", "this", "binary", "also", "parses", "the", "server", "response", "and", "downloads", "additional", "payloads", "if", "requested", "."], ["The", "response", "from", "the", "server", "consists", "of", "a", "flag", "indicating", "how", "the", "data", "should", "be", "treated", ":"], ["1", "EXE", "Written", "to", "disk", "and", "executed", "."], ["2", "VBS", "Written", "to", "disk", "and", "executed", "using", "wscript.exe", "."], ["Any", "other", "value", "Blob", "of", "data", "Written", "to", "a", "file", "on", "disk", "in", "the", "%", "TEMP", "%", "folder", "."], ["A", "registry", "key", "is", "created", "under", "HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", "with", "the", "name", "``", "Windows", "Task", "''", "for", "persistence"], ["A", "mutex", "is", "created", "with", "the", "name", "Global\\flashupdate_r"]], "ner": [[], [[3, 4, "MF"], [12, 12, "TP"], [15, 15, "MF"]], [[18, 18, "MP"], [20, 21, "MF"], [23, 24, "MF"]], [[28, 28, "MF"], [33, 34, "MF"]], [[40, 40, "MP"], [45, 45, "MP"], [52, 53, "MF"], [58, 59, "MP"]], [[61, 61, "MP"], [67, 68, "SO"]], [[71, 71, "SO"], [74, 74, "MP"]], [[88, 89, "MP"], [95, 96, "MP"], [106, 106, "SF"], [112, 113, "SO"]], [[116, 116, "MP"], [120, 121, "SO"], [125, 126, "MF"], [128, 129, "MF"], [132, 135, "MF"]], [[143, 144, "MP"]], [[157, 158, "MP"], [167, 168, "MF"], [171, 177, "SO"], [180, 180, "MF"], [183, 184, "MF"]], [[187, 188, "MP"]], [[199, 199, "MP"]], [[222, 223, "MP"], [237, 242, "TF"]], [[251, 256, "TF"], [262, 263, "TF"], [271, 273, "TF"]], [[281, 281, "MP"], [287, 289, "TF"], [292, 293, "SO"]], [[297, 297, "TF"], [306, 307, "SO"]], [[312, 313, "TF"], [316, 317, "SO"]], [[343, 344, "MF"]], [[365, 367, "TP"], [373, 374, "SO"]], [[385, 385, "MF"], [391, 391, "MF"], [396, 397, "MP"], [402, 404, "SF"], [411, 411, "MP"]], [[416, 416, "MF"], [420, 421, "MP"], [423, 424, "MF"], [429, 430, "SF"], [435, 435, "MF"], [438, 440, "SF"]], [[450, 451, "MP"], [455, 456, "SF"], [460, 461, "MF"]], [[469, 470, "MP"], [473, 473, "MP"], [481, 482, "SO"], [489, 490, "SO"], [493, 493, "SO"], [498, 498, "MF"]], [[504, 505, "MP"], [518, 519, "MP"], [526, 531, "TF"]], [], [[556, 557, "MP"]], [[586, 587, "MF"]], [[595, 595, "MP"]], [[634, 635, "SF"], [637, 639, "SF"], [647, 648, "SO"]], [], [[686, 686, "SO"], [691, 692, "MF"]], [], [[717, 718, "MF"]], [], [[786, 786, "MP"], [790, 790, "MP"], [798, 799, "MP"], [802, 805, "SF"], [811, 837, "SF"]], [[840, 841, "MP"], [853, 855, "TF"]], [[867, 867, "MP"]], [[893, 893, "MP"], [897, 898, "SF"], [901, 905, "SF"]], [[912, 912, "MP"]], [], [], [], [[959, 959, "MP"]], [[980, 980, "MP"], [987, 990, "SF"], [992, 993, "SF"], [998, 1002, "SF"]], [[1006, 1006, "MP"]], [], [[1058, 1058, "SF"], [1062, 1062, "SO"], [1065, 1065, "MP"], [1079, 1084, "TF"]], [[1088, 1088, "MP"], [1091, 1091, "SF"]], [[1103, 1103, "MP"], [1109, 1109, "MP"], [1112, 1112, "SF"]], [[1122, 1122, "SF"], [1127, 1127, "MP"], [1135, 1138, "TF"]], [], [[1171, 1172, "SF"]], [], [[1204, 1207, "SF"], [1217, 1217, "SO"]], [], [[1227, 1227, "MF"], [1232, 1233, "MF"], [1237, 1237, "MP"], [1246, 1246, "MF"]], [[1254, 1254, "SO"]], [[1268, 1268, "MF"]], [[1276, 1276, "MF"], [1283, 1283, "MP"]], [[1288, 1290, "MF"]], [[1310, 1310, "SF"]], [[1321, 1321, "MF"], [1327, 1327, "MF"]]], "relations": [[], [[12, 12, 18, 18, "FR"], [3, 4, 15, 15, "CO"]], [[18, 18, 15, 15, "EX"], [18, 18, 20, 21, "WR"], [20, 21, 23, 24, "CO"]], [[28, 28, 33, 34, "CO"]], [[40, 40, 45, 45, "FR"], [45, 45, 52, 53, "WR"], [45, 45, 58, 59, "FR"], [58, 59, 67, 68, "ST"], [58, 59, 67, 68, "RF"], [58, 59, 71, 71, "ST"], [58, 59, 71, 71, "RF"]], [[61, 61, 74, 74, "CO"]], [], [[88, 89, 67, 68, "ST"], [88, 89, 67, 68, "RF"], [88, 89, 71, 71, "ST"], [88, 89, 71, 71, "RF"], [88, 89, 95, 96, "FR"], [95, 96, 106, 106, "RD"], [95, 96, 112, 113, "ST"]], [[116, 116, 120, 121, "ST"], [116, 116, 120, 121, "RF"], [116, 116, 125, 126, "WR"], [116, 116, 128, 129, "WR"], [116, 116, 132, 135, "EX"], [116, 116, 157, 158, "FR"]], [[143, 144, 132, 135, "RD"], [143, 144, 157, 158, "CO"]], [[157, 158, 125, 126, "EX"], [157, 158, 167, 168, "WR"], [157, 158, 171, 177, "ST"], [157, 158, 171, 177, "RF"], [157, 158, 180, 180, "EX"], [180, 180, 183, 184, "CO"]], [[187, 188, 199, 199, "CO"], [187, 188, 281, 281, "CO"]], [[199, 199, 222, 223, "FR"]], [[222, 223, 237, 242, "WR"], [222, 223, 251, 256, "RD"], [222, 223, 262, 263, "WR"], [222, 223, 271, 273, "UK"], [237, 242, 271, 273, "CO"], [237, 242, 251, 256, "CO"]], [], [[281, 281, 287, 289, "RD"], [281, 281, 292, 293, "ST"], [281, 281, 297, 297, "RD"], [281, 281, 306, 307, "ST"], [281, 281, 316, 317, "RF"]], [[297, 297, 312, 313, "CO"]], [], [], [[365, 367, 343, 344, "EX"], [365, 367, 373, 374, "ST"]], [[396, 397, 391, 391, "RD"], [396, 397, 402, 404, "RD"], [396, 397, 411, 411, "FR"], [411, 411, 416, 416, "WR"], [385, 385, 391, 391, "CO"]], [[420, 421, 429, 430, "RD"], [420, 421, 416, 416, "WR"], [420, 421, 438, 440, "RD"], [420, 421, 429, 430, "WR"], [420, 421, 438, 440, "WR"], [420, 421, 450, 451, "FR"], [423, 424, 435, 435, "CO"]], [[450, 451, 455, 456, "RD"], [450, 451, 423, 424, "EX"], [450, 451, 455, 456, "WR"], [450, 451, 460, 461, "EX"]], [[473, 473, 481, 482, "ST"], [473, 473, 481, 482, "RF"], [473, 473, 493, 493, "ST"], [473, 473, 493, 493, "RF"], [473, 473, 498, 498, "WR"], [469, 470, 473, 473, "CO"], [489, 490, 493, 493, "CO"]], [[504, 505, 518, 519, "FR"], [518, 519, 526, 531, "WR"]], [], [[556, 557, 526, 531, "RD"], [556, 557, 586, 587, "WR"], [556, 557, 586, 587, "WR"]], [], [[595, 595, 586, 587, "WR"], [595, 595, 634, 635, "RD"], [595, 595, 637, 639, "RD"], [595, 595, 647, 648, "ST"], [595, 595, 686, 686, "RF"], [595, 595, 686, 686, "RF"], [595, 595, 686, 686, "RF"], [595, 595, 686, 686, "RF"], [595, 595, 691, 692, "WR"], [595, 595, 717, 718, "WR"], [595, 595, 717, 718, "EX"]], [], [], [], [], [], [], [[790, 790, 786, 786, "FR"], [798, 799, 802, 805, "RD"], [786, 786, 798, 799, "CO"], [802, 805, 811, 837, "CO"], [802, 805, 901, 905, "CO"]], [[840, 841, 853, 855, "WR"], [840, 841, 867, 867, "CO"]], [], [[893, 893, 897, 898, "RD"], [893, 893, 912, 912, "CO"]], [[912, 912, 897, 898, "RD"], [912, 912, 897, 898, "RD"], [912, 912, 897, 898, "WR"], [912, 912, 987, 990, "RD"], [912, 912, 987, 990, "RD"], [912, 912, 987, 990, "WR"]], [], [], [], [[959, 959, 897, 898, "RD"], [959, 959, 897, 898, "RD"], [959, 959, 897, 898, "WR"], [959, 959, 987, 990, "RD"], [959, 959, 987, 990, "RD"], [959, 959, 992, 993, "RD"], [959, 959, 998, 1002, "RD"], [959, 959, 980, 980, "CO"]], [[980, 980, 987, 990, "RD"], [980, 980, 987, 990, "WR"], [980, 980, 987, 990, "RD"], [980, 980, 987, 990, "WR"], [980, 980, 992, 993, "RD"], [980, 980, 992, 993, "WR"], [980, 980, 998, 1002, "RD"], [980, 980, 998, 1002, "WR"]], [[1006, 1006, 987, 990, "RD"], [1006, 1006, 987, 990, "RD"], [1006, 1006, 987, 990, "WR"], [1006, 1006, 992, 993, "RD"], [1006, 1006, 992, 993, "RD"], [1006, 1006, 992, 993, "WR"], [1006, 1006, 998, 1002, "RD"], [1006, 1006, 998, 1002, "RD"], [1006, 1006, 998, 1002, "WR"], [1006, 1006, 1065, 1065, "CO"], [1006, 1006, 1088, 1088, "CO"], [1006, 1006, 1109, 1109, "CO"], [1006, 1006, 1103, 1103, "CO"], [1006, 1006, 1127, 1127, "CO"]], [], [[1065, 1065, 1058, 1058, "RD"], [1065, 1065, 1062, 1062, "ST"], [1065, 1065, 1079, 1084, "WR"]], [[1088, 1088, 1091, 1091, "RD"], [1091, 1091, 1112, 1112, "CO"], [1091, 1091, 1122, 1122, "CO"], [1091, 1091, 1171, 1172, "CO"]], [[1109, 1109, 1112, 1112, "RD"]], [[1127, 1127, 1122, 1122, "RD"], [1127, 1127, 1135, 1138, "WR"], [1127, 1127, 1204, 1207, "RD"], [1127, 1127, 1217, 1217, "ST"]], [], [], [], [], [], [[1237, 1237, 1246, 1246, "WR"], [1237, 1237, 1254, 1254, "RF"], [1237, 1237, 1268, 1268, "WR"], [1237, 1237, 1283, 1283, "FR"], [1237, 1237, 1310, 1310, "RD"], [1237, 1237, 1288, 1290, "WR"], [1237, 1237, 1310, 1310, "WR"], [1237, 1237, 1327, 1327, "WR"], [1227, 1227, 1232, 1233, "CO"]], [], [], [[1283, 1283, 1276, 1276, "WR"], [1283, 1283, 1276, 1276, "EX"]], [], [], [[1321, 1321, 1327, 1327, "CO"]]]}