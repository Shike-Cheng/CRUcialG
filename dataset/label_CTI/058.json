{"doc_key": "058", "sentences": [["An", "overview", "of", "LNK", "file", "formatMicrosoft", "describes", "the", "Shell", "Link", "binary", "file", "format", "-", "the", "format", "used", "by", "Windows", "files", "with", "the", "extension", "``", "LNK", "''", "-", "as", "a", "file", "which", "contains", "information", "that", "can", "be", "used", "by", "the", "Operating", "System", "or", "an", "application", "to", "access", "another", "data", "object", "on", "the", "system", "."], ["The", "LNK", "structure", "stores", "information", "about", "the", "target", "object", "as", "well", "as", "other", "related", "information", "about", "the", "application", "behavior", "and", "metadata", "from", "the", "machine", "where", "the", "LNK", "file", "was", "created", "."], ["Sometimes", ",", "when", "the", "target", "information", "is", "not", "present", "on", "the", "LNK", "file", ",", "we", "might", "need", "to", "look", "at", "the", "Metadata", "Store", "structure", "for", "additional", "data", "."], ["SharPersist", "PayloadFigure", "1", ":", "SharPersist", "payloadIn", "Figure", "1", "we", "can", "see", "the", "MAC", "timestamps", "are", "empty", ",", "but", "the", "LNK", "file", "still", "contains", "information", "about", "the", "relative", "path", "where", "the", "file", "was", "created", ",", "as", "well", "as", "the", "SID", "of", "the", "user", "who", "created", "the", "file", "."], ["Quantum", "Builder", "PayloadFigure", "2", ":", "Quantum", "builder", "payloadIn", "Figure", "2", ",", "we", "can", "see", "the", "Quantum", "Builder", "does", "not", "attempt", "to", "wipe", "out", "any", "metadata", "and", "the", "generated", "LNK", "file", "contains", "a", "trove", "of", "metadata", "about", "the", "system", "where", "it", "was", "created", "."], ["A", "quick", "search", "for", "that", "MAC", "address", "indicates", "it", "is", "from", "a", "VMWare", "virtual", "network", "card", "."], ["In", "Figure", "3", ",", "the", "LNK", "target", "is", "pointing", "to", "a", "DLL", "file", "on", "a", "remote", "share", "but", "since", "this", "is", "a", "malformed", "file", "created", "to", "exploit", "a", "bug", ",", "the", "parsing", "tools", "can", "not", "see", "the", "payload", "."], ["A", "simple", "YARA", "rule", "could", "be", "used", "to", "detect", "such", "samples", ":", "rule", "lnk_wiped", "{", "meta", ":", "author=", "''", "gvenere", "''", "description=", "''", "LNK", "with", "wiped", "metadata", "''", "strings", ":", "$", "lnk_magic", "=", "{", "4c", "00", "00", "00", "}", "$", "ext1", "=", "``", ".js", "''", "//", "additional", "strings", "to", "search", "$", "ext2", "=", "``", ".bat", "''", "//", "in", "the", "LNK", "target", "area", "$", "ext3", "=", "``", ".cmd", "''", "//", "These", "are", "for", "Qakbotcondition", ":", "$", "lnk_magic", "at", "0x0", "anduint16", "(", "0x1c", ")", "==", "0x0", "and", "//", "CreationTime", "==", "0x0uint16", "(", "0x24", ")", "==", "0x0", "and", "//", "AccessTime", "==", "0x0uint16", "(", "0x2c", ")", "==", "0x0", "and", "//", "WriteTime", "==", "0x0//", "To", "target", "specific", "families", "we", "can", "add", "additional", "check"], ["0x100", ")", ")", "}", "Other", "tools", "use", "the", "proper", "methods", "to", "create", "these", "files", ",", "but", "that", "opens", "an", "opportunity", "to", "identify", "information", "specific", "to", "the", "machine", "where", "the", "sample", "was", "created", "."], ["In", "general", ",", "LNK", "files", "are", "used", "by", "worm", "type", "malware", "like", "Raspberry", "Robin", "in", "order", "to", "spread", "to", "removable", "disks", "or", "network", "shares", "."], ["Source", ":", "VirusTotalInterestingly", ",", "many", "malicious", "LNK", "files", "submitted", "to", "VT", "during", "this", "period", "had", "all", "the", "metadata", "removed", "from", "the", "file", "."], ["However", ",", "after", "Microsoft", "announced", "changes", "to", "how", "macros", "were", "executed", "by", "default", "on", "internet", "downloaded", "content", ",", "Talos", "found", "Qakbot", "increasingly", "moving", "away", "from", "the", "XLSB", "files", "in", "favor", "of", "ISO", "files", "containing", "a", "LNK", "file", ",", "which", "would", "download", "and", "execute", "the", "payload", "."], ["Interestingly", ",", "at", "this", "point", "the", "``", "Obama", "''", "Qakbot", "campaign", "began", "wiping", "out", "the", "metadata", "on", "their", "LNK", "files", ",", "but", "the", "Target", "field", "always", "pointed", "to", "the", "JS", ",", "BAT", "or", "CMD", "file", "used", "to", "start", "the", "malicious", "DLL", "part", "of", "the", "initial", "infection", "chain", "(", "Figure", "9", ")", ":", "Figure", "9", ":", "Metadata", "for", "LNK", "files", "part", "of", "``", "Obama", "''", "campaignThe", "same", "behavior", "started", "to", "happen", "on", "``", "BB", "''", "campaign", "'", "s", "LNK", "files", "starting", "on", "September", "13th", "."], ["We", "can", "see", "in", "Figure", "10", "that", "samples", "mapped", "to", "the", "``", "BB", "''", "campaign", "in", "September", "still", "had", "Drive", "Serial", "Number", "information", ":", "Figure", "10", ":", "Metadata", "for", "LNK", "files", "part", "of", "``", "BB", "''", "campaignWe", "also", "observe", "that", "the", "Drive", "Serial", "Number", "matches", "the", "one", "used", "by", "the", "``", "AA", "''", "campaign", "from", "the", "May/July", "timeframe", ",", "which", "could", "indicate", "``", "AA", "''", "and", "``", "BB", "''", "are", "probably", "managed", "by", "the", "same", "group", "."], ["By", "analyzing", "the", "metadata", "content", "of", "the", "LNK", "file", "in", "the", "report", ",", "Talos", "associated", "the", "machine", "IDs", "where", "the", "files", "were", "generated", ",", "to", "files", "associated", "with", "the", "Gamaredon", "APT", "."], ["The", "interesting", "point", "here", "is", "that", "there", "is", "no", "provision", "in", "the", "LNK", "file", "format", "for", "a", "digisig", ",", "which", "means", "the", "digisig", "is", "probably", "present", "only", "as", "garbage", "data", "to", "confuse", "AV", "scanners", "and", "is", "a", "common", "technique", "used", "by", "many", "malware", "families", "."], ["In", "August", "2022", ",", "a", "user", "submitted", "a", "test", "link", "file", "to", "VT", ",", "with", "a", "file", "path", "containing", "the", "individual", "'", "s", "username", ":", "``", "Lamar", "''", "."], ["This", "LNK", "file", "was", "created", "on", "the", "same", "machine", "responsible", "for", "the", "LNK", "files", "used", "in", "a", "previous", "IcedID", "campaign", "."], ["A", "few", "hours", "later", "the", "same", "user", "submitted", "another", "file", "with", "hash", "e89cd1999517b47805106111e14de4a03669cac30adb3b3304655febce25955f", ",", "this", "time", "with", "user", "information", "sanitized", ",", "and", "packaged", "in", "a", "Zip", "file", "containing", "a", "BAT", "and", "DLL", "file", "."], ["The", "DLL", "file", "was", "an", "IcedID", "bot", "."], ["In", "both", "cases", "the", "same", "username", "is", "present", "in", "the", "ParsingPath", "field", "."], ["During", "our", "research", "on", "Qakbot", "we", "found", "samples", "associated", "with", "the", "``", "Obama", "''", "campaign", "which", "still", "had", "the", "LNK", "information", "and", "used", "the", "Drive", "Serial", "Number", "``", "300D-05E9", "''", "."]], "ner": [[[8, 11, "MF"], [24, 24, "MF"], [39, 40, "TP"]], [[54, 55, "MF"]], [[95, 96, "SF"]], [[131, 132, "SF"]], [[159, 160, "MP"], [164, 165, "MF"], [174, 175, "MP"], [187, 188, "SF"]], [], [[224, 224, "MF"], [230, 231, "MF"]], [], [[388, 389, "MF"]], [[412, 413, "MF"], [421, 422, "MP"]], [[440, 441, "MF"]], [[477, 477, "MP"], [488, 489, "MP"], [501, 501, "MF"]], [[512, 512, "MP"], [521, 522, "MF"]], [], [[671, 672, "MF"]], [], [[750, 751, "MF"]], [[771, 772, "MF"]], [], [], [], []], "relations": [[[39, 40, 54, 55, "RD"], [8, 11, 24, 24, "CO"], [8, 11, 54, 55, "CO"]], [], [[95, 96, 131, 132, "CO"]], [], [[159, 160, 164, 165, "EX"], [159, 160, 187, 188, "RD"], [174, 175, 187, 188, "RD"], [174, 175, 187, 188, "WR"], [159, 160, 224, 224, "WR"], [159, 160, 230, 231, "WR"], [159, 160, 388, 389, "WR"], [159, 160, 174, 175, "CO"]], [], [], [], [], [[421, 422, 224, 224, "WR"], [421, 422, 230, 231, "WR"], [421, 422, 388, 389, "WR"], [421, 422, 388, 389, "WR"], [412, 413, 440, 441, "CO"]], [], [[477, 477, 488, 489, "FR"], [488, 489, 501, 501, "WR"], [488, 489, 501, 501, "EX"]], [[512, 512, 501, 501, "UK"], [512, 512, 521, 522, "WR"]], [], [], [], [[750, 751, 771, 772, "CO"]], [], [], [], [], []]}