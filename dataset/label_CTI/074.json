{"doc_key": "074", "sentences": [["As", "shown", "below", ",", "these", "emails", "typically", "contain", "hyperlinks", "to", "malicious", "ZIP", "archives", "being", "hosted", "on", "attacker-controlled", "web", "servers", "."], ["The", "language", "targeted", "by", "the", "reply", "messages", "typically", "matches", "the", "language", "used", "in", "the", "original", "email", "thread", ",", "demonstrating", "that", "there", "is", "some", "localization", "taking", "place", "dynamically", "."], ["In", "the", "following", "example", ",", "the", "attacker", "was", "observed", "replying", "to", "an", "extortion", "email", "message", ",", "which", "is", "likely", "ineffective", "in", "convincing", "the", "recipient", "to", "access", "the", "content", "in", "the", "body", "of", "the", "email", "."], ["In", "all", "of", "these", "cases", ",", "the", "emails", "are", "designed", "to", "trick", "the", "potential", "victim", "into", "accessing", "the", "included", "hyperlink", "to", "download", "a", "malicious", "ZIP", "archive", "."], ["Malicious", "Microsoft", "Office", "files", "are", "inside", "the", "archives", ",", "which", "initiate", "the", "infection", "process", "as", "described", "below", "."], ["Infection", "process", "When", "the", "victim", "accesses", "the", "hyperlink", "contained", "in", "the", "initial", "malicious", "spam", "message", ",", "they", "are", "sent", "a", "ZIP", "archive", "containing", "a", "malicious", "Office", "document", "."], ["These", "documents", "contain", "the", "malicious", "code", "responsible", "for", "retrieving", "and", "executing", "the", "next", "stage", "component", ",", "in", "this", "case", ",", "the", "SQUIRRELWAFFLE", "payload", "."], ["In", "all", "of", "the", "campaigns", "observed", ",", "the", "distribution", "URLs", "that", "are", "used", "to", "host", "the", "malicious", "ZIP", "archives", "contain", "Latin", "words", "and", "follow", "a", "URL", "structure", "similar", "to", "the", "following", "example", ":", "abogados-en-medellin.com/odit-error/assumenda.zipWe", "'ve", "observed", "that", ",", "in", "many", "cases", ",", "there", "are", "separate", "ZIP", "archives", "being", "hosted", "in", "different", "directories", "on", "the", "same", "domain", "at", "any", "given", "point", "in", "time", "."], ["Inside", "of", "the", "ZIP", "archives", ",", "the", "malicious", "Office", "documents", "often", "follow", "a", "naming", "convention", "similar", "to", "the", "examples", "below", ":", "chart-1187900052.xlsdiagram-127.docdiagram_1017101088.xlsspecification-1001661454.xlsSince", "these", "campaigns", "began", ",", "we", "observed", "several", "variations", "in", "the", "way", "the", "documents", "function", ",", "so", "will", "describe", "two", "of", "the", "most", "common", "infection", "chains", "we", "observed", "in", "September", "."], ["In", "this", "particular", "case", ",", "the", "document", "contains", "malicious", "macros", "that", "initiate", "the", "SQUIRRELWAFFLE", "infection", "process", "if", "enabled", "by", "the", "victim", "."], ["These", "macros", "are", "AutoOpen", "(", ")", "and", "reference", "a", "macro", "function", "that", "contains", "the", "majority", "of", "the", "malicious", "code", "."], ["This", "macro", "is", "responsible", "for", "writing", "a", "VBS", "script", "to", "%", "PROGRAMDATA", "%", "and", "then", "executing", "it", "."], ["The", "contents", "of", "the", "malicious", "script", "can", "be", "seen", "in", "the", "following", "screenshot", "."], ["This", "script", "is", "responsible", "for", "the", "retrieval", "of", "the", "SQUIRRELWAFFLE", "payload", "itself", "from", "one", "of", "the", "five", "hardcoded", "URLs", "present", "in", "the", "script", "."], ["In", "this", "case", ",", "SQUIRRELWAFFLE", "is", "delivered", "to", "the", "victim", "'s", "system", "as", "a", "malicious", "DLL", "that", "is", "then", "executed", "using", "rundll32.exe", "."], ["These", "spreadsheets", "contain", "malicious", "Excel4", "macros", "that", "are", "responsible", "for", "retrieving", "and", "executing", "the", "SQUIRRELWAFFLE", "payload", "."], ["Similar", "to", "what", "was", "observed", "with", "the", "Word", "document", "lures", ",", "these", "macros", "contain", "three", "hardcoded", "URLs", "that", "host", "the", "DLL", "associated", "with", "SQUIRRELWAFFLE", "."], ["Once", "retrieved", ",", "the", "DLL", "is", "executed", "via", "ShellExecuteA", "and", "regsvr32.exe", ",", "thus", "infecting", "the", "system", "."], ["The", "ZIP", "archives", "and", "associated", "maldocs", "are", "rotated", "across", "emails", ",", "resulting", "in", "large", "quantities", "of", "unique", "samples", "."], ["This", "is", "reflected", "in", "the", "table", "below", ",", "which", "shows", "some", "of", "the", "macro", "function", "names", ",", "hashes", "and", "the", "corresponding", "campaign", "landing", "pages", "used", "by", "the", "macros", "to", "retrieve", "the", "SQUIRREWAFFLE", "DLL", "files", "observed", "across", "some", "of", "the", "initial", "malspam", "campaigns", "."], ["When", "HTTP", "requests", "are", "received", ",", "the", "requestor", "is", "checked", "against", "several", "lists", "of", "IPs", ",", "ASN", "names", "and", "other", "artifacts", "."], ["If", "any", "of", "the", "information", "matches", ",", "the", "server", "responds", "with", "an", "HTTP", "404", "status", "code", "."], ["SQUIRRELWAFFLE", "LOADERThe", "SQUIRRELWAFFLE", "payload", "that", "is", "dropped", "on", "infected", "systems", "is", "a", "PE", "DLL", "that", "is", "executed", "using", "either", "rundll32.exe", "or", "regsvr32.exe", "depending", "on", "the", "maldoc", "used", "to", "initiate", "the", "infection", "process", "."], ["Here", "'s", "an", "example", "of", "the", "syntax", "used", "to", "execute", "the", "payload", "using", "rundll32.exe", ",", "specifying", "the", "entry", "point", ":", "cmd.exe", "/c", "rundll32.exe", "C", ":", "\\ProgramData\\", "[", "DLL", "FILENAME", "]", ",", "ldrExecuting", "the", "DLL", "directly", "without", "specifying", "the", "required", "parameter", "will", "likely", "not", "result", "in", "successful", "execution", "of", "the", "payload", "and", "may", "allow", "it", "to", "evade", "automated", "dynamic", "analysis", "platforms", "."], ["The", "DLL", "also", "features", "an", "IP", "blocklist", "as", "part", "of", "its", "configuration", "that", "is", "used", "to", "attempt", "to", "further", "evade", "automated", "analysis", "platforms", "and", "security", "research", "organizations", "."], ["The", "most", "interesting", "functionality", "is", "used", "to", "encode", "and", "decode", "information", "to", "facilitate", "communications", "between", "the", "victim", "system", "and", "the", "C2", "infrastructure", "."], ["The", "URL", "used", "by", "the", "victim", "to", "POST", "data", "to", "the", "C2", "server", "consists", "of", "a", "random", "one-", "to", "28-character", "alphanumeric", "string", ",", "followed", "by", "the", "IP", "address", "of", "the", "victim", "'s", "system", "."], ["The", "URL", "in", "the", "previous", "HTTP", "POST", "request", "can", "be", "deobfuscated", "to", "the", "following", ":", "The", "body", "of", "the", "HTTP", "POST", "request", "contains", "information", "about", "the", "victim", "system", "."], ["The", "data", "sent", "to", "the", "C2", "includes", ":", "%", "APPDATA", "%", "configuration", "."], ["This", "information", "is", "retrieved", "using", "getenv", ",", "GetComputerNameW", ",", "GetUserNameW", ",", "and", "NetWkstaGetInfo", "(", ")", "respectively", "."], ["The", "C2", "server", "will", "respond", "to", "these", "requests", "with", "a", "status", "code", "as", "well", "as", "the", "previously", "sent", "beacon", "information", "."], ["The", "response", "body", "is", "obfuscated", "using", "the", "same", "method", "as", "previously", "described", "."], ["This", "C2", "channel", "is", "also", "used", "to", "deliver", "secondary", "payloads", "at", "the", "discretion", "of", "the", "attacker", "."], ["SquirrelWaffle1021-9903731-0ORBITAL", "QUERIESCisco", "Secure", "Endpoint", "users", "can", "use", "Orbital", "Advanced", "Search", "to", "run", "complex", "OSqueries", "to", "see", "if", "their", "endpoints", "are", "infected", "with", "this", "specific", "threat", "."]], "ner": [[[5, 5, "MP"], [8, 8, "MF"], [18, 18, "SO"]], [], [[54, 54, "MP"], [61, 62, "MF"]], [[90, 90, "MP"], [102, 102, "MF"], [107, 108, "MF"]], [[113, 113, "MF"], [117, 117, "MF"], [122, 123, "MP"]], [[128, 129, "MP"], [132, 132, "TP"], [135, 135, "MF"], [141, 142, "MF"], [148, 149, "MF"], [154, 154, "MF"]], [[157, 157, "MP"], [161, 161, "MP"], [178, 178, "MF"]], [[184, 184, "MP"], [189, 189, "MF"], [197, 197, "MF"], [205, 205, "MF"], [225, 226, "MF"]], [[246, 247, "MP"], [251, 252, "MF"], [266, 266, "MP"], [288, 289, "MP"]], [[301, 301, "MP"], [304, 304, "MF"], [309, 310, "MP"]], [[318, 318, "MF"], [326, 327, "MP"], [335, 335, "MF"]], [[338, 338, "MP"], [344, 345, "MF"], [353, 353, "MF"]], [[360, 360, "MF"]], [[370, 370, "MP"], [378, 378, "MF"]], [[397, 397, "MF"], [414, 414, "TP"]], [[420, 421, "MP"], [430, 430, "MF"]], [[445, 445, "MP"], [449, 449, "MF"], [453, 453, "MF"], [456, 456, "MF"]], [[462, 462, "MF"], [466, 466, "MP"], [468, 468, "MP"]], [[476, 476, "MF"], [480, 480, "MF"], [484, 484, "MP"], [492, 492, "MF"]], [[507, 507, "MP"], [525, 525, "MF"], [535, 535, "MP"]], [[544, 544, "MP"], [551, 551, "SF"], [553, 553, "SF"], [557, 557, "SF"]], [[567, 567, "SO"]], [[578, 578, "MF"], [589, 589, "MF"], [595, 595, "TP"], [597, 597, "TP"]], [[615, 615, "MP"], [620, 620, "MF"], [622, 622, "TP"]], [[671, 671, "MF"], [676, 676, "MP"]], [[708, 708, "MF"], [714, 715, "MP"], [718, 719, "MP"]], [[722, 722, "MF"], [726, 726, "MP"], [732, 733, "SO"], [742, 742, "MF"], [747, 748, "MF"]], [[776, 776, "MP"], [778, 778, "TF"]], [[785, 785, "MF"], [789, 789, "SO"]], [[798, 798, "SF"], [802, 802, "MP"], [804, 804, "MP"], [806, 806, "MP"], [809, 809, "MP"]], [[815, 816, "SO"], [821, 821, "MP"], [824, 825, "TF"], [832, 833, "SF"]], [], [[849, 850, "MP"], [857, 857, "MF"], [863, 863, "MP"]], [[869, 869, "MP"], [872, 874, "MP"], [883, 883, "SO"]]], "relations": [[[5, 5, 8, 8, "WR"], [5, 5, 18, 18, "ST"], [5, 5, 18, 18, "RF"]], [], [[54, 54, 61, 62, "RD"], [54, 54, 863, 863, "CO"]], [[90, 90, 102, 102, "WR"], [90, 90, 107, 108, "WR"], [90, 90, 113, 113, "WR"], [107, 108, 117, 117, "CO"], [102, 102, 135, 135, "CO"]], [[122, 123, 128, 129, "CO"]], [[132, 132, 113, 113, "WR"], [132, 132, 135, 135, "RD"], [132, 132, 141, 142, "RD"], [132, 132, 148, 149, "WR"], [132, 132, 154, 154, "WR"], [132, 132, 869, 869, "CO"]], [[157, 157, 154, 154, "EX"], [157, 157, 161, 161, "FR"], [161, 161, 178, 178, "WR"], [161, 161, 178, 178, "EX"]], [[184, 184, 189, 189, "WR"], [184, 184, 197, 197, "WR"], [184, 184, 205, 205, "WR"], [184, 184, 225, 226, "WR"]], [[246, 247, 225, 226, "EX"], [246, 247, 251, 252, "WR"], [266, 266, 288, 289, "FR"]], [[301, 301, 304, 304, "WR"], [301, 301, 309, 310, "FR"], [304, 304, 318, 318, "CO"]], [[326, 327, 318, 318, "EX"], [326, 327, 335, 335, "WR"], [326, 327, 338, 338, "CO"]], [[338, 338, 344, 345, "WR"], [338, 338, 353, 353, "EX"], [344, 345, 353, 353, "CO"], [344, 345, 360, 360, "CO"]], [], [[370, 370, 360, 360, "EX"], [370, 370, 378, 378, "WR"], [370, 370, 414, 414, "IJ"], [378, 378, 397, 397, "CO"]], [[414, 414, 397, 397, "EX"]], [[420, 421, 430, 430, "WR"], [420, 421, 430, 430, "EX"], [420, 421, 445, 445, "CO"], [430, 430, 456, 456, "CO"]], [[445, 445, 449, 449, "WR"], [445, 445, 453, 453, "WR"], [453, 453, 462, 462, "CO"]], [[466, 466, 462, 462, "EX"], [468, 468, 462, 462, "EX"]], [[484, 484, 476, 476, "WR"], [484, 484, 480, 480, "WR"], [484, 484, 492, 492, "WR"]], [[507, 507, 525, 525, "RD"], [535, 535, 525, 525, "WR"]], [[544, 544, 551, 551, "RD"], [544, 544, 553, 553, "RD"], [544, 544, 557, 557, "RD"], [544, 544, 567, 567, "RF"]], [], [[595, 595, 589, 589, "EX"], [597, 597, 589, 589, "EX"], [578, 578, 589, 589, "CO"]], [[615, 615, 620, 620, "EX"], [622, 622, 620, 620, "EX"]], [[676, 676, 671, 671, "EX"], [676, 676, 708, 708, "RD"], [676, 676, 708, 708, "WR"]], [[714, 715, 708, 708, "RD"], [718, 719, 708, 708, "RD"], [718, 719, 732, 733, "ST"], [718, 719, 732, 733, "RF"], [714, 715, 726, 726, "CO"]], [[726, 726, 722, 722, "RD"], [726, 726, 732, 733, "ST"], [726, 726, 742, 742, "WR"], [726, 726, 747, 748, "WR"]], [[776, 776, 778, 778, "WR"], [776, 776, 785, 785, "WR"], [776, 776, 789, 789, "ST"], [776, 776, 789, 789, "RF"]], [], [[802, 802, 785, 785, "WR"], [802, 802, 789, 789, "ST"], [802, 802, 789, 789, "RF"], [802, 802, 798, 798, "RD"], [804, 804, 798, 798, "RD"], [806, 806, 798, 798, "RD"], [809, 809, 798, 798, "RD"]], [[821, 821, 815, 816, "RF"], [821, 821, 824, 825, "WR"], [821, 821, 832, 833, "RD"]], [], [[849, 850, 857, 857, "WR"], [863, 863, 857, 857, "RD"]], [[869, 869, 872, 874, "FR"]]]}