{"doc_key": "034", "sentences": [["This", "campaign", "consisted", "of", "the", "use", "of", "malicious", "excel", "documents", "(", "XLS", "maldocs", ")", "and", "executables", "stored", "on", "a", "file", "hosting", "domain", "``", "snapfile.org", "''", ",", "which", "would", "be", "delivered", "to", "the", "victims", "in", "the", "form", "of", "PDF", "documents", "with", "embedded", "links", "."], ["Now", ",", "the", "maldocs", "consist", "of", "malicious", "VBA", "macros", "meant", "to", "instrument", "the", "infection", "chain", "."], ["The", "infection", "chain", "instrumented", "by", "the", "VBA", "macros", "consist", "of", "creating", "three", "key", "artifacts", "on", "the", "infected", "endpoint", ":"], ["Registry", "key", "for", "persistence", "."], ["Malicious", "VB", "script", "intermediate", "component", "that", "the", "macro", "sets", "up", "for", "persistence", "."], ["Malicious", "PowerShell-based", "downloader", "script", ":", "The", "actual", "post-infection", ",", "payload", "instrumentor", "used", "for", "executing", "arbitrary", "code", "on", "the", "infected", "endpoint", "."], ["The", "VB", "script", "'s", "persistence", "is", "set", "up", "by", "creating", "a", "malicious", "Registry", "Run", "for", "the", "infected", "user", ":"], ["This", "campaign", "relies", "on", "the", "use", "of", "a", "LoLBin", "to", "execute", "the", "malicious", "VBScript", "."], ["In", "some", "instances", ",", "the", "attackers", "make", "use", "of", "a", "LoLBin", "DLL", "called", "pcwutl.dll", ",", "which", "is", "part", "of", "the", "operating", "system", ",", "to", "execute", "the", "VBScript", "on", "reboot", "or", "re-login", "."], ["The", "malicious", "VBA", "macros", "consisted", "of", "the", "same", "set", "of", "functionalities", "for", "creating", "the", "malicious", "VBS", "and", "PS1", "scripts", ",", "and", "achieving", "persistence", "across", "reboots", "."], ["The", "latest", "versions", "of", "the", "VBA", "code", "deployed", "could", "make", "HTTP", "requests", "to", "a", "canary", "token", "from", "canarytokens.com", "."], ["When", "that", "object", "is", "opened", ",", "an", "HTTP", "request", "to", "canarytokens.com", "is", "generated", ",", "alerting", "the", "token", "'s", "owner", "that", "the", "object", "was", "opened", "."], ["The", "canary", "token", "is", "typically", "silently", "executed", "twice", "during", "the", "execution", "of", "the", "macro", "."], ["In", "this", "campaign", ",", "the", "server", "that", "hosts", "the", "final", "payload", "may", "only", "deliver", "if", "it", "first", "receives", "two", "almost", "simultaneous", "requests", "to", "the", "token", "."], ["This", "would", "thwart", "researchers", "that", "solely", "request", "the", "payload", "from", "the", "server", "without", "registering", "with", "the", "canary", "tokens", "using", "an", "HTTP", "request", "."], ["The", "infection", "chain", "consists", "of", "a", "PS1-based", "downloader", "and", "two", "sets", "of", "HTTP", "requests", "for", "the", "canary", "tokens", "."], ["Automated", "sandboxed", "systems", "would", "typically", "execute", "the", "malicious", "macro", "generating", "the", "token", "requests", "."], ["A", "sandbox", "would", "also", "identify", "the", "creation", "of", "the", "registry", "Run", "key", "and", "re-login", "the", "infected", "user", "to", "execute", "the", "malicious", "PS1", "that", "generates", "the", "request", "to", "download", "the", "next", "payload", "."], ["A", "substantially", "low", "interval", "between", "the", "HTTP", "token", "requests", "and", "PS1", "requesting", "the", "payload", "may", "indicate", "automated", "analysis", "of", "the", "maldocs", "and", "can", "be", "used", "to", "block", "payload", "requests", "from", "the", "infected", "endpoint", "."], ["If", "they", "keep", "receiving", "requests", "to", "the", "token", "but", "not", "to", "the", "payload", "server", ",", "that", "is", "an", "indication", "of", "their", "payload", "server", "being", "blocked", ",", "and", "by", "whom", "."], ["VBS", "executing", "the", "PS1", "on", "the", "endpoint", "."], ["The", "PowerShell", "script", "deployed", "in", "the", "attack", "is", "meant", "to", "download", "and", "execute", "the", "next", "payload", "(", "also", "a", "PS1", "script", ")", "on", "the", "infected", "endpoint", "."], ["This", "PS1", "script", "resides", "in", "the", "metadata", "of", "the", "maldoc", "and", "is", "dropped", "by", "the", "macro", "."], ["PS1", "downloader", "script", "."], ["The", "PowerShell", "script", "that", "downloads", "another", "PowerShell", "from", "a", "remote", "location", "which", "will", "then", "be", "executed", "."], ["It", "tries", "twice", ",", "with", "a", "custom", "timeout", "of", "40", "seconds", "and", "a", "custom", "user", "agent", ",", "which", "is", "appended", "with", "the", "character", "``", "|", "''", "separator", "and", "the", "username", "executing", "the", "script", "."], ["The", "fact", "that", "the", "downloader", "script", "attempts", "the", "download", "of", "the", "payload", "twice", "with", "a", "big", "timeout", "further", "indicates", "that", "the", "canarytokens", "serve", "the", "purpose", "of", "anti-analysis", "."], ["That", "is", ",", "the", "C2", "may", "need", "more", "time", "to", "check", "if", "the", "canarytokens", "have", "been", "accessed", "before", "it", "delivers", "the", "final", "payload", "."], ["The", "PDF", "files", "typically", "show", "an", "error", "message", "and", "ask", "the", "user", "to", "click", "on", "a", "link", "to", "resolve", "the", "issue", "and", "display", "the", "correct", "format/extension", "of", "the", "document", "."], ["Once", "the", "victim", "clicks", "on", "the", "download", "button", ",", "the", "endpoint", "receives", "a", "second", "stage", ",", "which", "can", "be", "either", "a", "malicious", "XLS", "file", "or", "a", "Windows", "executable", "that", "proceeds", "with", "the", "infection", "as", "described", "earlier", "."], ["The", "initial", "delivery", "mechanism", "of", "the", "infection", "chains", "consists", "of", "the", "malicious", "PDF", "files", "as", "the", "first", "stage", "."], ["The", "URLs", "corresponding", "to", "the", "download", "button", "in", "the", "PDF", "files", "will", "typically", "host", "the", "malicious", "XLS", "files", "containing", "the", "macros", "that", "deploy", "the", "subsequent", "VBS", "and", "PS1", "scripts", "."], ["This", "second", "variation", "consists", "of", "the", "PDF", "pointing", "to", "a", "URL", "that", "delivers", "a", "Windows", "executable", "(", "EXE", ")", "in", "the", "infection", "chain", "instead", "of", "the", "malicious", "XLS", "files", "."], ["The", "EXEs", "are", "meant", "to", "instrument", "a", "similar", "infection", "chain", "consisting", "of", "the", "intermediate", "VBS", "and", "final", "PS1-based", "downloaders", "."]], "ner": [[[1, 1, "MP"], [11, 12, "MF"], [15, 15, "MF"], [23, 23, "SO"]], [[46, 46, "MP"], [50, 51, "MP"], [56, 57, "MP"]], [[60, 61, "MP"], [65, 66, "MP"]], [[78, 79, "MF"]], [[84, 87, "TF"]], [[97, 99, "TF"]], [[128, 129, "TF"]], [[136, 137, "MP"], [144, 144, "TP"], [148, 149, "TP"]], [[156, 156, "MP"], [164, 164, "SF"], [177, 177, "MF"]], [[185, 186, "MP"], [197, 198, "MF"], [200, 201, "MF"]], [[214, 215, "MP"], [223, 224, "MF"], [226, 226, "SO"]], [[238, 238, "SO"]], [[254, 255, "MF"]], [[273, 273, "SO"], [283, 283, "SO"]], [[305, 305, "SO"], [310, 311, "MF"]], [[323, 324, "MP"], [329, 330, "MP"]], [[336, 338, "MP"], [344, 344, "MF"]], [[351, 351, "MP"], [371, 371, "MF"], [380, 380, "MF"]], [[388, 390, "TP"], [392, 395, "MP"], [402, 402, "MF"]], [[423, 423, "MF"], [428, 429, "SO"], [437, 438, "SO"]], [[446, 446, "MP"], [449, 449, "MF"]], [[455, 456, "MP"], [460, 460, "MP"], [473, 474, "MF"]], [[482, 483, "MF"], [496, 496, "MP"]], [[498, 500, "MP"]], [[503, 504, "MP"], [508, 508, "MF"], [511, 512, "SO"]], [[519, 519, "MP"], [532, 534, "MP"]], [[557, 558, "MP"], [564, 564, "MF"]], [[585, 585, "MP"], [594, 594, "MF"], [603, 603, "MF"]], [[606, 607, "MF"]], [[641, 642, "MP"], [657, 658, "MF"], [661, 662, "MF"]], [[674, 675, "MP"], [684, 685, "MF"]], [[696, 697, "MP"], [707, 708, "MF"], [711, 711, "TP"], [716, 719, "MF"]], [[722, 723, "MP"], [735, 736, "MF"], [748, 749, "MP"]], [[752, 752, "MP"], [765, 765, "MF"], [768, 769, "TP"]]], "relations": [[[1, 1, 11, 12, "RD"], [1, 1, 15, 15, "RD"], [1, 1, 23, 23, "ST"], [1, 1, 23, 23, "RF"], [1, 1, 164, 164, "RD"], [1, 1, 136, 137, "CO"], [1, 1, 156, 156, "CO"]], [[50, 51, 310, 311, "WR"], [46, 46, 56, 57, "CO"], [46, 46, 60, 61, "CO"], [50, 51, 65, 66, "CO"], [50, 51, 185, 186, "CO"], [50, 51, 214, 215, "CO"]], [[60, 61, 78, 79, "WR"], [60, 61, 84, 87, "WR"], [60, 61, 97, 99, "WR"], [60, 61, 128, 129, "WR"]], [], [], [], [], [[136, 137, 144, 144, "FR"], [144, 144, 148, 149, "EX"]], [[156, 156, 164, 164, "WR"], [156, 156, 177, 177, "EX"]], [[185, 186, 197, 198, "WR"], [185, 186, 200, 201, "WR"]], [[214, 215, 223, 224, "WR"], [214, 215, 226, 226, "ST"], [214, 215, 226, 226, "RF"], [214, 215, 254, 255, "EX"], [226, 226, 238, 238, "CO"]], [], [], [[273, 273, 283, 283, "CO"], [273, 273, 305, 305, "CO"]], [], [[323, 324, 310, 311, "WR"], [323, 324, 310, 311, "WR"], [323, 324, 388, 390, "FR"], [329, 330, 310, 311, "WR"]], [[336, 338, 344, 344, "EX"], [336, 338, 351, 351, "CO"]], [[351, 351, 371, 371, "EX"], [351, 351, 380, 380, "WR"]], [[388, 390, 380, 380, "RD"], [388, 390, 380, 380, "EX"], [388, 390, 392, 395, "FR"], [392, 395, 402, 402, "WR"], [392, 395, 402, 402, "WR"], [392, 395, 423, 423, "WR"]], [[428, 429, 437, 438, "CO"]], [[446, 446, 402, 402, "WR"], [446, 446, 423, 423, "WR"], [446, 446, 449, 449, "EX"]], [[460, 460, 455, 456, "FR"], [455, 456, 473, 474, "EX"], [473, 474, 482, 483, "CO"]], [[496, 496, 482, 483, "UK"]], [[498, 500, 511, 512, "ST"], [498, 500, 511, 512, "RF"]], [[503, 504, 508, 508, "EX"], [503, 504, 511, 512, "ST"], [503, 504, 511, 512, "RF"], [503, 504, 519, 519, "CO"]], [[519, 519, 532, 534, "FR"]], [[557, 558, 564, 564, "WR"]], [[585, 585, 594, 594, "WR"], [585, 585, 603, 603, "WR"], [585, 585, 606, 607, "WR"]], [], [[641, 642, 594, 594, "WR"], [641, 642, 606, 607, "WR"], [641, 642, 657, 658, "WR"], [641, 642, 661, 662, "WR"], [641, 642, 696, 697, "CO"]], [[674, 675, 684, 685, "WR"]], [[696, 697, 707, 708, "WR"], [696, 697, 711, 711, "FR"], [711, 711, 716, 719, "WR"]], [[722, 723, 735, 736, "WR"], [748, 749, 735, 736, "RD"]], [[752, 752, 765, 765, "WR"], [752, 752, 768, 769, "FR"]]]}