{"doc_key": "096", "sentences": [["In", "the", "new", "sample", "from", "Lebanon", "identified", "at", "the", "end", "of", "February", ",", "the", "attacker", "used", "an", "Excel", "document", "with", "a", "similar", "macro", ":", "Instead", "of", "using", "the", ".oracleServices", "directory", ",", "which", "we", "had", "previously", "observed", ",", "the", "attacker", "uses", "a", ".msdonedrive", "directory", "and", "renames", "the", "malware", "``", "taskwin32.exe.", "``"], ["The", "scheduled", "task", "was", "also", "renamed", "to", "``", "onedrive", "updater", "v10", "."], ["The", "malware", "supports", "HTTP", "and", "DNS", "communication", "to", "the", "C2", "server", "."], ["The", "HTTP", "communication", "is", "hidden", "in", "the", "comments", "in", "the", "HTML", "code", "."], ["This", "time", ",", "however", ",", "the", "C2", "server", "mimics", "the", "GitHub", "platform", "instead", "of", "Wikipedia", "."], ["While", "the", "DNS", "communication", "follows", "the", "same", "method", "we", "described", "in", "our", "previous", "article", ",", "the", "developer", "added", "some", "new", "features", "in", "this", "latest", "version", "and", ",", "this", "time", ",", "the", "actor", "removed", "the", "debug", "mode", "."], ["We", "also", "discovered", "that", "the", "actor", "added", "a", "reconnaissance", "phase", ",", "likely", "in", "response", "to", "the", "significant", "amount", "of", "interest", "in", "the", "campaign", "."], ["New", "reconnaissance", "phaseOn", "the", "initial", "execution", ",", "the", "malware", "drops", "a", "Windows", "batch", "file", "(", "a.", "bat", ")", "in", "order", "to", "execute", "a", "WMI", "command", "and", "obtain", "all", "the", "running", "processes", "on", "the", "victim", "'s", "machine", ":", "wmic", "process", "listThe", "malware", "also", "identifies", "the", "username", "and", "computer", "name", "of", "the", "infected", "system", "."], ["Finally", ",", "it", "uses", "the", "NetWkstaGetInfo", "(", ")", "API", "with", "the", "level", "100", "to", "retrieve", "additional", "info", "on", "the", "system", "(", "this", "is", "the", "64th", "number", ",", "hex", "64", "is", "100", "decimal", ")", "."], ["This", "level", "returns", "information", "about", "the", "workstation", "environment", ",", "including", "platform-specific", "information", ",", "the", "name", "of", "the", "domain", "and", "the", "local", "computer", ",", "and", "information", "concerning", "the", "operating", "system", "."], ["API", "and", "strings", "obfuscationIn", "this", "latest", "version", ",", "the", "developer", "split", "some", "strings", "into", "two", "parts", "."], ["The", "actor", "attempts", "to", "use", "this", "technique", "to", "``", "hide", "''", "API", "call", "and", "internal", "strings", "."], ["For", "example", ",", "the", "following", "rule", "would", "no", "longer", "alert", "due", "to", "a", "failed", "pattern", "match", ":", "rule", "DNSpionage", "{", "strings", ":", "$", "conf=", "''", "Configure.txt", "''", "condition", ":", "All", "of", "them", "}", "Let", "'s", "check", "your", "anti-virusThe", "malware", "searches", "for", "two", "specific", "anti-virus", "platforms", ":", "Avira", "and", "Avast", "."], ["If", "one", "of", "these", "security", "products", "is", "installed", "on", "the", "system", "and", "identified", "during", "the", "reconnaissance", "phase", ",", "a", "specific", "flag", "will", "be", "set", "and", "some", "options", "from", "the", "configuration", "file", "will", "be", "ignored", "."], ["In", "DNSpionage", ",", "upon", "opening", "the", "Excel", "document", ",", "users", "are", "greeted", "with", "the", "insult", ",", "``", "haha", "you", "are", "donkey", "[", "sic", "]", ".", "``"], ["On", "the", "analyzed", "samples", ",", "the", "malware", "author", "left", "two", "different", "internal", "names", "in", "plain", "text", ":", "``", "DropperBackdoor", "''", "and", "``", "Karkoff.", "``"], ["The", "malware", "is", "a", "Windows", "service", "named", "``", "MSExchangeClient", ":", "''", "From", "an", "incident", "response", "point", "of", "view", ",", "it", "'s", "interesting", "to", "note", "that", "the", "malware", "generates", "a", "log", "file", ":", "C", ":", "\\\\Windows\\\\Temp\\\\MSEx_log.txt", "."], ["The", "executed", "commands", "are", "stored", "in", "this", "file", "(", "xored", "with", "'M", "'", ")", "with", "a", "timestamp", "."], ["C2", "communicationThe", "C2", "servers", "are", "hardcoded", "in", "the", "analyzed", "samples", ":", "The", "malware", "uses", "the", "domain", "or", "the", "IP", "address", "."], ["Karkoff", "uses", "base64", "encoding", "to", "initially", "obfuscate", "the", "C2", "communications", "."], ["This", "is", "then", "further", "obfuscated", "by", "carrying", "out", "a", "XOR", "function", ",", "with", "a", "XOR", "key", "70", "(", "decimal", ")", "."], ["NET", "library", "is", "embedded", "in", "the", "malware", "."], ["This", "library", "is", "used", "to", "handle", "messages", "from", "the", "C2", "server", "."], ["The", "answer", "is", "first", "decoded", "(", "base64", ")", "and", "the", "commands", "match", "the", "following", "pattern", ":", "[", "{", "``", "ID", "''", ":", "``", "123", "''", ",", "``", "Data", "''", ":", "``", "filename.exe|base64PEContent", "''", ",", "``", "Type", "''", ":", "``", "101", "''", "}", ",", "{", "``", "ID", "''", ":", "``", "124", "''", ",", "``", "Data", "''", ":", "``", "filename.exe", "arg1", "arg2", "''", ",", "``", "Type", "''", ":", "``", "102", "''", "}", "]", "."], ["The", "command", "type", "101", "means", "that", "the", "data", "will", "be", "a", "base64", "encoded", "file", "."], ["The", "file", "will", "be", "stored", "with", "the", "filename", "placed", "before", "the", "pipe", "(", "filename.exe", "in", "our", "example", ")", "."], ["The", "leak", "contains", "a", "webmask_dnspionage", "repository", "."], ["The", "URL", "provides", "some", "other", "relevant", "information", ":", "The", "URL", "contains", "the", "/Th", "!", "swasP", "@", "NEl", "directory", "."], ["After", "our", "first", "publication", ",", "LastLine", "published", "a", "blog", "post", "explaining", "that", "the", "actor", "made", "some", "mistakes", "in", "their", "Django", "configuration", ":", "You", "can", "see", "the", "content", "of", "the", "PANEL_PATH", "variable", "of", "the", "DNSpionage", "C2", "server", ":", "/Th", "!", "sIsP", "@", "NeL", "."]], "ner": [[[14, 14, "MP"], [17, 17, "MF"], [38, 38, "MP"], [46, 46, "MF"], [48, 48, "MF"]], [[51, 52, "MF"], [58, 60, "MF"]], [[63, 63, "MF"], [65, 65, "SO"], [67, 67, "SO"], [71, 72, "SO"]], [[75, 75, "SO"], [84, 85, "MF"]], [[93, 94, "SO"]], [[105, 105, "SO"], [134, 134, "MP"]], [[145, 145, "MP"]], [[172, 172, "MP"], [179, 180, "MP"], [187, 188, "MF"], [193, 194, "SF"], [208, 208, "SF"], [210, 211, "SF"]], [[219, 219, "MP"], [222, 222, "TP"], [232, 233, "SF"]], [[254, 254, "SF"], [257, 258, "SF"], [275, 275, "SF"]], [], [[299, 299, "MP"]], [[340, 340, "SF"], [353, 353, "MP"], [361, 361, "SF"], [363, 363, "SF"]], [[394, 395, "SF"]], [[406, 406, "MF"], [409, 409, "TP"]], [[432, 432, "MP"], [444, 444, "MF"], [448, 448, "MF"]], [[451, 451, "MP"], [458, 458, "MP"], [476, 476, "MP"], [482, 484, "MF"]], [[487, 488, "MF"], [493, 493, "MF"]], [[506, 507, "SO"], [516, 516, "MP"], [519, 519, "SO"], [522, 523, "SO"]], [[525, 525, "MP"], [527, 528, "MP"], [533, 534, "SF"]], [[550, 551, "MF"]], [[557, 558, "MP"], [563, 563, "MP"]], [[566, 566, "MP"], [571, 571, "MF"], [574, 575, "SO"]], [[581, 581, "MP"]], [], [[665, 665, "MF"], [677, 677, "MF"]], [], [[691, 691, "SO"], [699, 699, "SO"]], [[722, 722, "MP"], [728, 729, "SF"], [743, 744, "SO"]]], "relations": [[[14, 14, 17, 17, "WR"], [38, 38, 46, 46, "WR"], [38, 38, 51, 52, "WR"], [14, 14, 65, 65, "ST"], [14, 14, 65, 65, "RF"], [14, 14, 67, 67, "ST"], [14, 14, 67, 67, "RF"], [14, 14, 71, 72, "ST"], [14, 14, 71, 72, "RF"], [14, 14, 84, 85, "WR"], [46, 46, 48, 48, "CO"], [14, 14, 38, 38, "CO"], [14, 14, 134, 134, "CO"], [14, 14, 299, 299, "CO"]], [[51, 52, 58, 60, "CO"]], [[63, 63, 46, 46, "CO"], [65, 65, 75, 75, "CO"], [67, 67, 105, 105, "CO"], [71, 72, 93, 94, "CO"]], [], [], [[134, 134, 63, 63, "WR"], [134, 134, 75, 75, "ST"], [134, 134, 75, 75, "RF"], [134, 134, 84, 85, "WR"], [134, 134, 93, 94, "ST"], [134, 134, 93, 94, "RF"], [134, 134, 105, 105, "ST"], [134, 134, 105, 105, "RF"], [134, 134, 105, 105, "ST"], [134, 134, 105, 105, "RF"], [134, 134, 193, 194, "RD"], [134, 134, 145, 145, "CO"]], [[145, 145, 193, 194, "RD"], [145, 145, 193, 194, "WR"]], [[172, 172, 179, 180, "FR"], [179, 180, 187, 188, "EX"], [179, 180, 193, 194, "RD"], [179, 180, 208, 208, "RD"], [179, 180, 210, 211, "RD"], [179, 180, 219, 219, "CO"], [172, 172, 353, 353, "CO"], [172, 172, 516, 516, "CO"]], [[219, 219, 222, 222, "FR"], [222, 222, 232, 233, "RD"], [222, 222, 275, 275, "RD"], [222, 222, 275, 275, "RD"], [222, 222, 275, 275, "WR"], [232, 233, 257, 258, "CO"], [232, 233, 254, 254, "CO"]], [], [], [[299, 299, 275, 275, "RD"], [299, 299, 275, 275, "RD"], [299, 299, 340, 340, "RD"], [299, 299, 275, 275, "WR"], [299, 299, 340, 340, "WR"]], [[353, 353, 361, 361, "RD"], [353, 353, 394, 395, "RD"], [353, 353, 363, 363, "RD"], [353, 353, 394, 395, "WR"], [353, 353, 406, 406, "WR"]], [], [[409, 409, 406, 406, "WR"], [409, 409, 406, 406, "WR"], [409, 409, 432, 432, "FR"]], [[432, 432, 444, 444, "WR"], [432, 432, 448, 448, "RD"], [432, 432, 506, 507, "ST"], [432, 432, 506, 507, "RF"], [432, 432, 451, 451, "CO"], [432, 432, 476, 476, "CO"], [432, 432, 458, 458, "CO"]], [[476, 476, 482, 484, "WR"], [482, 484, 487, 488, "CO"], [482, 484, 493, 493, "CO"]], [], [[516, 516, 506, 507, "ST"], [516, 516, 506, 507, "RF"], [516, 516, 519, 519, "ST"], [516, 516, 519, 519, "RF"], [516, 516, 522, 523, "ST"], [516, 516, 522, 523, "RF"], [516, 516, 525, 525, "CO"], [516, 516, 563, 563, "CO"]], [[525, 525, 527, 528, "FR"], [527, 528, 519, 519, "ST"], [527, 528, 519, 519, "RF"], [527, 528, 522, 523, "ST"], [527, 528, 533, 534, "RD"], [527, 528, 522, 523, "RF"], [527, 528, 533, 534, "WR"], [527, 528, 550, 551, "EX"]], [], [[557, 558, 563, 563, "IJ"], [557, 558, 566, 566, "CO"]], [[566, 566, 571, 571, "RD"], [566, 566, 571, 571, "WR"], [566, 566, 574, 575, "RF"], [566, 566, 581, 581, "FR"]], [], [], [], [], [], []]}