{"doc_key": "051", "sentences": [["As", "part", "of", "the", "ZetaNile", "campaign", ",", "some", "Word", "documents", "have", "been", "found", "to", "utilize", "relationship", "definitions", "to", "load", "XLSM", "files", "embedded", "within", "them", ".", "These", "XLSM", "files", "contain", "the", "VBA", "code", "that", "enables", "the", "downloading", "of", "payloads", "."], ["Furthermore", ",", "additional", "malign", "XLSM", "files", "are", "loaded", "during", "runtime", "."], ["These", "maldocs", "are", "Office", "Open", "XML", "documents", "consisting", "of", "two", "critical", "relationship", "definition", "files", "--", "the", "primary", "one", "named", "``", "AquiTaLimpo.xml.rels", "''", "and", "the", "other", "called", "``", "comments.xml.rels", "''", ".", "These", "files", "link", "to", "the", "embedded", "XLSM", "files", "containing", "the", "VBA", "code", "."], ["The", "VBA", "code", "is", "activated", "through", "a", "macro", "when", "the", "Word", "document", "is", "opened", ",", "and", "Excel", "is", "subsequently", "loaded", "to", "open", "the", "XLSM", "files", "embedded", "in", "the", "document", ",", "allowing", "the", "macro", "to", "initiate", "the", "download", "of", "payloads", "."], ["PPAM", "files", "are", "supplementary", "files", "utilized", "by", "Microsoft", "PowerPoint", "to", "enable", "enhanced", "functionality", ",", "including", "custom", "macros", ",", "tools", ",", "and", "commands", "."], ["The", "attack", "chain", "ultimately", "results", "in", "the", "deployment", "of", "a", "RAT", ",", "which", "could", "either", "be", "njRAT", "or", "AsyncRAT", "."], ["The", "earliest", "instance", "of", "this", "attack", "chain", "involves", "a", "malign", "macro", "within", "the", "PPAM", "file", "that", "downloads", "and", "runs", "a", "remote", "HTA", "file", "via", "an", "attacker-controlled", "location", "."], ["Stage", "1A", "of", "the", "attack", "entails", "a", "malign", "HTA", "that", "is", "an", "escaped", "JavaScript", "snippet", ",", "which", "then", "launches", "a", "VBScript", "(", "embedded", "in", "the", "HTA", ")", "to", "download", "and", "execute", "the", "next", "stage", "of", "the", "infection", "chain", "(", "Stage", "#", "2", "PowerShell", "script", ")", "."], ["An", "un-escaped", "VB", "code", "is", "used", "to", "download", "and", "execute", "Stage", "2", "on", "the", "endpoint", "."], ["When", "Stage", "2", "is", "initiated", ",", "a", "PowerShell", "script", "is", "executed", "on", "the", "endpoint", ",", "serving", "as", "the", "primary", "tool", "in", "the", "infection", "chain", "."], ["The", "script", "carries", "out", "several", "tasks", "on", "the", "endpoint", ",", "beginning", "by", "modifying", "the", "registry", "values", "to", "change", "the", "current", "user", "'s", "Startup", "folders", "to", "match", "those", "outlined", "in", "the", "script", "."], ["Once", "complete", ",", "a", "custom", "VBS", "file", "(", "Stage", "#", "2A", ")", "is", "created", "in", "the", "modified", "Startup", "directory", ",", "allowing", "for", "the", "execution", "of", "a", "downloaded", "PowerShell", "script", "(", "Stage", "#", "3", ":", "e.g.", ",", "``", "msi.ps1", "''", ")", "during", "subsequent", "reboots", "."], ["The", "script", "continues", "by", "checking", "for", "the", "presence", "of", "specific", "antivirus", "products", "on", "the", "endpoint", ".", "Based", "on", "the", "antivirus", "product", ",", "the", "script", "downloads", "and", "executes", "a", "specific", "version", "of", "the", "PS1", "file", "specified", "in", "the", "previous", "step", "(", "Step", "2", "and", "Stage", "3", ",", "e.g.", ",", "``", "msi.ps1", "''", ")", ",", "subsequently", "running", "the", "VB", "script", "created", "in", "Stage", "2A", "."], ["If", "there", "are", "no", "antivirus", "products", "detected", "on", "the", "endpoint", ",", "the", "script", "generates", "four", "configuration", "scripts", "on", "the", "endpoint", "."], ["Script", "1", "modifies", "the", "``", "windir", "''", "path", ",", "allowing", "the", "script", "to", "execute", "itself", "when", "a", "user", "or", "application", "accesses", "the", "``", "windir", "''", "environment", "variable", ",", "while", "also", "running", "Script", "3", "in", "the", "event", "that", "the", "current", "user", "has", "administrator", "credentials", "."], ["Script", "2", "creates", "exclusions", "for", "specific", "paths", "and", "executables", ",", "deploying", "a", ".NET", "framework", "in", "the", "process", "."], ["Script", "3", "runs", "Script", "2", "."], ["Script", "4", "runs", "Script", "1", "."], ["Script", "4", "subsequently", "executes", "on", "the", "endpoint", ",", "and", "once", "the", "configuration", "scripts", "are", "complete", ",", "they", "are", "deleted", "from", "the", "endpoint", "."], ["Finally", ",", "the", "parent", "PS1", "script", "downloads", "another", "version", "of", "the", "Stage", "4", "script", "and", "executes", "it", "via", "the", "Stage", "2A", "VBS", "script", "."], ["A", "DLL", "named", "Hexlified", "injector", "is", "utilized", "to", "execute", "a", "certain", "process", "and", "introduce", "malware", "as", "a", "part", "of", "it", "."], ["To", "load", "the", "injector", "DLL", "into", "powershell", "and", "pass", "the", "target", "process", "'", "image", "path", "and", "malware", "payload", "bytes", ",", "a", "plaintext", "or", "Base64-encoded", "command", "is", "used", ".", "The", "command", "is", "then", "reflected", "into", "the", "powershell", "process", ".", "For", "instance", ",", "this", "code", "can", "be", "used", ":", "[", "Reflection.Assembly", "]", ":", ":Load", "(", "$", "H5", ")", ".GetType", "(", "'VBNET.PE", "'", ")", ".GetMethod", "(", "'Run", "'", ")", ".Invoke", "(", "$", "null", ",", "[", "object", "[", "]", "]", "(", "'", "C", ":", "\\Windows\\", "Microsoft.NET\\", "Framework\\v4.0.30319\\aspnet_compiler.exe", "'", ",", "$", "H1", ")", ")", "."], ["During", "the", "infection", "process", ",", "some", "of", "the", "(", "mini", ")", "scripts", "utilized", "in", "Stage", "2", "are", "hosted", "independently", "and", "downloaded", "and", "executed", ".", "Minor", "variations", "are", "also", "seen", "in", "the", "infection", "chains", "."], ["Several", "executables", "make", "up", "stage", "3", ":", "Injector", "DLL", "and", "malware", "payload", ".", "The", "malware", "payload", "bytes", "are", "injected", "into", "the", "hollowed", "out", "target", "process", "using", "the", "injector", "DLL", ".", "The", "DLL", "is", "a", "basic", "injector", "based", "on", ".NET", "and", "only", "has", "one", "exported", "method", "that", "deploys", "the", "malware", "payload", "into", "the", "target", "process", ".", "The", "DLL", "is", "usually", "obfuscated", "with", ".NET", "Reactor", "but", "can", "be", "deobfuscated", "with", "de4dot", ".", "Any", "errors", "during", "the", "injection", "process", "will", "cause", "the", "target", "process", "to", "be", "killed", "and", "retried", "five", "times", "before", "giving", "up", "."], ["The", "DLL", "is", "a", "modified", "version", "of", "RunPE", "and", "interestingly", "includes", "unused", "code", "that", "can", "change", "ACL", "to", "kernel", "objects", ".", "This", "unused", "code", "suggests", "either", "a", "work-in-progress", "or", "redundant", "code", "borrowed", "from", "elsewhere", "."]], "ner": [[[5, 5, "MP"], [8, 9, "MF"], [19, 20, "MF"], [30, 31, "MF"], [37, 37, "MF"]], [[43, 44, "MF"]], [[51, 51, "MF"], [53, 56, "MF"], [70, 70, "MF"], [77, 77, "MF"], [86, 87, "MF"], [90, 91, "MF"]], [[103, 104, "MP"], [109, 109, "MP"], [116, 117, "MF"], [125, 125, "MF"], [131, 131, "MF"]], [[133, 134, "MF"], [140, 141, "MP"], [148, 149, "TP"], [151, 151, "TP"], [154, 154, "TP"]], [[157, 158, "MP"], [172, 172, "MF"], [174, 174, "MF"]], [[181, 182, "MP"], [186, 186, "MF"], [197, 198, "MF"], [201, 202, "SO"]], [[212, 212, "MP"], [217, 218, "MP"], [224, 224, "MF"], [240, 241, "MP"], [246, 247, "MF"]], [[252, 253, "MF"]], [[273, 274, "MP"]], [[292, 292, "MP"], [305, 306, "SF"], [313, 314, "SF"]], [[328, 329, "MF"], [350, 353, "MF"], [360, 360, "MF"]], [[368, 368, "MP"], [381, 381, "SO"], [390, 390, "MP"], [399, 400, "MF"], [416, 416, "MF"], [423, 424, "MF"]], [[439, 439, "SO"], [442, 442, "MP"], [445, 446, "MF"]], [[451, 451, "MF"], [456, 456, "SF"], [474, 474, "SF"]], [[495, 495, "MP"], [498, 498, "MF"], [503, 503, "MP"]], [[513, 514, "MP"], [516, 517, "MF"]], [[519, 520, "MP"], [522, 523, "MF"]], [], [[552, 553, "MP"], [559, 561, "MF"], [564, 564, "MF"], [569, 570, "MP"]], [[575, 576, "MF"], [583, 583, "MP"], [586, 586, "MP"]], [[596, 597, "MF"], [603, 607, "TF"], [609, 611, "MF"], [614, 614, "MP"], [616, 616, "MP"], [651, 651, "MF"], [671, 675, "MF"]], [[685, 686, "MP"], [694, 694, "MF"]], [[718, 718, "MP"], [727, 728, "MF"], [731, 732, "MF"], [748, 748, "MF"], [755, 755, "MP"], [765, 766, "MF"], [769, 770, "MP"], [791, 791, "MP"], [796, 797, "MP"]], [[810, 810, "MF"], [816, 816, "MF"], [839, 839, "MF"]]], "relations": [[[5, 5, 8, 9, "WR"], [5, 5, 19, 20, "RD"], [5, 5, 30, 31, "EX"], [5, 5, 37, 37, "WR"], [5, 5, 51, 51, "WR"], [5, 5, 53, 56, "WR"], [5, 5, 70, 70, "WR"], [5, 5, 77, 77, "WR"]], [[43, 44, 86, 87, "CO"], [43, 44, 19, 20, "CO"]], [[90, 91, 30, 31, "CO"]], [[103, 104, 51, 51, "WR"], [103, 104, 53, 56, "WR"], [103, 104, 70, 70, "WR"], [103, 104, 77, 77, "WR"], [103, 104, 86, 87, "WR"], [103, 104, 90, 91, "WR"], [103, 104, 90, 91, "WR"], [109, 109, 116, 117, "RD"], [109, 109, 125, 125, "EX"], [109, 109, 131, 131, "WR"]], [[140, 141, 133, 134, "WR"], [140, 141, 148, 149, "FR"], [140, 141, 151, 151, "FR"], [140, 141, 154, 154, "FR"], [154, 154, 157, 158, "FR"]], [[157, 158, 172, 172, "WR"], [157, 158, 172, 172, "WR"], [157, 158, 174, 174, "WR"]], [[181, 182, 172, 172, "WR"], [181, 182, 174, 174, "WR"], [181, 182, 186, 186, "WR"], [181, 182, 197, 198, "WR"], [181, 182, 197, 198, "EX"], [181, 182, 201, 202, "ST"], [181, 182, 201, 202, "RF"]], [[212, 212, 224, 224, "EX"], [240, 241, 224, 224, "RD"], [212, 212, 246, 247, "WR"], [212, 212, 246, 247, "EX"], [240, 241, 246, 247, "WR"], [240, 241, 252, 253, "WR"], [212, 212, 217, 218, "CO"]], [], [[273, 274, 252, 253, "WR"], [273, 274, 305, 306, "RD"], [273, 274, 252, 253, "WR"], [273, 274, 313, 314, "RD"], [273, 274, 292, 292, "CO"]], [[292, 292, 305, 306, "WR"], [292, 292, 313, 314, "WR"], [292, 292, 328, 329, "WR"], [292, 292, 350, 353, "EX"], [292, 292, 360, 360, "WR"]], [], [[368, 368, 360, 360, "WR"], [368, 368, 381, 381, "ST"], [368, 368, 381, 381, "RF"], [390, 390, 399, 400, "WR"], [390, 390, 416, 416, "WR"], [390, 390, 423, 424, "EX"], [368, 368, 456, 456, "RD"], [390, 390, 456, 456, "WR"], [368, 368, 390, 390, "CO"], [381, 381, 439, 439, "CO"]], [[442, 442, 439, 439, "ST"], [442, 442, 439, 439, "RF"], [442, 442, 445, 446, "WR"], [442, 442, 451, 451, "WR"], [442, 442, 474, 474, "RD"], [442, 442, 474, 474, "RD"], [442, 442, 474, 474, "WR"]], [], [[495, 495, 474, 474, "RD"], [495, 495, 474, 474, "RD"], [495, 495, 474, 474, "WR"], [495, 495, 498, 498, "WR"], [503, 503, 498, 498, "RD"]], [[513, 514, 516, 517, "EX"]], [[519, 520, 522, 523, "EX"]], [], [[552, 553, 559, 561, "WR"], [552, 553, 569, 570, "FR"], [569, 570, 564, 564, "EX"], [559, 561, 564, 564, "CO"]], [[583, 583, 575, 576, "EX"], [583, 583, 586, 586, "IJ"]], [[614, 614, 596, 597, "RD"], [616, 616, 596, 597, "RD"], [616, 616, 603, 607, "WR"], [616, 616, 609, 611, "WR"], [616, 616, 651, 651, "WR"], [616, 616, 671, 675, "WR"]], [[685, 686, 651, 651, "WR"], [685, 686, 671, 675, "WR"], [685, 686, 694, 694, "WR"], [685, 686, 694, 694, "EX"]], [[718, 718, 727, 728, "WR"], [755, 755, 731, 732, "WR"], [755, 755, 748, 748, "WR"], [755, 755, 765, 766, "WR"], [769, 770, 765, 766, "WR"], [769, 770, 765, 766, "WR"], [791, 791, 796, 797, "UK"], [731, 732, 727, 728, "CO"], [769, 770, 796, 797, "CO"]], []]}