{"doc_key": "069", "sentences": [["MuddyWater", "frequently", "relies", "on", "the", "use", "of", "DNS", "to", "contact", "their", "C2", "servers", ",", "while", "the", "initial", "contact", "with", "hosting", "servers", "is", "done", "via", "HTTP", "."], ["The", "dropped", "payload", "is", "a", "PowerShell", "script", "that", "loads", "another", "PowerShell", "script", "that", "downloads", "and", "executes", "a", "final", "PowerShell-based", "payload", "."], ["Later", ",", "the", "actors", "graduated", "to", "a", "more", "professional", "implementation", "of", "the", "token", "by", "using", "canarytokens.com", "'s", "infrastructure.canarytokens.com", "is", "a", "legitimate", "service", "that", "MuddyWater", "uses", "to", "make", "their", "operations", "appear", "less", "suspicious", "."], ["This", "campaign", "deployed", "a", "PowerShell-based", "downloader", "on", "the", "endpoint", "to", "accept", "and", "execute", "additional", "PS1", "commands", "from", "the", "C2", "server", "."], ["In", "this", "case", ",", "however", ",", "the", "attackers", "attempted", "to", "deploy", "the", "Connectwise", "Remote", "Access", "client", "on", "the", "target", "'s", "endpoints", ",", "a", "tactic", "commonly", "used", "by", "MuddyWater", "to", "gain", "an", "initial", "foothold", "on", "targets", "'", "endpoints", "."], ["In", "the", "attacks", "deploying", "the", "RAT", "in", "April", "2021", "and", "the", "EXE-based", "infection", "vector", "from", "August", "2021", ",", "the", "maldocs", "and", "decoy", "documents", "reached", "out", "to", "a", "common", "server", "to", "download", "a", "common", "image", "file", "that", "links", "them", "."], ["In", "this", "case", ",", "the", "maldocs", "have", "an", "external", "entity", "downloaded", "from", "an", "attacker-controller", "server", "."], ["The", "same", "base", "URL", "is", "employed", "in", "both", "campaigns", ":", "hxxp", ":", "//172.245.81.135:10196/Geq5P3aFpaSrK3PZtErNgUsVCfqQ9kZ9/However", ",", "the", "maldoc", "appends", "the", "additional", "URL", "extension", "''", "ef4f0d9af47d737076923cfccfe01ba7/layer.jpg", "''", "while", "the", "decoy", "appends", "``", "/Pan-op/gallery.jpg", "''", "."], ["It", "is", "highly", "likely", "that", "the", "attackers", "used", "this", "server", "as", "a", "token", "tracker", "to", "keep", "track", "of", "successful", "infections", "in", "this", "campaign", "."], ["The", "maldoc", "consists", "of", "a", "malicious", "macro", "that", "drops", "two", "WSF", "files", "on", "the", "endpoint", "."], ["One", "of", "these", "scripts", "is", "the", "instrumentor", "script", "meant", "to", "execute", "the", "next", "stage", "."], ["This", "instrumentor", "script", "is", "placed", "in", "the", "current", "user", "'s", "Startup", "folder", "by", "the", "VBA", "macro", "to", "establish", "persistence", "across", "reboots", "."], ["The", "second", "script", "is", "a", "WSF-based", "RAT", "we", "call", "``", "SloughRAT", "''", "that", "can", "execute", "arbitrary", "commands", "on", "the", "infected", "endpoint", "."], ["Excel", "document", "that", "drops", "the", "Outlook.wsf", "file", "."], ["However", ",", "at", "its", "core", ",", "the", "script", "is", "solely", "meant", "to", "execute", "the", "next", "stage", "WSF", "RAT", "payload", "."], ["At", "runtime", ",", "the", "code", "deobfuscates", "two", "key", "components", "for", "the", "next", "stage", ":", "Path", "to", "the", "RAT", "script", "that", "'s", "hard-coded", "but", "obfuscated", "."], ["This", "data", "is", "then", "used", "to", "make", "a", "call", "to", "the", "WSF-based", "RAT", ":", "cmd.exe", "/c", "<", "path_to_WSF_RAT", ">", "<", "key", ">", "Deobfuscation", "of", "persistence", "."], ["SloughRAT", "analysisThe", "WSF", "implant", "has", "several", "capabilities", "."], ["The", "script", "uses", "multilayer", "obfuscation", "to", "hide", "its", "true", "extensions", "."], ["The", "RAT", "script", "needs", "a", "function", "name", "as", "an", "argument", "to", "execute", "correctly", "and", "perform", "its", "malicious", "activities", "."], ["Preliminary", "information", "gathering", "and", "infection", "registrationThe", "RAT", "script", "begins", "execution", "by", "performing", "a", "WMI", "query", "to", "record", "the", "IP", "address", "of", "the", "infected", "endpoint", "."], ["It", "will", "then", "get", "the", "user", "and", "computer", "names", "by", "querying", "the", "environment", "variables", ":", "%", "COMPUTERNAME", "%", "%", "USERNAME", "%", "Deobfuscation", "of", "discovery", "capabilities", "."], ["This", "system", "information", "is", "then", "concatenated", "using", "a", "delimiter", "and", "encoded", "to", "register", "the", "infected", "system", "with", "the", "C2", "server", "hardcoded", "into", "the", "implant", "."], ["Once", "the", "infection", "is", "registered", "with", "the", "C2", "server", ",", "the", "implant", "will", "receive", "a", "command", "code", "from", "the", "C2", "server", "."], ["The", "implant", "uses", "two", "different", "URLs", ":", "One", "is", "used", "to", "register", "the", "implant", "and", "request", "arbitrary", "commands", "from", "the", "C2", "."], ["Another", "that", "is", "used", "to", "POST", "the", "results", "of", "the", "commands", "executed", "on", "the", "infected", "endpoint", "."], ["The", "communication", "with", "the", "C2", "is", "done", "using", "the", "common", "ServerXMLHTTP", "from", "the", "MSXML2", "API", "to", "instrument", "an", "HTTP", "POST", "request", "."], ["The", "time", "between", "each", "request", "is", "randomized", ",", "which", "makes", "the", "malware", "stealthier", "and", "can", "bypass", "some", "sandboxes", "."], ["Deobfuscation", "of", "HTTP", "request", "construction", "."], ["Any", "data", "sent", "to", "the", "C2", "server", "is", "in", "the", "format", "of", "HTTP", "forms", "accompanied", "by", "relevant", "headers", ",", "like", ":", "Content-TypeContent-LengthCharSet", "."], ["First", ",", "the", "script", "sends", "the", "system", "information", "to", "the", "first", "C2", "URL", ",", "by", "encoding", "the", "message", ",", "and", "sending", "it", "via", "POST", "request", ",", "inside", "the", "parameter", "``", "vl", "''", "using", "the", "following", "format", ":", "<", "IP_address", ">", "|", "!", ")", "!"], [")", "!", "|", "%", "ComputerName", "%", "/", "%", "USERNAME", "%", "Then", ",", "the", "server", "returns", "a", "UID", "constructed", "via", "concatenation", "of", "the", "server", "IP", "and", "an", "UUIDv4", "."], ["For", "example", ",", "the", "UID", "5-199-133-149-", "<", "UUIDv4", ">", "is", "stored", "in", "a", "variable", "and", "sends", "keep-alive", "messages", "to", "request", "commands", "from", "the", "C2", "."], ["Then", ",", "this", "UID", "is", "sent", "through", "``", "vl", "''", "parameters", "inside", "a", "POST", "HTTP", "request", "to", "another", "C2", "URL", "."], ["When", "the", "server", "receives", "this", "UID", ",", "it", "returns", "an", "encoded", "message", "that", "the", "script", "interprets", "."], ["The", "message", "can", "be", ":", "''", "ok", "''", ":", "Do", "nothing", "and", "send", "the", "UID", "again", "(", "like", "a", "keep-alive", ")", "."], ["``", "401", "''", ":", "This", "order", "cleans", "the", "UID", "variable", "and", "forces", "the", "script", "to", "request", "another", "UID", ",", "by", "sending", "a", "request", "to", "the", "first", "URI", "."], ["A", "command", "to", "execute", "that", "starts", "the", "command", "execution", "routine", "."], ["A", "command", "received", "from", "the", "C2", "server", "will", "be", "executed", "using", "the", "command", "line", "utility", "."], ["Its", "output", "is", "recorded", "in", "a", "temporary", "file", "on", "disk", "in", "a", "location", "such", "as", "``", "%", "TEMP", "%", "\\stari.txt", "''", "."], ["This", "data", "is", "then", "immediately", "read", "and", "sent", "out", "to", "the", "C2", "."], ["The", "message", "will", "have", "the", "following", "format", ":", "<", "UID", ">", "|", "!", ")", "!"], [")", "!", "|", "<", "result", "of", "command", "output", ">", "Commands", "are", "executed", "using", "the", "command", "line", ":", "cmd.exe", "/c", "<", "command_sent_by_C2", ">", ">", ">", "<", "path_to_temp_file", ">", "Deobfuscation", "of", "command", "execution", "routine", "."], ["The", "attackers", "utilized", "SloughRAT", "to", "deploy", "Ligolo", ",", "an", "open-source", "reverse-tunneling", "tool", "to", "gain", "a", "greater", "degree", "of", "control", "over", "the", "infected", "endpoints", "."], ["The", "output", "of", "the", "command", "would", "be", "written", "to", "a", "temporary", "file", "in", "the", "%", "APPDATA", "%", "directory", "and", "subsequently", "read", "and", "exfiltrated", "to", "the", "C2", "."], ["The", "maldoc", "contains", "a", "macro", "that", "would", "drop", "a", "malicious", "obfuscated", "VBS", "in", "a", "directory", "on", "the", "system", "."], ["The", "macros", "would", "then", "create", "persistence", "for", "the", "VBS", "via", "the", "Registry", "Run", "key", "of", "the", "current", "user", "."], ["This", "VBS", "is", "responsible", "for", "deobfuscating", "the", "next", "payloads", "and", "executing", "them", "on", "the", "endpoint", "."], ["This", "execution", "culminated", "into", "a", "malicious", "JS", "downloader", "being", "executed", "on", "the", "system", "to", "download", "and", "execute", "commands", "."], ["Orbital", "QueriesCisco", "Secure", "Endpoint", "users", "can", "use", "Orbital", "Advanced", "Search", "to", "run", "complex", "OSqueries", "to", "see", "if", "their", "endpoints", "are", "infected", "with", "this", "specific", "threat", "."]], "ner": [[[0, 0, "MP"], [7, 7, "TP"], [11, 12, "SO"], [19, 20, "SO"], [24, 24, "TP"]], [[27, 28, "MF"], [31, 32, "MF"], [36, 37, "MP"], [44, 45, "MF"]], [[50, 50, "MP"], [59, 59, "MF"], [62, 62, "TP"], [64, 64, "TP"], [70, 70, "MP"]], [[81, 81, "MP"], [85, 85, "MP"], [94, 95, "MF"], [98, 99, "SO"]], [[108, 108, "MP"], [113, 116, "TP"], [121, 121, "SO"], [128, 128, "MP"], [137, 137, "SO"]], [[141, 141, "MP"], [144, 144, "MF"], [150, 152, "MP"], [158, 158, "MF"], [160, 161, "MF"], [172, 173, "MF"]], [[183, 183, "MP"], [192, 192, "SO"]], [[197, 197, "MF"], [202, 202, "MP"], [213, 213, "MF"]], [[232, 232, "MP"], [235, 235, "TP"], [238, 239, "TP"], [248, 248, "MP"]], [[251, 251, "MP"], [256, 256, "MF"], [260, 261, "MF"], [264, 264, "SO"]], [[272, 273, "MF"]], [[282, 283, "MF"], [295, 296, "MP"]], [[304, 305, "MF"], [308, 309, "MF"]], [[325, 326, "MP"], [330, 331, "MF"]], [[340, 340, "MP"], [349, 351, "MF"]], [[357, 357, "MP"], [367, 371, "MF"]], [[379, 379, "MF"], [389, 390, "MF"]], [[404, 404, "MP"]], [[413, 413, "MP"]], [[424, 425, "MP"], [439, 440, "MF"]], [[448, 449, "MP"], [455, 456, "MP"], [464, 465, "SO"]], [[467, 467, "MP"], [472, 472, "TF"], [474, 475, "TF"]], [[494, 495, "SF"], [511, 512, "SO"]], [[525, 526, "SO"], [529, 529, "MP"], [533, 534, "MF"], [537, 538, "SO"]], [[541, 541, "MP"], [545, 545, "MF"], [547, 547, "MP"], [557, 557, "MF"], [560, 560, "SO"]], [[562, 562, "MP"], [569, 569, "MF"], [576, 577, "SO"]], [[580, 580, "MP"], [583, 583, "SO"], [589, 589, "TP"]], [[612, 612, "MP"]], [[622, 624, "MP"]], [[631, 632, "SO"]], [[652, 652, "MP"], [655, 656, "SF"], [660, 661, "SO"], [666, 666, "SF"], [672, 673, "TP"]], [[706, 706, "SO"], [709, 709, "SF"]], [[725, 725, "SF"], [737, 738, "MF"], [744, 744, "SO"]], [[749, 749, "SF"]], [[769, 769, "SO"], [772, 772, "SF"], [774, 774, "SO"], [777, 778, "MF"]], [[785, 785, "MF"], [798, 798, "SF"]], [[811, 811, "MP"], [814, 815, "SF"], [823, 823, "SF"], [831, 832, "SO"]], [[835, 835, "MP"], [841, 841, "MF"]], [[846, 846, "MF"], [850, 851, "SO"], [857, 859, "TP"]], [[867, 868, "TF"]], [[884, 884, "MF"], [894, 894, "SO"]], [], [[920, 920, "MF"]], [[945, 945, "MP"], [947, 947, "MP"], [950, 950, "MP"], [965, 966, "SO"]], [[978, 979, "TF"], [993, 993, "SO"]], [[996, 996, "MP"], [999, 999, "MF"], [1006, 1006, "MF"]], [[1015, 1015, "MP"], [1025, 1027, "TP"]], [[1034, 1034, "MP"], [1041, 1041, "MF"], [1047, 1047, "SO"]], [[1055, 1056, "MP"], [1066, 1066, "MF"]], [[1072, 1072, "MP"], [1075, 1077, "TP"], [1081, 1081, "MF"]]], "relations": [[[0, 0, 7, 7, "FR"], [7, 7, 11, 12, "ST"], [7, 7, 11, 12, "RF"], [0, 0, 19, 20, "ST"], [0, 0, 19, 20, "RF"], [0, 0, 24, 24, "FR"]], [[36, 37, 31, 32, "EX"], [36, 37, 44, 45, "WR"], [36, 37, 44, 45, "EX"], [27, 28, 31, 32, "CO"]], [[50, 50, 62, 62, "FR"], [62, 62, 59, 59, "WR"], [70, 70, 64, 64, "FR"], [50, 50, 108, 108, "CO"], [50, 50, 232, 232, "CO"], [50, 50, 945, 945, "CO"]], [[81, 81, 85, 85, "FR"], [85, 85, 94, 95, "EX"], [85, 85, 98, 99, "RF"]], [[108, 108, 113, 116, "FR"], [113, 116, 121, 121, "ST"], [113, 116, 121, 121, "RF"], [128, 128, 121, 121, "ST"], [128, 128, 121, 121, "RF"], [128, 128, 121, 121, "ST"], [128, 128, 121, 121, "RF"], [128, 128, 137, 137, "ST"], [128, 128, 137, 137, "RF"], [128, 128, 137, 137, "ST"], [128, 128, 137, 137, "RF"]], [[141, 141, 137, 137, "ST"], [141, 141, 137, 137, "RF"], [141, 141, 144, 144, "EX"], [141, 141, 158, 158, "WR"], [150, 152, 158, 158, "WR"], [141, 141, 160, 161, "WR"], [150, 152, 160, 161, "WR"], [141, 141, 172, 173, "WR"], [150, 152, 172, 173, "WR"]], [[183, 183, 192, 192, "RF"]], [[202, 202, 197, 197, "WR"], [202, 202, 213, 213, "WR"]], [[232, 232, 235, 235, "FR"], [235, 235, 248, 248, "FR"], [248, 248, 264, 264, "ST"], [248, 248, 264, 264, "RF"], [235, 235, 238, 239, "CO"]], [[251, 251, 256, 256, "WR"], [251, 251, 260, 261, "WR"], [251, 251, 264, 264, "ST"]], [[272, 273, 282, 283, "CO"]], [[295, 296, 282, 283, "WR"]], [[304, 305, 308, 309, "CO"]], [[325, 326, 330, 331, "WR"]], [[340, 340, 349, 351, "EX"]], [[357, 357, 367, 371, "WR"], [357, 357, 379, 379, "EX"], [357, 357, 389, 390, "RD"]], [], [[404, 404, 389, 390, "RD"]], [[413, 413, 424, 425, "CO"]], [[424, 425, 439, 440, "EX"]], [[448, 449, 455, 456, "FR"], [448, 449, 464, 465, "ST"], [448, 449, 494, 495, "RD"], [448, 449, 467, 467, "CO"]], [[467, 467, 472, 472, "RD"], [467, 467, 474, 475, "RD"], [467, 467, 494, 495, "WR"], [467, 467, 511, 512, "ST"], [467, 467, 525, 526, "ST"]], [], [[529, 529, 533, 534, "RD"], [529, 529, 537, 538, "RF"]], [[541, 541, 545, 545, "RD"], [547, 547, 557, 557, "WR"], [547, 547, 560, 560, "ST"], [547, 547, 560, 560, "RF"]], [[562, 562, 569, 569, "RD"], [562, 562, 576, 577, "ST"]], [[580, 580, 589, 589, "FR"], [589, 589, 583, 583, "ST"], [589, 589, 583, 583, "RF"], [589, 589, 612, 612, "FR"], [589, 589, 622, 624, "FR"]], [[612, 612, 631, 632, "ST"], [612, 612, 631, 632, "RF"]], [[622, 624, 631, 632, "ST"], [622, 624, 631, 632, "RF"], [622, 624, 631, 632, "ST"], [622, 624, 631, 632, "RF"]], [], [[652, 652, 631, 632, "ST"], [652, 652, 655, 656, "RD"], [652, 652, 631, 632, "RF"], [652, 652, 655, 656, "WR"], [652, 652, 655, 656, "RD"], [652, 652, 660, 661, "ST"], [652, 652, 666, 666, "WR"], [652, 652, 672, 673, "FR"], [672, 673, 706, 706, "ST"], [672, 673, 706, 706, "RF"], [652, 652, 737, 738, "WR"], [652, 652, 744, 744, "ST"], [652, 652, 769, 769, "ST"], [652, 652, 774, 774, "RF"], [652, 652, 777, 778, "RD"], [672, 673, 798, 798, "RD"], [672, 673, 798, 798, "RD"], [672, 673, 798, 798, "WR"], [652, 652, 850, 851, "RF"], [652, 652, 857, 859, "FR"], [652, 652, 884, 884, "RD"], [652, 652, 894, 894, "ST"], [655, 656, 666, 666, "CO"]], [[709, 709, 725, 725, "CO"], [709, 709, 749, 749, "CO"], [709, 709, 772, 772, "CO"], [706, 706, 769, 769, "CO"]], [], [], [[769, 769, 774, 774, "CO"], [777, 778, 785, 785, "CO"]], [], [[811, 811, 798, 798, "RD"], [811, 811, 798, 798, "RD"], [811, 811, 798, 798, "WR"], [811, 811, 814, 815, "UK"], [811, 811, 823, 823, "RD"], [811, 811, 831, 832, "ST"]], [[835, 835, 841, 841, "EX"], [835, 835, 920, 920, "EX"]], [[857, 859, 846, 846, "EX"], [857, 859, 867, 868, "WR"]], [], [], [], [], [[945, 945, 947, 947, "FR"], [947, 947, 950, 950, "FR"], [950, 950, 965, 966, "ST"], [950, 950, 965, 966, "RF"], [945, 945, 978, 979, "WR"], [945, 945, 993, 993, "ST"]], [], [[996, 996, 965, 966, "ST"], [996, 996, 965, 966, "RF"], [996, 996, 999, 999, "WR"], [996, 996, 1006, 1006, "WR"]], [[1015, 1015, 999, 999, "EX"], [1015, 1015, 1025, 1027, "FR"]], [[1034, 1034, 1006, 1006, "EX"], [1034, 1034, 1041, 1041, "WR"], [1034, 1034, 1047, 1047, "ST"]], [[1055, 1056, 1066, 1066, "WR"], [1055, 1056, 1066, 1066, "EX"]], [[1072, 1072, 1075, 1077, "FR"], [1072, 1072, 1081, 1081, "EX"]]]}