{"doc_key": "009", "sentences": [["Remote", "templates", "containing", "malicious", "VBS", "macros", "are", "used", "to", "gain", "initial", "access", "in", "this", "attack", "."], ["Upon", "opening", "the", "document", ",", "these", "macros", "are", "executed", ",", "downloading", "RAR", "archives", "that", "contain", "LNK", "files", "."], ["Typically", ",", "these", "compressed", "archives", "contain", "only", "an", "LNK", "file", "."], ["Once", "opened", ",", "the", "LNK", "files", "attempt", "to", "execute", "MSHTA.EXE", ",", "which", "downloads", "and", "parses", "a", "remote", "XML", "file", "that", "executes", "a", "malicious", "PowerShell", "script", "."], ["The", "domain", "xsph.ru", "is", "known", "to", "be", "used", "by", "Gamaredon", "for", "this", "purpose", "."], ["Interestingly", ",", "the", "servers", "involved", "in", "this", "campaign", "only", "allow", "access", "from", "IP", "addresses", "within", "the", "Ukrainian", "address", "space", "."], ["The", "second-stage", "PowerShell", "script", "(", "instrumentor", ")", "is", "decoded", "and", "executed", "by", "the", "initial", "PowerShell", "script", "."], ["This", "instrumentor", "collects", "data", "from", "the", "victim", "endpoint", "and", "reports", "back", "to", "a", "remote", "server", "."], ["Furthermore", ",", "it", "allows", "the", "server", "to", "send", "a", "PowerShell", "command", "or", "binary", "blob", "containing", "encrypted", "VBScript", "(", "VBS", ")", "code", "to", "be", "executed", "locally", "."], ["This", "means", "that", "additional", "payloads", "and", "commands", "can", "be", "run", "on", "the", "endpoint", "using", "the", "second-stage", "PowerShell", "script", "."], ["The", "instrumentor", "PowerShell", "script", "usually", "contains", "a", "function", "that", "decodes", "the", "encrypted", "response", "from", "the", "Command", "and", "Control", "(", "C2", ")", "server", "and", "executes", "it", "as", "a", "VBScript", "object", "."], ["The", "PowerShell", "script", "repeatedly", "captures", "the", "current", "user", "'s", "screen", "using", "the", "``", "System.Windows.Forms", "''", "object", "."], ["This", "code", "captures", "a", "copy", "of", "the", "virtual", "desktop", ",", "including", "those", "with", "multiple", "screens", ",", "and", "takes", "nine", "screenshots", "."], ["However", ",", "each", "screenshot", "is", "saved", "to", "the", "same", "location", "(", "``", "%", "TEMP", "%", "\\test.png", "''", ")", ",", "overwriting", "previous", "captures", "."], ["The", "resulting", "images", "(", "PNG", "files", ")", "are", "converted", "to", "base64-encoded", "strings", ",", "stored", "in", "variables", ",", "and", "then", "deleted", "from", "the", "disk", "."], ["The", "script", "then", "uploads", "the", "victim", "'s", "information", "to", "a", "remote", "server", ",", "which", "includes", "system", "information", "and", "screenshots", "."], ["If", "commands", "are", "included", "in", "the", "server", "'s", "response", ",", "they", "are", "executed", "via", "the", "IEX", "command", ",", "and", "their", "output", "is", "added", "to", "the", "``", "cmd", "''", "variable", "before", "being", "sent", "back", "to", "the", "C2", "server", "."], ["However", ",", "if", "the", "response", "starts", "with", "a", "different", "character", ",", "it", "is", "treated", "as", "an", "encrypted", "blob", "passed", "to", "the", "decoder", "function", "along", "with", "the", "volume", "serial", "number", "and", "executed", "as", "VBScript", "."], ["One", "of", "the", "payloads", "served", "to", "the", "instrumentor", "script", "sets", "up", "a", "Registry", "RUN", "key", "to", "execute", "another", "PowerShell", "script", "stored", "in", "an", "environmental", "variable", "."], ["Finally", ",", "the", "``", "Get-IP", "''", "function", "queries", "a", "DNS", "lookup", "service", "for", "an", "attacker-specified", "domain", "and", "uses", "one", "of", "the", "returned", "IP", "addresses", "to", "download", "next-stage", "payloads", "."], ["The", "next-stage", "payload", "is", "retrieved", "by", "the", "PowerShell", "script", "using", "a", "URL", "constructed", "from", "the", "IP", "address", "."], ["This", "script", "is", "saved", "in", "``", "$", "env", ":", "Include", "''", "and", "executed", "when", "the", "user", "logs", "in", "via", "the", "HKCU\\Run", "key", ",", "thus", "providing", "attackers", "with", "persistent", "access", "to", "the", "compromised", "endpoint", "and", "allowing", "them", "to", "deploy", "additional", "payloads", "as", "required", "."], ["To", "maintain", "persistence", ",", "the", "script", "fetches", "the", "remote", "location", "'s", "IP", "and", "saves", "it", "in", "an", "environment", "variable", "."], ["The", "PowerShell", "code", "residing", "in", "this", "variable", "uses", "the", "Get-IP", "(", ")", "function", "again", "to", "get", "a", "random", "IP", "assigned", "to", "the", "domain", "and", "queries", "a", "URL", "constructed", "from", "that", "IP", "address", "and", "a", "hardcoded", "extended", "resource", "."], ["As", "with", "the", "previous", "script", ",", "communications", "with", "the", "C2", "server", "involve", "the", "computer", "name", "and", "volume", "serial", "number", "."], ["The", "C2", "server", "then", "encodes", "the", "next-stage", "payload", "and", "serves", "it", "to", "the", "script", "."], ["If", "the", "response", "from", "the", "C2", "starts", "with", "``", "http", ",", "''", "the", "content", "is", "treated", "as", "a", "URL", "from", "which", "to", "download", "the", "final", "payload", "binary", "."], ["The", "Volume", "Serial", "Number", "and", "Computer", "Name", "are", "passed", "to", "this", "URL", ",", "and", "the", "XorBytes", "function", "decodes", "the", "response", "."], ["The", "decrypted", "binary", "is", "then", "saved", "to", "the", "``", "%", "TEMP", "%", "''", "folder", "with", "a", "filename", "consisting", "of", "a", "random", "string", "of", "numbers", "and", "the", "``", ".exe", "''", "extension", "before", "being", "executed", "."], ["Alternatively", ",", "if", "the", "response", "from", "the", "C2", "does", "not", "begin", "with", "``", "http", ",", "''", "the", "content", "is", "treated", "as", "a", "VBS", "file", "and", "executed", "via", "a", "COM", "object", "."], ["The", "PowerShell", "script", "used", "by", "the", "attackers", "deployed", "an", "information-stealing", "executable", "that", "focuses", "on", "extracting", "files", "with", "specific", "extensions", "from", "the", "infected", "endpoint", "."], ["These", "file", "types", "include", ".doc", ",", ".docx", ",", ".xls", ",", ".rtf", ",", ".odt", ",", ".txt", ",", ".jpg", ",", ".jpeg", ",", ".pdf", ",", ".ps1", ",", ".rar", ",", ".zip", ",", ".7z", ",", "and", ".mdb", "."], ["The", "malware", "stores", "information", "about", "exfiltrated", "files", "in", "a", "file", "named", "``", "profiles_c.ini", "''", "located", "in", "the", "``", "%", "USERPROFILE", "%", "\\Appdata\\Local", "''", "directory", "."], ["Specifically", ",", "the", "file", "includes", "the", "MD5", "hash", "of", "a", "string", "containing", "the", "filename", ",", "file", "size", ",", "and", "modification", "date", "for", "each", "exfiltrated", "file", "."], ["Upon", "activation", ",", "the", "malware", "scans", "all", "attached", "storage", "devices", "looking", "for", "files", "with", "the", "targeted", "extensions", "."], ["For", "each", "file", "discovered", ",", "the", "malware", "submits", "a", "POST", "request", "that", "includes", "metadata", "regarding", "the", "stolen", "file", "and", "its", "contents", "."], ["To", "exfiltrate", "files", ",", "the", "implant", "sends", "POST", "data", "that", "includes", "metadata", "and", "raw", "content", "of", "each", "file", "to", "a", "random", "URI", "under", "the", "parent", "C2", "domain", "."], ["The", "implant", "generates", "a", "subdomain", "for", "sending", "requests", "to", ",", "which", "is", "a", "random", "12-character", "string", "."], ["In", "the", "search", "for", "relevant", "file", "extensions", ",", "the", "implant", "looks", "through", "fixed", "and", "remote", "drives", ",", "particularly", "in", "the", "``", "C", ":", "\\Users", "''", "folder", ",", "while", "avoiding", "enumeration", "of", "any", "folder", "containing", "predefined", "strings", "in", "the", "path", "."], ["This", "suggests", "that", "the", "goal", "of", "the", "malware", "is", "to", "avoid", "exfiltrating", "system", "files", "and", "focus", "on", "user", "files", "of", "interest", "."], ["The", "implant", "calculates", "the", "MD5", "hash", "of", "specific", "information", "for", "each", "file", "exfiltrated", "and", "stores", "it", "in", "the", "``", "%", "LocalAppData", "%", "\\profiles_c.ini", "''", "file", "."], ["Additionally", ",", "the", "implant", "steals", "files", "from", "removable", "drives", "connected", "to", "the", "infected", "endpoint", "by", "creating", "a", "randomly", "named", "folder", "in", "the", "%", "TEMP", "%", "directory", "and", "copying", "the", "original", "file", "there", "."], ["For", "example", ",", "if", "a", "file", "named", "``", "isengard.doc", "''", "is", "located", "in", "a", "remote", "drive", "``", "E", ":", "''", "at", "path", "``", "E", ":", "\\top_secret_docs", ",", "''", "it", "will", "be", "copied", "to", "``", "%", "temp", "%", "\\randomly_named_folder\\connect", "<", "removable_vol_serial_number", ">", "\\top_secret_docs\\isengard.doc", "''", "."], ["Finally", ",", "the", "contents", "of", "the", "folder", "are", "exfiltrated", "to", "the", "C2", "."], ["This", "binary", ",", "like", "the", "actor", "'s", "previous", "tools", "(", "such", "as", "PS1", "scripts", ")", ",", "downloads", "additional", "payloads", "based", "on", "the", "parsed", "server", "response", "."], ["The", "server", "sends", "a", "flag", "indicating", "how", "to", "treat", "the", "received", "data", ":"], ["1", ")", "EXE", "is", "written", "to", "disk", "and", "executed", ";"], ["2", ")", "VBS", "is", "written", "to", "disk", "and", "executed", "using", "wscript.exe", ";"], ["and", "any", "other", "value", "is", "treated", "as", "a", "blob", "of", "data", ",", "which", "is", "written", "to", "a", "file", "on", "disk", "in", "the", "%", "TEMP", "%", "folder", "."], ["In", "order", "to", "establish", "persistence", ",", "the", "binary", "creates", "a", "registry", "key", "named", "``", "Windows", "Task", "''", "under", "HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", "."], ["Furthermore", ",", "it", "creates", "a", "mutex", "with", "the", "name", "Global\\flashupdate_r", "."]], "ner": [[[4, 5, "MF"]], [[19, 19, "MF"], [22, 22, "MF"], [27, 28, "MF"], [31, 32, "MF"]], [[42, 43, "MF"]], [[49, 50, "MP"], [54, 54, "MP"], [62, 63, "MF"], [68, 69, "MP"]], [[72, 73, "SO"], [80, 80, "MP"]], [[88, 88, "SO"]], [[107, 110, "MP"], [119, 120, "MP"]], [[123, 123, "MP"], [128, 129, "SF"], [135, 136, "SO"]], [[140, 140, "MP"], [143, 143, "SO"], [147, 148, "MF"], [150, 151, "MF"], [154, 154, "MF"], [156, 156, "MF"]], [[168, 168, "MF"], [170, 170, "MF"], [180, 181, "MP"]], [[184, 186, "MP"], [194, 195, "MF"], [198, 204, "SO"], [207, 207, "MF"], [210, 210, "MF"]], [[214, 215, "MP"], [220, 222, "SF"], [225, 227, "TP"]], [[231, 231, "MP"], [234, 238, "SF"]], [[262, 267, "TF"]], [[275, 278, "TF"], [284, 285, "TF"]], [[299, 299, "MP"], [303, 305, "SF"], [308, 309, "SO"]], [[319, 319, "MF"], [324, 326, "SO"], [333, 334, "MP"], [343, 344, "TF"], [353, 354, "SO"]], [[367, 367, "MF"], [372, 373, "MF"], [377, 378, "MP"], [382, 384, "SF"], [388, 388, "MP"]], [[393, 393, "MP"], [397, 398, "MP"], [402, 404, "SF"], [408, 409, "MF"], [413, 414, "SF"]], [[419, 422, "MP"], [430, 431, "SO"], [438, 439, "SO"], [443, 443, "MF"]], [[447, 447, "MF"], [452, 453, "MP"], [456, 456, "MF"]], [[464, 464, "MP"], [468, 473, "TF"], [478, 478, "TP"], [488, 488, "MP"], [502, 502, "MF"]], [[511, 511, "MP"], [514, 516, "TF"], [520, 520, "TF"], [523, 524, "SF"]], [[527, 528, "MP"], [532, 532, "SF"], [535, 538, "MP"], [544, 544, "TF"], [552, 552, "TF"], [556, 557, "SO"]], [[568, 568, "MF"], [573, 574, "SO"], [577, 578, "SF"], [580, 582, "SF"]], [[585, 586, "MP"], [591, 591, "MF"], [594, 594, "MF"], [597, 597, "MF"]], [[604, 604, "SO"], [617, 617, "MF"], [623, 625, "MF"]], [[628, 630, "SF"], [632, 633, "SF"], [638, 638, "MF"], [642, 643, "MP"]], [[649, 650, "MF"]], [[704, 705, "MF"], [710, 711, "MP"]], [[714, 715, "MP"], [719, 719, "MP"], [722, 723, "MP"], [728, 728, "SF"]], [[738, 738, "SF"]], [[771, 771, "MP"], [776, 776, "SF"], [782, 782, "TF"]], [[798, 798, "SF"]], [[825, 825, "MP"], [829, 830, "SF"], [833, 833, "SF"]], [[841, 841, "SF"], [845, 845, "MP"]], [[863, 863, "SF"], [866, 866, "MP"]], [[890, 890, "MP"]], [[911, 911, "SF"], [915, 915, "MP"]], [[953, 953, "MP"], [958, 959, "SF"], [963, 964, "SF"]], [[969, 969, "MP"], [979, 979, "SF"], [986, 992, "TF"]], [[997, 997, "MP"], [999, 999, "SF"], [1023, 1024, "SF"]], [[1032, 1032, "SF"], [1055, 1055, "SF"]], [[1074, 1074, "SF"], [1082, 1082, "SO"]], [[1085, 1085, "MP"], [1096, 1097, "MP"], [1102, 1102, "MF"]], [[1111, 1111, "MP"], [1114, 1114, "MF"], [1121, 1121, "SF"]], [[1125, 1125, "MF"]], [[1135, 1135, "MF"], [1143, 1143, "MP"]], [[1153, 1155, "MF"], [1162, 1162, "SF"]], [[1179, 1179, "MP"], [1182, 1183, "MF"], [1186, 1187, "MF"], [1190, 1190, "SF"]], [[1194, 1194, "MP"], [1197, 1197, "MF"], [1201, 1201, "MF"]]], "relations": [[[4, 5, 19, 19, "CO"], [4, 5, 22, 22, "CO"]], [[27, 28, 31, 32, "CO"], [27, 28, 42, 43, "CO"]], [], [[49, 50, 42, 43, "EX"], [49, 50, 54, 54, "FR"], [54, 54, 62, 63, "WR"], [54, 54, 68, 69, "FR"], [68, 69, 72, 73, "ST"], [68, 69, 72, 73, "RF"], [68, 69, 119, 120, "CO"]], [[80, 80, 72, 73, "ST"], [80, 80, 72, 73, "RF"], [80, 80, 72, 73, "ST"], [80, 80, 72, 73, "RF"], [80, 80, 88, 88, "ST"], [80, 80, 88, 88, "RF"], [80, 80, 88, 88, "ST"], [80, 80, 88, 88, "RF"]], [], [[119, 120, 107, 110, "FR"], [107, 110, 88, 88, "ST"], [107, 110, 88, 88, "RF"], [107, 110, 123, 123, "CO"], [107, 110, 140, 140, "CO"]], [[123, 123, 128, 129, "RD"], [123, 123, 135, 136, "ST"], [123, 123, 135, 136, "RF"]], [[140, 140, 143, 143, "ST"], [140, 140, 143, 143, "RF"], [140, 140, 147, 148, "WR"], [140, 140, 150, 151, "WR"], [140, 140, 168, 168, "EX"], [140, 140, 170, 170, "EX"], [140, 140, 180, 181, "FR"], [150, 151, 154, 154, "CO"], [150, 151, 156, 156, "CO"]], [[180, 181, 303, 305, "RD"], [180, 181, 184, 186, "CO"], [180, 181, 214, 215, "CO"], [180, 181, 231, 231, "CO"], [180, 181, 299, 299, "CO"]], [[184, 186, 194, 195, "WR"], [184, 186, 198, 204, "ST"], [184, 186, 198, 204, "RF"], [184, 186, 210, 210, "EX"], [207, 207, 210, 210, "CO"], [207, 207, 194, 195, "CO"]], [[214, 215, 225, 227, "FR"], [225, 227, 220, 222, "RD"]], [[231, 231, 234, 238, "RD"], [231, 231, 262, 267, "WR"], [231, 231, 275, 278, "RD"], [231, 231, 275, 278, "UK"], [231, 231, 284, 285, "WR"]], [[262, 267, 275, 278, "CO"]], [], [[299, 299, 303, 305, "WR"], [299, 299, 308, 309, "ST"], [299, 299, 308, 309, "RF"]], [[333, 334, 319, 319, "EX"], [333, 334, 324, 326, "ST"], [333, 334, 324, 326, "RF"], [333, 334, 343, 344, "WR"], [333, 334, 353, 354, "ST"], [333, 334, 353, 354, "RF"]], [[377, 378, 372, 373, "RD"], [377, 378, 382, 384, "RD"], [377, 378, 388, 388, "FR"], [367, 367, 372, 373, "CO"]], [[397, 398, 393, 393, "FR"], [397, 398, 402, 404, "WR"], [397, 398, 408, 409, "EX"], [397, 398, 413, 414, "RD"], [397, 398, 402, 404, "RD"], [397, 398, 419, 422, "CO"], [397, 398, 452, 453, "CO"], [397, 398, 464, 464, "CO"]], [[419, 422, 430, 431, "ST"], [419, 422, 430, 431, "RF"], [419, 422, 438, 439, "ST"], [419, 422, 438, 439, "RF"], [419, 422, 443, 443, "WR"], [443, 443, 447, 447, "CO"]], [[452, 453, 447, 447, "RD"], [452, 453, 456, 456, "WR"]], [[478, 478, 464, 464, "FR"], [464, 464, 468, 473, "WR"], [464, 464, 488, 488, "FR"], [488, 488, 502, 502, "WR"]], [[511, 511, 523, 524, "RD"], [511, 511, 514, 516, "RD"], [511, 511, 523, 524, "WR"], [514, 516, 520, 520, "CO"], [523, 524, 532, 532, "CO"]], [[527, 528, 520, 520, "EX"], [527, 528, 535, 538, "FR"], [535, 538, 544, 544, "RD"], [535, 538, 552, 552, "RD"], [535, 538, 556, 557, "ST"], [535, 538, 556, 557, "RF"], [535, 538, 568, 568, "WR"], [535, 538, 573, 574, "ST"], [535, 538, 573, 574, "RF"], [535, 538, 577, 578, "RD"], [535, 538, 580, 582, "RD"]], [], [[585, 586, 568, 568, "WR"], [585, 586, 591, 591, "WR"], [585, 586, 597, 597, "WR"], [585, 586, 604, 604, "ST"], [585, 586, 604, 604, "RF"], [585, 586, 628, 630, "RD"], [585, 586, 628, 630, "RD"], [585, 586, 628, 630, "WR"], [585, 586, 632, 633, "RD"], [585, 586, 632, 633, "RD"], [585, 586, 632, 633, "WR"], [591, 591, 594, 594, "CO"]], [[617, 617, 623, 625, "CO"], [617, 617, 638, 638, "CO"]], [[642, 643, 597, 597, "WR"], [642, 643, 604, 604, "ST"], [642, 643, 604, 604, "RF"], [642, 643, 628, 630, "RD"], [642, 643, 628, 630, "RD"], [642, 643, 628, 630, "WR"], [642, 643, 632, 633, "RD"], [642, 643, 632, 633, "RD"], [642, 643, 632, 633, "WR"], [642, 643, 638, 638, "WR"], [642, 643, 649, 650, "WR"]], [], [[710, 711, 649, 650, "WR"], [710, 711, 704, 705, "EX"]], [[719, 719, 714, 715, "FR"], [714, 715, 722, 723, "FR"], [722, 723, 728, 728, "RD"], [728, 728, 738, 738, "CO"], [728, 728, 776, 776, "CO"], [728, 728, 798, 798, "CO"], [728, 728, 833, 833, "CO"], [728, 728, 841, 841, "CO"], [728, 728, 863, 863, "CO"], [728, 728, 911, 911, "CO"]], [], [[771, 771, 776, 776, "RD"], [771, 771, 776, 776, "WR"], [771, 771, 782, 782, "WR"], [771, 771, 825, 825, "CO"], [771, 771, 845, 845, "CO"], [771, 771, 953, 953, "CO"]], [], [[825, 825, 829, 830, "RD"]], [[845, 845, 866, 866, "FR"]], [[866, 866, 890, 890, "CO"], [866, 866, 915, 915, "CO"], [866, 866, 969, 969, "CO"]], [], [], [[953, 953, 958, 959, "RD"], [953, 953, 958, 959, "RD"], [953, 953, 958, 959, "WR"], [953, 953, 963, 964, "RD"], [963, 964, 979, 979, "CO"]], [[969, 969, 986, 992, "WR"], [986, 992, 958, 959, "RD"], [986, 992, 958, 959, "WR"]], [[997, 997, 999, 999, "RD"], [997, 997, 1023, 1024, "RD"], [997, 997, 1074, 1074, "RD"], [997, 997, 1082, 1082, "ST"], [997, 997, 1082, 1082, "RF"]], [[1032, 1032, 1055, 1055, "CO"]], [[1074, 1074, 1121, 1121, "CO"]], [[1085, 1085, 1102, 1102, "WR"], [1085, 1085, 1096, 1097, "CO"], [1085, 1085, 1179, 1179, "CO"]], [[1111, 1111, 1114, 1114, "WR"], [1111, 1111, 1125, 1125, "WR"], [1111, 1111, 1153, 1155, "WR"], [1111, 1111, 1162, 1162, "RD"], [1111, 1111, 1162, 1162, "RD"], [1111, 1111, 1162, 1162, "WR"], [1111, 1111, 1190, 1190, "RD"], [1111, 1111, 1190, 1190, "RD"], [1111, 1111, 1190, 1190, "WR"]], [], [[1143, 1143, 1135, 1135, "WR"], [1143, 1143, 1135, 1135, "EX"]], [], [[1179, 1179, 1182, 1183, "WR"], [1182, 1183, 1162, 1162, "RD"], [1182, 1183, 1162, 1162, "WR"], [1182, 1183, 1186, 1187, "CO"]], [[1194, 1194, 1179, 1179, "FR"], [1194, 1194, 1125, 1125, "WR"], [1194, 1194, 1153, 1155, "WR"], [1194, 1194, 1190, 1190, "RD"], [1194, 1194, 1190, 1190, "RD"], [1194, 1194, 1190, 1190, "WR"], [1194, 1194, 1197, 1197, "WR"], [1197, 1197, 1201, 1201, "CO"]]]}