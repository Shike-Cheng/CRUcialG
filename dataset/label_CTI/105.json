{"doc_key": "105", "sentences": [["The", "malware", "states", "that", "data", "files", ",", "such", "as", "photos", ",", "videos", "and", "documents", "on", "the", "victim", "'", "s", "computer", "have", "been", "encrypted", "with", "the", "RSA-2048", "asymmetric", "algorithm", "."], ["TeslaCrypt", "is", "interesting", "because", "it", "also", "targets", "and", "encrypts", "computer", "games", "files", ",", "such", "as", "saved", "games", "and", "Steam", "activation", "keys", "."], ["Their", "SHA256", "are:3372c1edab46837f1e973164fa2d726c5c5e17bcb888828ccd7c4dfcc234a3706c6f88ebd42e3ef5ca6c77622176183414d318845f709591bc4117704f1c95f4", "Both", "samples", "implement", "the", "following", "hashing", "algorithms", ":", "SHA1SHA256RIPEMD160BASE58BASE64Infection", "Vector", "And", "Setup", "FunctionThis", "ransomware", "is", "usually", "distributed", "as", "an", "email", "attachment", "or", "through", "websites", "that", "redirect", "the", "victim", "to", "the", "Angler", "Exploit", "Kit", "."], ["In", "our", "analysis", ",", "the", "exploit", "kit", "delivered", "a", "malicious", "Flash", "object", "containing", "an", "exploit", "against", "CVE-2015-0311", "."], ["The", "final", "unpacked", "executable", "locates", "specific", "Windows", "directories", "such", "as", "the", "Application", "Data", "directory", ",", "and", "builds", "support", "files", "like", "the", "``", "key.dat", "''", "file", ",", "and", "files", "to", "store", "decryption", "instructions", "."], ["The", "executable", "also", "adjusts", "its", "own", "privileges", "(", "adds", "``", "SeDebugPrivilege", "''", ")", "and", "copies", "itself", "using", "a", "random", "file", "name", "to", "the", "user", "'", "s", "Application", "Data", "directory", "."], ["A", "new", "process", "is", "then", "spawned", "and", "execution", "is", "transferred", "to", "it", "."], ["The", "original", "dropper", "file", "is", "deleted", "."], ["The", "main", "malware", "window", "is", "created", "and", "five", "threads", "are", "spawned", ",", "followed", "by", "the", "window", "message", "dispatching", "cycle", "."], ["TeslaCrypt", "threads", "perform", "the", "following", ":", "Delete", "all", "system", "Volume", "Shadow", "Copies", "by", "executing", "``", "vssadmin.exe", "delete", "shadows", "/all", "/quiet", "''", "commandOpen", "the", "``", "key.dat", "''", "file", "and", "recover", "encryption", "keys", "."], ["If", "``", "key.dat", "''", "file", "doesn", "'", "t", "exist", ",", "create", "the", "keys", "and", "store", "them", "in", "an", "encrypted", "form", "in", "the", "``", "key.dat", "''", "file", "."], ["Send", "the", "new", "master", "encryption", "key", "to", "the", "C", "&", "C", "server", "through", "POST", "request", "(", "the", "latest", "sample", "that", "we", "have", "analysed", "contains", "the", "following", "C", "&", "C", "server", "URLs:7tno4hib47vlep5o", "."], ["79fhdm16.com7tno4hib47vlep5o.tor2web.blutmagie.de7tno4hib47vlep5o.tor2web.fiImplement", "anti-tampering", "protection", ":", "every", "200", "milliseconds", ",", "TeslaCrypt", "enumerates", "all", "running", "processes", "and", "if", "a", "process", "with", "a", "filename", "that", "contains", "any", "of", "the", "words", "below", "is", "found", ",", "that", "process", "is", "terminated", "using", "the", "TerminateProcess", "Windows", "API", "functiontaskmgrprocexpregeditmsconfigcmd.exeFile", "Encryption", "-", "IntroductionAfter", "the", "initialization", "routine", "and", "the", "deletion", "of", "the", "Volume", "Shadow", "copies", ",", "the", "sample", "creates", "the", "``", "key.dat", "''"], ["The", "dropper", "from", "March", "2015", "calculates", "at", "least", "2", "different", "main", "keys", ":", "a", "payment", "key", "and", "a", "master", "encryption", "key", "."], ["The", "other", "dropper", "implements", "the", "concept", "of", "an", "additional", "key", "known", "as", "the", "``", "Recovery", "key", "'", "."], ["``", "GetAndHashOsData", "''", "is", "the", "function", "responsible", "for", "creating", "the", "base", "buffer", "for", "the", "generation", "of", "all", "keys", "."], ["At", "startup", "it", "acquires", "the", "following", "info", ":", "the", "global", "workstation", "'", "s", "LAN", "network", "statistics", ",", "using", "the", "NetStatisticsGet", "API", "function64", "random", "bytes", "generated", "by", "Windows", "Crypto", "functionsall", "heap", "descriptors", "of", "its", "own", "processall", "active", "process", "descriptors", "and", "the", "threads", "descriptors", "of", "each", "processall", "loaded", "modules", "in", "each", "processthe", "workstation", "'", "s", "physical", "memory", "informationOnce", "the", "data", "is", "acquired", ",", "it", "generates", "a", "big", "array", "of", "SHA1", "values", ",", "one", "for", "every", "20", "bytes", "of", "acquired", "data", "."], ["At", "the", "end", "it", "calculates", "and", "stores", "a", "global", "SHA1", "value", "for", "the", "entire", "array", ",", "in", "a", "symbol", "that", "we", "have", "called", "``", "g_lpGlobalOsDataSha1", "''", "."], ["With", "these", "2", "items", ",", "the", "``", "FillBuffWithEncryptedOsData", "''", "routine", "is", "able", "to", "fill", "a", "generic", "buffer", "with", "the", "calculated", "data", ",", "in", "a", "pseudo-random", "manner", "."], ["A", "master", "key", "and", "a", "payment", "key", "are", "generated", "using", "this", "function", "(", "each", "key", "is", "32", "bytes", "wide", ")", ",", "their", "SHA256", "is", "calculated", "and", "finally", "a", "custom", "algorithm", "is", "used", "to", "shift", "left", "and", "shift", "right", "the", "2", "keys", "."], ["The", "two", "shifted", "SHA256", "values", "are", "stored", "in", "the", "``", "key.dat", "''", "file", "."], ["The", "Key", "FileThe", "``", "OpenKeyFileAndWrite", "''", "routine", "tries", "to", "open", "the", "``", "key.dat", "''", "file", ",", "located", "in", "the", "user", "'", "s", "Application", "Data", "directory", "."], ["If", "it", "doesn", "'", "t", "exist", ",", "it", "generates", "the", "2", "master", "keys", "(", "3", "in", "case", "of", "the", "most", "recent", "dropper", ")", "as", "well", "as", "other", "keys", ",", "and", "stores", "them", "in", "the", "key", "file", "."], ["Here", "is", "a", "little", "schema", "of", "the", "layout", "of", "the", "``", "key.dat", "''", "file", ":", "*", "=", "We", "currently", "don", "'", "t", "know", "precisely", "how", "this", "value", "is", "used", "by", "TeslaCrypt", "The", "latest", "version", "of", "the", "dropper", "creates", "a", "``", "RECOVERY_KEY", "."], ["It", "does", "this", "to", "achieve", "a", "particular", "goal", ":", "if", "the", "victim", "workstation", "is", "offline", "or", "if", "a", "firewall", "blocks", "the", "communication", "with", "the", "C", "&", "C", "server", ",", "the", "dropper", "will", "proceed", "with", "the", "destruction", "of", "the", "master", "key", "inside", "the", "``", "key.dat", "''", "file", ",", "after", "the", "encryption", "of", "all", "files", "has", "been", "completed", "."], ["To", "recover", "the", "files", ",", "the", "user", "would", "have", "to", "connect", "to", "the", "threat", "actor", "'", "s", "TOR", "website", "and", "provide", "the", "recovery", "key", "."], ["The", "code", "for", "the", "encryption", "thread", "takes", "the", "shifted", "master", "key", ",", "calculates", "its", "SHA256", "hash", "and", "starts", "to", "enumerate", "all", "files", "of", "the", "victim", "workstation", "(", "filtering", "by", "extension", "type", ",", "Tesla", "Crypt", "supports", "over", "170", "different", "file", "extensions", ")", "."], ["It", ":", "generates", "a", "16-bytes", "Initialization", "Vector", "for", "AES", ",", "using", "the", "GetAndHashOsData", "API", "functionreads", "the", "target", "fileinitializes", "the", "AES", "encryption", "algorithm", "through", "the", "creation", "of", "the", "AES", "context", "data", "structurefinally", "encrypts", "the", "contents", "of", "the", "file", "using", "an", "AES", "CBC", "256-bit", "algorithm", "implemented", "in", "the", "``", "EncryptWithCbcAes", "''", "function", "."], ["When", "the", "process", "is", "complete", ",", "the", "new", "encrypted", "file", "is", "created", "."], ["The", "new", "file", "contains", "a", "small", "header", "(", "composed", "of", "the", "AES", "Initialization", "Vector", "in", "its", "first", "16", "bytes", "followed", "by", "the", "original", "file", "size", "in", "the", "next", "4", "bytes", ")", ",", "and", "then", "the", "actual", "encrypted", "bytes", "."], ["It", "needs", "the", "``", "key.dat", "''", "file", "to", "properly", "recover", "the", "master", "key", "used", "for", "file", "encryption", "."], ["Before", "it", "begins", "execution", ",", "it", "searches", "for", "``", "key.dat", "''", "in", "its", "original", "location", "(", "the", "user", "'", "s", "Application", "Data", "directory", ")", ",", "or", "in", "the", "current", "directory", "."], ["If", "it", "isn", "'", "t", "able", "to", "find", "and", "correctly", "parse", "the", "``", "key.dat", "''", "file", ",", "it", "will", "return", "an", "error", "and", "exit", "."], ["To", "use", "this", "tool", ",", "just", "copy", "the", "``", "key.dat", "''", "file", "into", "the", "tool", "'", "s", "directory", "and", "then", "specify", "either", "the", "encrypted", "file", "or", "a", "directory", "containing", "encrypted", "files", "."], ["Here", "is", "the", "list", "of", "command", "line", "options", ":", "/help", "-", "Show", "the", "help", "message/key", "-", "Manually", "specify", "the", "master", "key", "for", "the", "decryption", "(", "32", "bytes/64", "digits", ")", "/keyfile", "-", "Specify", "the", "path", "of", "the", "``", "key.dat", "''", "file", "used", "to", "recover", "the", "master", "key", "."], ["/file", "-", "Decrypt", "an", "encrypted", "file/dir", "-", "Decrypt", "all", "the", "``", ".ecc", "''", "files", "in", "the", "target", "directory", "and", "its", "subdirs/scanEntirePc", "-", "Decrypt", "``", ".ecc", "''", "files", "on", "the", "entire", "computer/KeepOriginal", "-", "Keep", "the", "original", "file", "(", "s", ")", "in", "the", "encryption", "process/deleteTeslaCrypt", "-", "Automatically", "kill", "and", "delete", "the", "TeslaCrypt", "dropper", "(", "if", "found", "active", "in", "the", "target", "system", ")", "Back", "up", "your", "encrypted", "files", "before", "you", "use", "this", "utility", "."], ["The", "user", "assumes", "all", "liability", "for", "the", "use", "of", "the", "tool", "."], ["79fhdm16.com7tno4hib47vlep5o.tor2web.blutmagie.de7tno4hib47vlep5o.tor2web.fiThreatGrid", "has", "also", "added", "a", "behavioral", "indicator", "to", "identify", "TeslaCrypt", "."]], "ner": [[[1, 1, "MP"], [16, 19, "TP"]], [[29, 29, "MP"]], [[67, 67, "MP"], [73, 73, "MF"], [77, 77, "SO"], [81, 81, "TP"], [84, 86, "MF"]], [[93, 94, "MF"], [97, 98, "MF"], [104, 104, "MF"]], [[109, 109, "MP"], [123, 124, "TF"], [128, 128, "TF"], [136, 137, "TF"]], [[140, 140, "MP"], [149, 149, "MF"], [154, 154, "MF"], [165, 167, "SF"]], [[170, 171, "MP"]], [[183, 184, "MF"]], [[191, 192, "MP"], [196, 197, "MP"], [204, 205, "MF"]], [[209, 210, "MP"], [217, 219, "SF"], [224, 228, "MF"], [233, 233, "TF"], [238, 239, "TF"]], [[243, 243, "TF"], [264, 264, "TF"]], [[272, 273, "TF"], [276, 278, "SO"], [281, 282, "TP"], [294, 296, "SO"]], [[308, 308, "MP"], [331, 331, "TP"], [336, 338, "TP"], [351, 352, "SF"], [356, 356, "MP"], [360, 360, "TF"]], [[363, 363, "MP"], [376, 377, "TF"], [381, 382, "TF"]], [[385, 386, "MP"], [398, 399, "TF"]], [[403, 403, "MF"]], [[423, 423, "MP"], [434, 436, "SF"], [447, 448, "SF"], [457, 458, "SF"], [466, 467, "SF"], [474, 475, "SF"], [482, 482, "MP"], [488, 489, "TF"]], [[503, 503, "MP"], [508, 510, "TF"], [524, 524, "SF"]], [[534, 534, "MP"], [542, 543, "SF"], [547, 547, "TF"]], [[555, 556, "TF"], [559, 560, "TF"], [576, 576, "TF"], [582, 583, "MF"]], [[598, 600, "TF"], [606, 606, "TF"]], [[614, 614, "MP"], [622, 622, "TF"]], [], [[684, 684, "TF"], [703, 703, "MP"], [709, 709, "MP"], [713, 713, "TF"]], [[726, 726, "TP"], [733, 733, "TP"], [736, 736, "MP"], [739, 742, "SO"], [745, 745, "MP"], [758, 758, "TF"]], [[773, 775, "TP"], [778, 778, "TP"], [789, 790, "SO"], [794, 795, "TF"]], [[801, 802, "MP"], [805, 807, "TF"], [811, 812, "TF"], [818, 821, "SF"]], [[839, 839, "MP"], [844, 845, "TF"], [851, 852, "MF"], [855, 856, "TF"], [866, 868, "TF"], [878, 880, "TF"], [886, 886, "MF"]], [[892, 892, "MP"], [897, 899, "TF"]], [], [[942, 942, "MP"], [946, 946, "TF"], [953, 954, "TF"]], [[961, 961, "MP"], [969, 969, "TF"]], [[992, 992, "MP"]], [[1019, 1019, "MP"], [1025, 1025, "TF"], [1030, 1033, "MF"]], [], [], [], []], "relations": [[[1, 1, 16, 19, "FR"], [16, 19, 29, 29, "FR"]], [[29, 29, 77, 77, "ST"], [29, 29, 77, 77, "RF"]], [[81, 81, 67, 67, "FR"], [81, 81, 73, 73, "RD"], [81, 81, 77, 77, "ST"], [81, 81, 77, 77, "RF"], [67, 67, 84, 86, "EX"], [81, 81, 84, 86, "WR"], [67, 67, 109, 109, "FR"], [84, 86, 104, 104, "CO"], [84, 86, 93, 94, "CO"], [84, 86, 97, 98, "CO"], [81, 81, 726, 726, "CO"]], [], [[109, 109, 123, 124, "WR"], [123, 124, 136, 137, "CO"], [123, 124, 128, 128, "CO"]], [[140, 140, 149, 149, "WR"], [140, 140, 154, 154, "WR"], [140, 140, 165, 167, "CD"], [140, 140, 170, 171, "FR"]], [[170, 171, 154, 154, "EX"], [170, 171, 183, 184, "UK"], [170, 171, 191, 192, "FR"], [170, 171, 196, 197, "FR"]], [], [[191, 192, 204, 205, "WR"], [196, 197, 209, 210, "CO"]], [[209, 210, 217, 219, "UK"], [209, 210, 224, 228, "EX"], [209, 210, 233, 233, "RD"], [209, 210, 233, 233, "WR"], [209, 210, 238, 239, "WR"], [209, 210, 281, 282, "FR"]], [[243, 243, 264, 264, "CO"], [243, 243, 233, 233, "CO"], [243, 243, 360, 360, "CO"]], [[281, 282, 272, 273, "RD"], [281, 282, 276, 278, "ST"], [281, 282, 276, 278, "RF"], [281, 282, 294, 296, "ST"], [281, 282, 294, 296, "RF"]], [[308, 308, 294, 296, "ST"], [308, 308, 294, 296, "RF"], [308, 308, 336, 338, "FR"], [336, 338, 331, 331, "UK"], [336, 338, 351, 352, "RD"], [336, 338, 351, 352, "RD"], [336, 338, 351, 352, "WR"], [356, 356, 351, 352, "RD"], [356, 356, 351, 352, "RD"], [356, 356, 351, 352, "WR"], [356, 356, 351, 352, "RD"], [356, 356, 351, 352, "RD"], [356, 356, 351, 352, "WR"]], [[363, 363, 376, 377, "WR"], [363, 363, 381, 382, "WR"]], [[385, 386, 398, 399, "WR"], [385, 386, 423, 423, "FR"]], [], [[423, 423, 403, 403, "EX"], [423, 423, 434, 436, "RD"], [423, 423, 447, 448, "RD"], [423, 423, 457, 458, "RD"], [423, 423, 466, 467, "RD"], [423, 423, 474, 475, "RD"], [482, 482, 488, 489, "WR"], [423, 423, 482, 482, "CO"], [423, 423, 503, 503, "CO"]], [[503, 503, 508, 510, "WR"], [503, 503, 524, 524, "RD"], [503, 503, 534, 534, "FR"]], [[534, 534, 542, 543, "RD"], [534, 534, 542, 543, "WR"], [534, 534, 542, 543, "RD"], [534, 534, 547, 547, "WR"], [534, 534, 555, 556, "WR"], [534, 534, 559, 560, "WR"], [534, 534, 576, 576, "WR"], [534, 534, 582, 583, "EX"], [534, 534, 598, 600, "WR"], [534, 534, 606, 606, "WR"]], [], [[606, 606, 622, 622, "CO"]], [[614, 614, 622, 622, "RD"]], [], [[703, 703, 606, 606, "RD"], [709, 709, 713, 713, "WR"], [684, 684, 606, 606, "CO"]], [[726, 726, 736, 736, "UK"], [745, 745, 758, 758, "UK"], [726, 726, 778, 778, "CO"]], [[778, 778, 773, 775, "FR"], [778, 778, 789, 790, "ST"], [778, 778, 794, 795, "WR"]], [[801, 802, 805, 807, "RD"], [801, 802, 811, 812, "WR"], [801, 802, 818, 821, "RD"], [801, 802, 839, 839, "CO"], [801, 802, 892, 892, "CO"]], [[839, 839, 844, 845, "WR"], [839, 839, 851, 852, "EX"], [839, 839, 855, 856, "RD"], [839, 839, 866, 868, "WR"], [839, 839, 878, 880, "WR"], [839, 839, 886, 886, "EX"]], [[892, 892, 897, 899, "WR"]], [], [[942, 942, 946, 946, "RD"], [942, 942, 953, 954, "WR"], [942, 942, 961, 961, "CO"], [942, 942, 992, 992, "CO"], [942, 942, 1019, 1019, "CO"]], [[969, 969, 1025, 1025, "CO"], [969, 969, 946, 946, "CO"]], [], [[1019, 1019, 1025, 1025, "WR"], [1019, 1019, 1030, 1033, "RD"]], [], [], [], []]}