{"doc_key": "062", "sentences": [["Talos", "researchers", "found", "this", "C2", "on", "a", "server", "that", "had", "a", "file", "listing", "active", "on", "the", "root", "directory", "along", "with", "a", "set", "of", "post-exploitation", "tools", "."], ["Insekt", "RAT", ",", "a", "new", "trojan", "Cisco", "Talos", "discovered", ",", "is", "Alchimist", "'s", "beacon", "implant", "written", "in", "GoLang", "and", "has", "a", "variety", "of", "remote", "access", "capabilities", "that", "can", "be", "instrumented", "by", "the", "Alchimist", "C2", "server.Alchimist", "C2", "has", "a", "web", "interface", "written", "in", "Simplified", "Chinese", "and", "can", "generate", "a", "configured", "payload", ",", "establish", "remote", "sessions", ",", "deploy", "payload", "to", "the", "remote", "machines", ",", "capture", "screenshots", ",", "perform", "remote", "shellcode", "execution", "and", "run", "arbitrary", "commands.Among", "the", "remaining", "tools", ",", "Cisco", "Talos", "found", "a", "Mach-O", "dropper", "em"], ["Manjusaka", "developers", "take", "advantage", "of", "the", "Gin", "web", "framework", "and", "use", "packr", ",", "an", "asset", "bundling", "framework", ",", "to", "embed", "and", "store", "the", "implants", "."], ["We", "'ve", "observed", "that", "Alchimist", ",", "apart", "from", "the", "regular", "HTTP/S", "also", "supports", "protocols", "like", "SNI", ",", "WSS/WS", ",", "Manjusaka", "on", "the", "other", "hand", ",", "mentions", "SNI", ",", "WSS/WS", "on", "its", "documentation", "but", "only", "supports", "HTTP", "."], ["Unwrapping", "AlchimistAssetsAlchimist", "uses", "GoLang-based", "assets", "(", "custom-made", "embedded", "packages", ")", "to", "store", "all", "the", "resources", "required", "for", "it", "to", "function", "as", "a", "C2", "server", "."], ["During", "the", "initialization", "of", "the", "C2", "service", ",", "the", "process", "extracts", "all", "the", "embedded", "assets", "from", "the", "GoLang-based", "ELF", "binary", "of", "the", "C2", "and", "drops", "them", "into", "hardcoded", "locations", "under", "the", "/tmp/Res/", "directory", "."], ["C2", "ELF", "contains", "hardcoded", "destination", "directories", "for", "dropping", "the", "embedded", "assets.All", "embedded", "assets", "are", "recursively", "placed", "in", "directories", "based", "on", "the", "way", "they", "are", "embedded", "in", "the", "GoLang", "asset", "package", "."], ["The", "``", "Res", "''", "directory", "contains", "web", "interface", "code", ",", "HTML", "files", "and", "other", "directories", "."], ["It", "also", "unpacks", "its", "``", "Insekt", "''", "implant", "binaries", ",", "for", "the", "Windows", "and", "Linux", "operating", "systems", "into", "the", "``", "/tmp/Res/Payload", "''", "directory", "."], ["In", "the", "/tmp", "directory", ",", "the", "C2", "also", "writes", "the", "self-signed", "certificate", "and", "the", "key", "used", "in", "HTTPS", "communications", "."], ["Even", "though", "it", "is", "self-signed", ",", "the", "certificate", "is", "not", "generated", "upon", "execution", "."], ["Rather", ",", "it", "is", "a", "hardcoded", "certificate", "added", "to", "the", "C2", "at", "the", "time", "of", "compilation", "."], ["The", "details", "of", "the", "certificate", "below", "also", "shows", "that", "the", "certificate", "does", "n't", "contain", "any", "server", "name", "."], ["An", "attacker", "could", "use", "these", "commands", "to", "build", "their", "infection", "mechanism", "for", "distributing", "Insekt", "RAT", "."], ["An", "attacker", "can", "embed", "these", "commands", "in", "a", "script", "(", "instrumented", "via", "a", "malicious", "entry", "point", "such", "as", "a", "maldoc", ",", "LNK", ",", "etc", ".", ")", "and", "deliver", "it", "to", "the", "victims", "by", "various", "means", "to", "gain", "an", "initial", "foothold", ",", "thereby", "downloading", "and", "implanting", "the", "Insekt", "RAT", "."], ["Delivery", "command", "snippets", "generated", "by", "Alchimist", "for", "Insekt", "payloads", "."], ["Payload", "generationAlchimist", "accepts", "several", "parameters", "from", "the", "Web", "UI", "for", "generating", "a", "payload", "."], ["This", "operator", "inputs", "the", "parameters", "into", "the", "``", "session.html", "''", "Web", "UI", "and", "consists", "of", "the", "following", "configuration", ":", "Protocol", "value", ":", "TLS", ",", "SNI", ",", "WSS/WS", "."], ["Remote", "C2", "host", "IP/URL", "."], ["Platform", "type", ":", "Windows", "or", "Linux", "to", "select", "the", "type", "of", "Insekt", "RAT", "payload", "."], ["Daemon", "flag", ":", "Indicates", "if", "the", "Insekt", "implant", "runs", "as", "a", "daemon", "on", "the", "infected", "endpoint", "."], ["The", "Web", "UI", "will", "take", "these", "configuration", "values", "to", "construct", "a", "JSON", "and", "send", "a", "POST", "request", "to", "the", "``", "/pay", "''", "URL", "of", "the", "current", "C2", "server", "to", "request", "a", "new", "payload", "that", "can", "be", "downloaded", "."], ["Web", "UI", "HTML", "code", "requesting", "the", "payload", "generation", "from", "the", "C2", "."], ["The", "request", "for", "generating", "the", "payload", "hits", "the", "``", "/pay", "''", "URL", ",", "where", "the", "C2", "accepts", "the", "configuration", "parameters", "from", "the", "JSON", ",", "parses", "them", "and", "then", "generates", "the", "customized", "Insekt", "payload", "."], ["The", "C2", "does", "n't", "compile", "the", "Insekt", "payloads", "(", "also", "GoLang", "based", ")", "at", "all", "."], ["It", "simply", "reads", "a", "dummy/skeleton", "Insekt", "binary", "(", "winx64", "or", "ELFx64", ")", "that", "was", "unpacked", "during", "its", "initialization", "from", "the", "``", "/tmp/Res/Payloads/", "''", "directory", "into", "memory", "and", "hot", "patches", "the", "Insket", "binary", "in", "memory", "based", "on", "specific", "placeholder", "flags", "for", "the", "various", "values", "and", "dumps", "the", "patched", "Insekt", "binary", "to", "disk", "again", "."], ["This", "new", "binary", "is", "then", "read", "from", "the", "disk", "by", "another", "helper", "routine", "in", "the", "C2", "process", "and", "served", "to", "the", "operator", "via", "the", "Web", "UI", "."], ["C2", "is", "looking", "to", "patch", "the", "C2", "server", "value", "$", "{", "RHOST", "}", "in", "the", "Insekt", "dummy", "binary", "."], ["The", "communication", "is", "managed", "by", "the", "``", "pm3", "''", "GoLang", "package", "which", "implements", "establishing", "and", "managing", "connections", "to", "the", "WebSockets", ",", "plugin", "codes", "to", "scan", "IP", "addresses", "using", "the", "ICMP", "protocol", ",", "utility", "code", "to", "perform", "port", "forwarding", ",", "upload", "files", "to", "the", "remote", "machine", "and", "perform", "remote", "execution", "."], ["The", "C2", "address", "is", "hard-coded", "on", "the", "implant", "at", "configuration", "time", ",", "which", "attempts", "to", "connect", "to", "the", "C2", "server", "10", "times", "with", "an", "interval", "of", "one", "second", "."], ["After", "ten", "unsuccessful", "attempts", ",", "the", "backdoor", "pauses", "and", "again", "attempts", "to", "connect", "to", "the", "C2", "server", "once", "every", "hour", "."], ["The", "implant", "supports", "connecting", "to", "the", "C2", "over", "either", "WSS/WS", ",", "TLS", "or", "SNI", "protocols", "."], ["Based", "on", "the", "C2", "URLs", "specified", ",", "the", "implant", "will", "use", "a", "specific", "protocol", "to", "initiate", "the", "check-in", "with", "the", "C2", "server", "."], ["Insekt", "implantInsekt", "is", "a", "64-bit", "implant", "written", "in", "GoLang", ",", "compiled", "for", "Windows", "and", "Linux", "environments", "with", "a", "variety", "of", "RAT", "capabilities", ",", "all", "directed", "to", "execute", "by", "the", "Alchimist", "C2", "server", "."], ["During", "initialization", ",", "the", "implant", "will", "set", "up", "multiple", "handlers", "for", "seven", "primary", "capabilities", ":", "Get", "file", "sizes", "."], ["Get", "OS", "information", "."], ["Run", "arbitrary", "commands", "via", "cmd.exe", "."], ["Upgrade", "the", "current", "Insekt", "implant", "."], ["Run", "arbitrary", "commands", "as", "a", "different", "user", "."], ["Sleep", "for", "periods", "of", "time", "defined", "by", "the", "C2", "."], ["Start/stop", "taking", "screenshots", "."], ["Insekt", "also", "checks", "the", "internet", "connectivity", "and", "port", "status", "by", "connecting", "to", "the", "addresses/ports", "below", "."], ["HostPortlocalhost22localhost80localhost23localhost445localhost139www.google.com443www.apple.com443github.com443Apart", "from", "these", "capabilities", ",", "the", "implant", "consists", "of", "other", "capabilities", "such", "as", "shellcode", "execution", ",", "port", "and", "IP", "scanning", ",", "SSH", "key", "manipulation", ",", "proxying", "connections", ",", "etc.described", "below", "."], ["The", "Linux", "variant", "of", "Insekt", "also", "has", "the", "functionality", "to", "list", "the", "contents", "of", "``", ".ssh", "''", "directory", "in", "the", "victim", "'s", "home", "directory", "and", "adds", "new", "SSH", "keys", "to", "the", "authorised_Keys", "file", "."], ["Using", "this", "feature", ",", "the", "attacker", "can", "communicate", "with", "the", "victim", "'s", "machine", "from", "the", "C2", "over", "SSH", "."], ["From", "the", "network", "point-of-view", ",", "Insekt", "can", "create", "``", "proxy", "''", "connections", "to", "other", "systems", "by", "its", "own", "mechanism", "or", "by", "simply", "using", "the", "socks5", "protocol", "."], ["In", "particular", ",", "it", "implements", "interactive", "shells", "based", "on", "PowerShell", ",", "bash", "and", "cmd.exe", "."], ["It", "also", "has", "the", "ability", "to", "accept", "command", "codes", "from", "the", "Alchimist", "C2", "to", "execute", "a", "predefined", "set", "of", "commands", "on", "the", "victim", "system", "."], ["These", "capabilities", "consist", "of", ":", "Change", "directory", "-", "cd", "."], ["Write", "files", "to", "disk.Execute", "arbitrary", "commands", "."], ["Scan", "specific", "ports", "for", "an", "IP", "."], ["Enumerate", "file", "in", "a", "directory", "path", "."], ["Download", "files", "from", "a", "remote", "location", "."], ["Unzip", "archive", "files", "to", "a", "location", "on", "disk", "."], ["MacOSX", "exploitationThe", "Mach-O", "file", "discovered", "in", "the", "open", "directory", "is", "a", "64-bit", "executable", "written", "in", "GoLang", "embedded", "with", "an", "exploit", "and", "a", "bind", "shell", "backdoor", "."], ["The", "dropper", "contains", "an", "exploit", "for", "a", "privilege", "escalation", "vulnerability", "(", "CVE-2021-4034", ")", "in", "polkit", "'s", "pkexec", "utility", "."], ["Along", "with", "the", "exploit", ",", "the", "dropper", "would", "bind", "a", "shell", "to", "a", "port", "providing", "the", "operators", "with", "a", "remote", "shell", "on", "the", "victim", "machine", "."], ["The", "same", "exploit", "was", "also", "found", "for", "Linux", "."], ["ScriptletAlchimist", "can", "generate", "scripts", "to", "be", "used", "in", "the", "first", "stage", "of", "infections", "."], ["The", "script", "launches", "a", "WScript.shell", "object", "to", "run", "a", "PowerShell", "command", "and", "download", "the", "Insekt", "implant", "from", "http", "[", ":", "//", "]", "45.32.132.166/msconfig.zip", "."], ["ShellcodeA", "meterpreter", "shellcode", "was", "found", "on", "a", "file", "with", "the", "name", "shell.msi", "."], ["It", "has", "the", "malicious", "configuration", "containing", "the", "host", "and", "the", "port", "details", "for", "the", "shell", "code", "to", "connect", "to", "18.167.90.252", ",", "providing", "Talos", "with", "one", "more", "piece", "of", "the", "operator", "'s", "infrastructure", "."], ["For", "the", "users", "of", "Unix-like", "systems", "other", "than", "Linux", ",", "who", "can", "not", "find", "patches", "for", "their", "operating", "systems", ",", "a", "workaround", "could", "be", "implemented", "by", "removing", "the", "SUID-bit", "of", "pkexec", "utility", "."]], "ner": [[[4, 4, "SO"], [23, 24, "MF"]], [[58, 59, "MF"], [107, 108, "MF"]], [[110, 111, "MF"]], [[139, 139, "MF"]], [[173, 173, "MF"]], [[206, 206, "MP"], [215, 216, "MF"], [228, 228, "MF"]], [[232, 232, "MF"]], [[269, 270, "MF"], [272, 273, "MF"], [275, 276, "MF"]], [[278, 278, "MP"], [283, 283, "MF"], [298, 298, "MF"]], [[308, 308, "MP"], [312, 313, "MF"], [316, 316, "MF"]], [[324, 324, "MP"], [329, 329, "MF"]], [], [], [], [], [], [[447, 447, "MP"], [453, 454, "MP"], [458, 458, "MF"]], [[468, 468, "MF"]], [], [], [], [[526, 527, "MP"], [531, 532, "SF"], [536, 536, "MF"], [547, 547, "SO"], [557, 557, "MF"]], [[563, 564, "MP"], [569, 569, "MF"], [573, 573, "SO"]], [], [], [], [], [], [], [[775, 776, "SO"], [781, 781, "MP"], [792, 793, "SO"]], [[818, 819, "SO"]], [[825, 825, "MP"]], [[843, 844, "SO"], [848, 848, "MP"], [860, 861, "SO"]], [[863, 864, "MP"]], [[900, 900, "MP"]], [], [], [], [], [], [], [], [], [[1004, 1004, "MP"], [1015, 1015, "SF"], [1031, 1032, "SF"]], [[1049, 1049, "SO"]], [[1058, 1058, "MP"], [1066, 1067, "SO"]], [[1083, 1083, "MP"], [1093, 1093, "MF"]], [], [], [], [], [], [], [], [[1169, 1169, "MF"], [1179, 1179, "MF"]], [[1194, 1194, "MP"], [1204, 1204, "MF"]], [], [], [[1247, 1247, "MP"], [1250, 1250, "MF"]], [[1262, 1262, "MP"], [1265, 1265, "MP"], [1270, 1270, "TP"], [1275, 1276, "MF"], [1278, 1283, "SO"]], [], [], []], "relations": [[], [[58, 59, 139, 139, "CO"], [58, 59, 173, 173, "CO"]], [], [], [], [[206, 206, 4, 4, "ST"], [206, 206, 4, 4, "RF"], [206, 206, 23, 24, "WR"], [206, 206, 107, 108, "WR"], [206, 206, 110, 111, "WR"], [206, 206, 173, 173, "WR"], [206, 206, 215, 216, "RD"], [206, 206, 228, 228, "WR"], [215, 216, 232, 232, "CO"], [228, 228, 275, 276, "CO"], [228, 228, 272, 273, "CO"], [228, 228, 269, 270, "CO"], [206, 206, 278, 278, "CO"], [206, 206, 308, 308, "CO"], [206, 206, 324, 324, "CO"]], [], [], [[278, 278, 283, 283, "WR"], [283, 283, 298, 298, "CO"]], [[308, 308, 312, 313, "WR"], [308, 308, 316, 316, "WR"], [312, 313, 329, 329, "CO"]], [], [], [], [], [], [], [[447, 447, 458, 458, "WR"], [453, 454, 458, 458, "WR"], [447, 447, 468, 468, "WR"], [453, 454, 316, 316, "RD"]], [], [], [], [], [[526, 527, 531, 532, "RD"], [526, 527, 536, 536, "WR"], [526, 527, 536, 536, "EX"], [526, 527, 547, 547, "ST"], [526, 527, 547, 547, "RF"], [526, 527, 557, 557, "WR"], [526, 527, 563, 564, "CO"], [557, 557, 569, 569, "CO"], [547, 547, 573, 573, "CO"]], [], [], [], [], [], [], [], [[781, 781, 775, 776, "ST"], [781, 781, 775, 776, "RF"], [781, 781, 818, 819, "ST"], [781, 781, 818, 819, "RF"], [775, 776, 792, 793, "CO"], [781, 781, 825, 825, "CO"], [781, 781, 848, 848, "CO"]], [], [], [[843, 844, 860, 861, "CO"]], [[863, 864, 900, 900, "CO"]], [], [], [], [], [], [], [], [], [], [[1004, 1004, 818, 819, "ST"], [1004, 1004, 818, 819, "RF"], [1004, 1004, 1015, 1015, "RD"], [1004, 1004, 1031, 1032, "RD"], [1004, 1004, 1031, 1032, "RD"], [1004, 1004, 1031, 1032, "WR"], [1004, 1004, 1049, 1049, "ST"], [1004, 1004, 1049, 1049, "RF"]], [], [[1058, 1058, 1066, 1067, "ST"], [1058, 1058, 1093, 1093, "WR"], [1058, 1058, 1083, 1083, "CO"]], [], [], [], [], [], [], [], [], [[1169, 1169, 1179, 1179, "CO"]], [[1194, 1194, 1093, 1093, "WR"], [1194, 1194, 1169, 1169, "WR"], [1194, 1194, 1204, 1204, "WR"], [1194, 1194, 1204, 1204, "WR"]], [], [], [[1247, 1247, 1204, 1204, "WR"], [1247, 1247, 1250, 1250, "WR"]], [[1262, 1262, 1250, 1250, "EX"], [1262, 1262, 1265, 1265, "FR"], [1265, 1265, 1179, 1179, "UK"], [1265, 1265, 1270, 1270, "FR"], [1270, 1270, 1275, 1276, "WR"], [1270, 1270, 1278, 1283, "ST"], [1270, 1270, 1278, 1283, "RF"]], [], [], []]}