{"doc_key": "084", "sentences": [["The", "trojanized", "setup", "will", "install", "the", "malware", "and", "the", "legitimate", "application", ",", "which", "is", "a", "good", "way", "to", "disguise", "its", "activities", "."], ["In", "some", "cases", ",", "it", "will", "reconfigure", "Windows", "Defender", "before", "dropping", "the", "malware", "to", "prevent", "detection", "."], ["The", "malware", "will", "exfiltrate", "any", "Microsoft", "Office", "file", "it", "encounters", "on", "the", "system", "."], ["When", "the", "targeted", "users", "tried", "to", "download", "a", "legitimate", "application", "on", "the", "official", "website", ",", "the", "ISP", "performs", "an", "HTTP", "redirect", "."], ["It", "is", "interesting", "to", "note", "that", "this", "threat", "actor", "uses", "HTTPS", "on", "the", "C2", "."], ["Main", "differences", "between", "StrongPity2", "and", "StrongPity3", "StrongPity3", "is", "the", "evolution", "of", "StrongPity2", ",", "with", "a", "few", "differences", "."], ["The", "latter", "does", "not", "use", "libcurl", "anymore", "and", "now", "uses", "winhttp", "to", "perform", "all", "requests", "to", "C2", "."], ["The", "usage", "of", "the", "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run", "registry", "key", "has", "a", "persistence", "mechanism", "that", "has", "been", "replaced", "by", "the", "creation", "of", "a", "service", "."], ["This", "service", "changes", "its", "name", "from", "package", "to", "package", "."], ["The", "service", "executable", "'s", "only", "job", "is", "to", "launch", "the", "C2", "contact", "module", "upon", "service", "startup", "."], ["The", "dropped", "files", "are", "now", "stored", "in", "a", "folder", "located", "in", "C", ":", "\\DOCUME~1\\", "<", "USER", ">", "~1\\LOCALS~1\\Temp\\", "always", "following", "the", "same", "pattern", "similar", "to", "the", "following", ":", "4CA-B25C11-A27BC", "."], ["The", "C2", "path", "pattern", "has", "also", "changed", ",", "we", "have", "identified", "the", "following", "paths", ":", "ini.php", ",", "info.php", "and", "parse_ini_file.php", ",", "which", "are", "no", "longer", "random", "nor", "animal", "named", "based", "."], ["The", "VPNpro", "trojanized", "application", "uses", "an", "AutoRun", "registry", "key", ",", "as", "mentioned", "in", "the", "publication", "released", "before", "July", "2019", "."], ["Anti-virus", "checks", "on", "Firefox", "trojanized", "installer", "Before", "writing", "the", "toolkit", "into", "the", "hard", "drive", ",", "the", "fake", "Firefox", "installer", "executes", "a", "PowerShell", "command", "that", "will", "add", "the", "directories", "used", "by", "the", "malware", "to", "the", "Windows", "Defender", "exclusions", "list", "and", "prevent", "sample", "submission", "at", "the", "same", "time", "."], ["After", "that", ",", "it", "will", "check", "if", "ESET", "or", "BitDefender", "antivirus", "are", "installed", "before", "dropping", "the", "malware", "."], ["The", "setup", "deploys", "three", "files", "which", "are", "part", "of", "the", "toolset", ":", "rmaserv.exe", ",", "winprint32.exe", "and", "mssqldbserv.xml", "."], ["Execution", "flow", "As", "the", "execution", "flow", "shows", ",", "the", "setup", "will", "only", "execute", "rmaserv.exe", "."], ["The", "remaining", "modules", "are", "executed", "by", "rmaserv.exe", "when", "this", "executable", "will", "be", "executed", "as", "a", "service", "."], ["The", "malicious", "service", ":", "rmaserv.exe", "This", "binary", "has", "two", "main", "features", "."], ["If", "it", "is", "executed", "with", "the", "``", "help", "''", "parameter", ",", "it", "will", "install", "a", "service", "to", "execute", "itself", "as", "a", "service", "."], ["This", "parameter", "is", "used", "by", "the", "trojanized", "installer", "."], ["Consequently", ",", "the", "execution", "wo", "n't", "do", "anything", "and", "the", "dynamic", "analysis", "will", "be", "skewed", "."], ["First", ",", "it", "will", "launch", "the", "winprint32.exe", "executable", "(", "C2", "contact", "module", ")", "and", "then", "it", "will", "wait", "for", "an", "event", "."], ["This", "event", "is", "the", "mechanism", "used", "by", "the", "C2", "contact", "module", "to", "alert", "the", "service", "executable", "to", "perform", "the", "cleaning", "of", "all", "components", "."], ["C2", "contact", "module", ":", "winprint32.exe", "Regularly", ",", "the", "service", "checks", "if", "a", "user", "is", "logged", ",", "by", "checking", "if", "Explorer", "is", "running", "."], ["Once", "explorer.exe", "is", "running", ",", "the", "service", "configures", "the", "environment", "and", "executes", "the", "C2", "contact", "module", ":", "winprint32.exe", "."], ["This", "module", "is", "responsible", "for", "launching", "the", "document", "search", "module", ",", "contact", "the", "C2", "and", "exfiltrate", "the", "collected", "documents", "."], ["It", "will", "create", "a", "mutex", "with", "the", "name", "``", "YeucqCcpgapiZISEdRSNiL", "''", "."], ["Afterward", ",", "it", "will", "launch", "two", "processes", ":", "C", ":", "\\DOCUME~1\\", "<", "USER", ">", "~1\\LOCALS~1\\Temp\\4CA-B25C11-A27BC\\mssqldbserv.xmlC", ":", "\\DOCUME~1\\", "<", "USER", ">", "~1\\LOCALS~1\\Temp\\4CA-B25C11-A27BC\\wintasks.xmlMutex", "creation", "Then", ",", "it", "will", "start", "an", "infinite", "loop", "."], ["The", "first", "step", "inside", "the", "loop", "is", "to", "contact", "the", "C2", "over", "HTTPS", "."], ["On", "the", "first", "contact", ",", "it", "will", "send", "an", "identification", "of", "the", "victim", "based", "on", "the", "hard", "disk", "volume", "serial", "number", "."], ["Contact", "C2", "loop", "After", "a", "6,050-", "milliseconds", "delay", ",", "it", "will", "search", "for", "``", "sft", "''", "files", "(", "the", "encoded", "archive", "containing", "the", "documents", "to", "be", "exfiltrated", ")", ",", "which", "will", "then", "be", "exfiltrated", "to", "the", "C2", "."], ["Afterward", ",", "it", "will", "sleep", "for", "another", "6,050", "milliseconds", "before", "restarting", "."], ["Document", "search", "module", ":", "Mssqldbserv.xml", "This", "module", "has", "been", "described", "before", "in", "the", "article", "here", "."], ["The", "purpose", "of", "this", "tool", "is", "to", "parse", "the", "hard", "drive", "for", "files", "with", "a", "specific", "extension", "and", "create", "an", "archive", "with", "these", "files", "."], ["Finally", ",", "the", "archive", "is", "encoded", "before", "being", "sent", "to", "the", "C2.mssqldbserv.xml", "main", "function", "However", ",", "there", "are", "some", "interesting", "details", "we", "decided", "to", "share", "."], ["The", "first", "instructions", "in", "the", "main", "function", "hide", "the", "console", "window", "from", "the", "user", "."], ["Afterward", ",", "the", "module", "will", "delete", "old", "``", "sft", "''", "files", "assuming", "they", "were", "already", "exfiltrated", "."], ["After", "a", "pause", "of", "6,500", "milliseconds", ",", "it", "will", "start", "its", "search", "for", "the", "targeted", "files", "."], ["SFT", "file", "creation", "routine", "Using", "the", "working", "directory", "as", "a", "base", "path", ",", "which", "in", "this", "sample", "case", "is", "C", ":", "\\DOCUME~1\\", "<", "USER", ">", "~1\\LOCALS~1\\Temp\\4CA-B25C11-A27BC\\", ",", "each", "selected", "file", "will", "be", "compressed", "into", "the", "file", "kr.zp", "."], ["The", "kr.zp", "data", "is", "then", "read", "and", "encoded", "using", "the", "same", "unusual", "encoded", "scheme.byte", "=", "byte", "XOR", "(", "byte", ">", ">", "4", ")", "If", "the", "file", "is", "larger", "than", "2048", "*", "53", "bytes", "(", "~", "106kb", ")", "it", "is", "split", "into", "chunks", "and", "saved", "into", "the", "sft", "files", "according", "to", "the", "naming", "convention", "below.gui_app0_", "[", "VolumeSerialNumber", "]", "_", "[", "MonthDayHourMinuteSecondMilliseconds", "]", "_", "[", "Counter", "]", ".sftSince", "this", "module", "does", "not", "have", "a", "loop", ",", "it", "will", "only", "be", "executed", "at", "the", "communications", "module", "startup", ",", "which", "means", "that", "it", "is", "only", "executed", "once", "per", "service", "start", "."], ["Mysterious", "Wintask.xmlOur", "initial", "analysis", "in", "a", "sandbox", "showed", "that", "the", "C2", "contact", "module", "attempts", "to", "execute", "this", "file", ",", "searching", "for", "it", "in", "the", "same", "path", "as", "the", "document", "search", "module", ",", "which", "we", "further", "corroborated", "with", "manual", "analysis", "."], ["All", "files", "in", "the", "toolkit", "are", "dropped", "by", "the", "trojanized", "software", "and", "it", "'s", "clear", "that", "the", "C2", "contact", "module", "expects", "this", "file", "to", "exist", "(", "the", "specific", "name", "changes", "form", "dropper", "to", "dropper", ")", "."], ["After", "first", "being", "documented", ",", "they", "changed", "their", "toolkit", "but", "not", "their", "techniques", "or", "procedures", "."]], "ner": [[[1, 1, "MP"], [6, 6, "MP"], [10, 10, "MP"]], [[26, 26, "MP"], [29, 30, "TP"], [34, 34, "MP"]], [[40, 40, "MP"], [46, 46, "MF"]], [[56, 56, "TP"], [62, 62, "TP"], [69, 69, "MP"], [72, 73, "MP"]], [[83, 83, "MP"], [85, 85, "MP"], [88, 88, "SO"]], [[93, 93, "MP"], [95, 95, "MP"], [96, 96, "MP"], [101, 101, "MP"]], [[113, 113, "MP"], [118, 118, "MP"], [124, 124, "SO"]], [[131, 131, "SF"], [146, 146, "MP"]], [[149, 149, "MP"]], [[160, 160, "MP"], [168, 170, "MP"]], [[186, 192, "MF"]], [[220, 220, "MF"], [222, 222, "MF"], [224, 224, "MF"]], [[237, 239, "MP"], [243, 244, "SF"]], [[273, 274, "MP"], [277, 278, "MF"], [283, 283, "SF"], [287, 287, "MP"]], [[306, 306, "MP"], [310, 310, "MF"], [312, 312, "MF"], [319, 319, "MP"]], [[322, 322, "MP"], [333, 333, "MP"], [335, 335, "MP"], [337, 337, "MP"]], [[348, 348, "MP"], [352, 352, "MF"]], [[356, 356, "MF"], [360, 360, "MP"]], [[375, 375, "MP"]], [[384, 384, "MP"], [398, 398, "MP"]], [[412, 413, "MP"]], [[418, 418, "MP"], [425, 426, "MP"]], [[433, 433, "MP"], [437, 437, "MP"]], [[454, 454, "MP"], [461, 463, "MP"], [475, 475, "MF"]], [[477, 479, "MP"], [485, 485, "MP"]], [[501, 501, "MF"], [506, 506, "MP"], [513, 515, "MP"]], [[520, 520, "MP"], [526, 528, "MP"], [532, 532, "SO"], [536, 537, "TF"]], [[539, 539, "MP"], [548, 548, "MF"]], [[553, 553, "MP"], [559, 565, "MP"], [566, 571, "MP"], [579, 580, "MP"]], [[587, 587, "MP"], [592, 592, "SO"]], [[601, 601, "MP"], [605, 605, "TF"]], [[627, 627, "MP"], [632, 632, "TF"], [654, 654, "SO"]], [[658, 658, "MP"]], [[668, 670, "MP"]], [[688, 688, "MP"], [693, 694, "MF"], [704, 704, "MF"]], [[712, 712, "MF"]], [], [[753, 753, "MP"], [758, 758, "TF"]], [[774, 774, "MP"], [781, 782, "MF"]], [[803, 809, "MF"], [820, 820, "MF"]], [[823, 823, "MF"], [868, 869, "MF"], [875, 875, "MP"], [889, 889, "MF"], [910, 910, "MF"]], [[929, 931, "MP"], [936, 936, "MF"], [940, 940, "MF"]], [[960, 960, "MF"], [968, 969, "MP"], [976, 978, "MP"]], [[1000, 1000, "MP"]]], "relations": [[[1, 1, 6, 6, "FR"], [1, 1, 10, 10, "FR"]], [[26, 26, 29, 30, "FR"], [26, 26, 34, 34, "FR"], [34, 34, 40, 40, "CO"]], [[40, 40, 46, 46, "WR"]], [[56, 56, 62, 62, "FR"], [69, 69, 72, 73, "FR"]], [[83, 83, 85, 85, "FR"], [83, 83, 88, 88, "ST"], [83, 83, 88, 88, "RF"]], [[96, 96, 124, 124, "ST"], [96, 96, 124, 124, "RF"], [101, 101, 124, 124, "ST"], [101, 101, 124, 124, "RF"], [93, 93, 101, 101, "CO"], [95, 95, 96, 96, "CO"]], [[113, 113, 124, 124, "ST"], [113, 113, 124, 124, "RF"], [118, 118, 124, 124, "ST"], [118, 118, 124, 124, "RF"], [118, 118, 131, 131, "RD"], [118, 118, 131, 131, "RD"], [118, 118, 131, 131, "WR"]], [[146, 146, 149, 149, "CO"]], [], [[160, 160, 131, 131, "RD"], [160, 160, 131, 131, "RD"], [160, 160, 131, 131, "WR"], [160, 160, 168, 170, "FR"], [160, 160, 186, 192, "WR"], [160, 160, 220, 220, "WR"], [160, 160, 222, 222, "WR"], [160, 160, 224, 224, "WR"]], [], [], [[237, 239, 243, 244, "RD"], [237, 239, 243, 244, "WR"]], [[273, 274, 283, 283, "RD"], [273, 274, 277, 278, "EX"], [273, 274, 283, 283, "WR"], [287, 287, 283, 283, "RD"], [287, 287, 306, 306, "CO"]], [[306, 306, 310, 310, "RD"], [306, 306, 312, 312, "RD"], [306, 306, 319, 319, "FR"]], [[322, 322, 333, 333, "FR"], [322, 322, 335, 335, "FR"], [322, 322, 337, 337, "FR"], [322, 322, 348, 348, "CO"]], [[348, 348, 352, 352, "EX"]], [[360, 360, 352, 352, "EX"], [360, 360, 356, 356, "EX"], [360, 360, 375, 375, "CO"], [360, 360, 384, 384, "CO"], [360, 360, 418, 418, "CO"]], [], [[384, 384, 398, 398, "FR"]], [[412, 413, 356, 356, "RD"], [412, 413, 532, 532, "ST"], [412, 413, 532, 532, "RF"]], [[418, 418, 425, 426, "FR"], [425, 426, 433, 433, "CO"]], [[433, 433, 437, 437, "FR"]], [[461, 463, 454, 454, "FR"], [461, 463, 475, 475, "UK"], [461, 463, 477, 479, "CO"], [461, 463, 513, 515, "CO"], [461, 463, 520, 520, "CO"], [461, 463, 539, 539, "CO"]], [[485, 485, 506, 506, "CO"], [485, 485, 398, 398, "CO"]], [[506, 506, 501, 501, "EX"], [506, 506, 513, 515, "FR"]], [[520, 520, 526, 528, "FR"], [520, 520, 532, 532, "ST"], [520, 520, 532, 532, "RF"], [520, 520, 536, 537, "WR"]], [[539, 539, 548, 548, "WR"]], [[553, 553, 559, 565, "FR"], [553, 553, 566, 571, "FR"], [553, 553, 579, 580, "FR"], [579, 580, 587, 587, "CO"], [579, 580, 601, 601, "CO"], [579, 580, 627, 627, "CO"], [579, 580, 658, 658, "CO"]], [[587, 587, 592, 592, "ST"], [587, 587, 592, 592, "RF"]], [[601, 601, 605, 605, "WR"]], [[627, 627, 632, 632, "RD"], [627, 627, 654, 654, "ST"], [627, 627, 654, 654, "RF"]], [], [[668, 670, 688, 688, "CO"], [668, 670, 753, 753, "CO"], [668, 670, 774, 774, "CO"]], [[688, 688, 693, 694, "UK"], [688, 688, 704, 704, "WR"], [688, 688, 712, 712, "WR"]], [], [], [[753, 753, 758, 758, "UK"]], [[774, 774, 781, 782, "RD"], [774, 774, 803, 809, "WR"], [774, 774, 820, 820, "WR"], [774, 774, 875, 875, "FR"]], [[820, 820, 823, 823, "CO"]], [[875, 875, 868, 869, "WR"], [875, 875, 910, 910, "EX"], [889, 889, 910, 910, "CO"]], [[929, 931, 936, 936, "EX"], [936, 936, 940, 940, "CO"], [929, 931, 976, 978, "CO"]], [[968, 969, 960, 960, "WR"]], []]}