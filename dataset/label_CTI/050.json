{"doc_key": "050", "sentences": [["As", "part", "of", "the", "ZetaNile", "campaign", ",", "some", "Word", "documents", "have", "been", "discovered", "that", "utilize", "a", "sequence", "of", "relationship", "definitions", "to", "load", "XLSM", "files", "embedded", "within", "the", "document", ".", "These", "XLSM", "files", "contain", "the", "VBA", "code", "that", "allows", "for", "payload", "downloads", "to", "take", "place", "."], ["Additionally", ",", "further", "malignant", "XLSM", "files", "are", "loaded", "during", "operation", "."], ["These", "maldocs", "are", "Office", "Open", "XML", "documents", "that", "consist", "of", "two", "essential", "relationship", "definition", "files", "--", "one", "primary", "file", "named", "``", "AquiTaLimpo.xml.rels", "''", "and", "another", "named", "``", "comments.xml.rels", "''", ".", "These", "files", "link", "to", "the", "embedded", "XLSM", "files", "containing", "the", "VBA", "code", "."], ["The", "VBA", "code", "is", "activated", "through", "a", "macro", "when", "the", "Word", "document", "is", "opened", ",", "and", "Excel", "is", "loaded", "subsequently", "to", "open", "the", "XLSM", "files", "embedded", "in", "the", "document", ",", "thereby", "enabling", "the", "macro", "and", ",", "in", "turn", ",", "the", "downloading", "of", "the", "payloads", "."], ["PPAM", "files", "are", "supplementary", "files", "utilized", "by", "Microsoft", "PowerPoint", "to", "provide", "enhanced", "functionality", ",", "such", "as", "customized", "macros", ",", "tools", ",", "and", "commands", "."], ["Finally", ",", "the", "infection", "chain", "concludes", "with", "the", "deployment", "of", "a", "RAT", ",", "which", "could", "be", "either", "njRAT", "or", "AsyncRAT", "."], ["The", "earliest", "discovered", "iteration", "of", "the", "infection", "chain", "features", "a", "macro", "that", "downloads", "and", "launches", "a", "remote", "HTA", "file", "from", "a", "host", "controlled", "by", "the", "attacker", "."], ["The", "PPAM", "file", "features", "a", "malign", "macro", "."], ["Stage", "1A", "of", "the", "attack", "involves", "a", "malign", "HTA", "that", "is", "a", "JavaScript", "snippet", "that", "is", "then", "activated", "through", "an", "embedded", "VBScript", ",", "allowing", "the", "infection", "chain", "to", "enter", "Stage", "2", ",", "wherein", "a", "PowerShell", "script", "is", "run", "."], ["Un-escaped", "VB", "is", "used", "to", "download", "and", "execute", "Stage", "2", "on", "the", "endpoint", "."], ["Stage", "2", "of", "this", "attack", "involves", "the", "deployment", "of", "a", "PowerShell", "script", "on", "the", "endpoint", ".", "This", "script", "serves", "as", "the", "primary", "instrument", "for", "the", "subsequent", "stages", "of", "the", "attack", "."], ["The", "PowerShell", "script", "initiates", "the", "following", "operations", "on", "the", "endpoint", ":"], ["-", "Changes", "the", "registry", "values", "to", "modify", "the", "current", "user", "'s", "Startup", "folders", "to", "ones", "specified", "in", "the", "script", "."], ["-", "Creates", "a", "customized", "VBS", "file", "(", "Stage", "#", "2A", ")", "in", "the", "configured", "Startup", "folder", ".", "This", "VBS", "file", "will", "execute", "a", "downloaded", "PowerShell", "(", "PS1", ")", "script", "(", "Stage", "#", "3", ",", "e.g.", ",", "``", "msi.ps1", "''", ")", "during", "reboots", "."], ["-", "Verifies", "the", "presence", "of", "five", "specific", "antivirus", "products", "on", "the", "endpoint", ".", "Based", "on", "the", "AV", "product", "found", ",", "the", "script", "downloads", "and", "executes", "a", "specific", "version", "of", "the", "PS1", "file", "(", "specified", "in", "Stage", "2", "and", "Stage", "3", ",", "e.g.", ",", "``", "msi.ps1", "''", ")", ",", "triggering", "the", "execution", "of", "the", "VBS", "created", "in", "Stage", "2A", "."], ["-", "If", "none", "of", "the", "five", "antivirus", "products", "are", "detected", ",", "the", "script", "performs", "the", "following", "actions", ":"], ["-", "Creates", "four", "configuration", "scripts", "on", "the", "endpoint", "."], ["-", "Script", "1", "is", "used", "to", "modify", "the", "``", "windir", "''", "path", "to", "execute", "itself", "when", "the", "user", "or", "any", "application", "accesses", "the", "environment", "variable", "."], ["-", "The", "script", "simultaneously", "runs", "Script", "3", "if", "the", "user", "has", "administrator", "privileges", "."], ["-", "Script", "2", "is", "used", "to", "create", "exclusions", "for", "Microsoft", "Defender", "for", "specific", "paths", ",", "executables", ",", "and", "deploys", "a", ".NET", "framework", "."], ["-", "Script", "3", "runs", "Script", "2", "."], ["-", "Script", "4", "runs", "Script", "1", "."], ["-", "Executes", "Script", "4", "on", "the", "endpoint", "."], ["-", "Finally", ",", "the", "parent", "PS1", "script", "downloads", "another", "version", "of", "the", "Stage", "4", "script", "and", "executes", "it", "via", "the", "Stage", "2A", "VBS", "script", "."], ["-", "Once", "the", "configuration", "scripts", "have", "completed", "execution", ",", "they", "are", "deleted", "from", "the", "endpoint", "."], ["A", "DLL", "called", "the", "Hexlified", "injector", "is", "utilized", "to", "induce", "malware", "into", "a", "specified", "process", "."], ["To", "perform", "this", ",", "a", "plaintext", "or", "Base64-encoded", "command", "is", "used", "to", "reflectively", "load", "the", "injector", "DLL", "into", "the", "powershell", "process", ",", "with", "the", "target", "process", "'", "image", "path", "and", "malware", "payload", "bytes", "passed", "as", "an", "argument", "to", "the", "injector", ".", "For", "example", ",", "the", "following", "script", "can", "be", "used", ":", "[", "Reflection.Assembly", "]", ":", ":Load", "(", "$", "H5", ")", ".GetType", "(", "'VBNET.PE", "'", ")", ".GetMethod", "(", "'Run", "'", ")", ".Invoke", "(", "$", "null", ",", "[", "object", "[", "]", "]", "(", "'", "C", ":", "\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\aspnet_compiler.exe", "'", ",", "$", "H1", ")", ")", "."], ["Minor", "variations", "have", "been", "observed", "in", "the", "infection", "chains", ",", "wherein", "some", "of", "the", "(", "mini", ")", "scripts", "used", "in", "Stage", "2", "are", "hosted", "independently", ",", "downloaded", ",", "and", "executed", "during", "the", "infection", "process", "."], ["The", "executables", "of", "the", "PowerShell", "Stage", "3", "script", "include", "two", "files", ":", "Injector", "DLL", "and", "malware", "payload", ".", "The", "DLL", "takes", "two", "arguments", ":"], ["Malware", "payload", "bytes", "to", "be", "injected", "into", "the", "hollowed-out", "target", "process", "."], ["Malware", "payload", ":", "The", "actual", "malware", "payload", "to", "be", "deployed", "on", "the", "endpoint", "."], ["The", "DLL", "is", "a", ".NET-based", "injector", "that", "only", "has", "one", "exported", "method", "to", "deploy", "the", "malware", "payload", "into", "the", "target", "process", ".", "Usually", ",", "the", "DLL", "is", "obfuscated", "with", ".NET", "Reactor", ",", "but", "it", "can", "be", "easily", "deobfuscated", "with", "de4dot", "."], ["If", "an", "error", "occurs", "during", "the", "injection", "process", ",", "the", "target", "process", "will", "be", "terminated", ",", "and", "it", "will", "be", "retried", "five", "times", "before", "giving", "up", "."], ["Interestingly", ",", "the", "DLL", "is", "a", "modified", "version", "of", "RunPE", "and", "also", "contains", "unused", "code", "that", "can", "change", "ACL", "to", "kernel", "objects", ",", "which", "is", "never", "called", "during", "the", "injection", "process", ".", "The", "unused", "code", "suggests", "either", "a", "work-in-progress", "or", "redundant", "code", "borrowed", "from", "somewhere", "else", "."]], "ner": [[[5, 5, "MP"], [8, 9, "MF"], [22, 23, "MF"], [30, 31, "MF"], [34, 35, "MF"], [39, 39, "MF"]], [[49, 50, "MF"]], [[57, 57, "MF"], [59, 62, "MF"], [77, 77, "MF"], [83, 83, "MF"], [92, 93, "MF"], [96, 97, "MF"]], [[100, 101, "MF"], [109, 110, "MF"], [115, 115, "MP"], [122, 123, "MF"], [132, 132, "MF"], [142, 142, "MF"]], [[144, 145, "MF"], [151, 152, "MP"], [160, 161, "TP"], [163, 163, "TP"], [166, 166, "TP"]], [[171, 172, "MP"], [179, 179, "MF"], [185, 185, "MF"], [187, 187, "MF"]], [[195, 196, "MP"], [199, 199, "MF"], [206, 207, "MF"], [210, 211, "SO"]], [[217, 217, "MP"], [222, 222, "MF"]], [[232, 232, "MP"], [236, 237, "MP"], [245, 245, "MF"], [249, 250, "MP"], [258, 259, "MF"]], [[264, 264, "MF"]], [[287, 288, "MP"], [293, 294, "MP"], [298, 299, "MP"]], [[310, 310, "MP"]], [[322, 323, "SF"], [330, 331, "SF"]], [[343, 343, "MF"], [357, 357, "MF"], [363, 367, "MF"], [376, 376, "MF"]], [[393, 393, "SO"], [403, 403, "MP"], [412, 413, "MF"], [426, 426, "MF"], [435, 435, "MF"]], [[453, 453, "MP"]], [[462, 463, "MF"]], [[469, 469, "MF"], [477, 477, "SF"]], [[496, 496, "MP"], [499, 499, "MF"]], [[509, 509, "MP"], [515, 515, "MF"], [517, 518, "TP"], [523, 523, "MP"]], [[532, 533, "MP"], [535, 536, "MF"]], [[539, 540, "MP"], [542, 543, "MF"]], [[547, 548, "MP"], [551, 551, "SO"]], [[558, 559, "MP"], [565, 567, "MF"], [570, 570, "MF"], [575, 576, "MP"]], [[581, 582, "MF"], [592, 592, "SO"]], [[595, 595, "MF"], [604, 604, "MP"], [608, 608, "MP"]], [[615, 615, "MP"], [617, 617, "MP"], [625, 626, "MF"], [629, 630, "MP"], [634, 638, "TF"], [640, 642, "MF"], [672, 672, "MF"], [692, 694, "MF"]], [[709, 710, "MP"], [719, 719, "MF"]], [[738, 738, "MP"], [744, 744, "MF"], [752, 753, "MF"], [756, 756, "MF"]], [], [], [[788, 788, "MF"], [791, 791, "MP"], [802, 803, "MF"], [806, 807, "MP"]], [[834, 834, "MP"], [838, 839, "MP"]], [[858, 858, "MF"], [864, 864, "MF"], [869, 869, "MF"]]], "relations": [[[5, 5, 8, 9, "WR"], [5, 5, 22, 23, "RD"], [5, 5, 34, 35, "EX"], [5, 5, 39, 39, "WR"], [5, 5, 57, 57, "WR"], [5, 5, 59, 62, "WR"], [5, 5, 77, 77, "WR"], [5, 5, 83, 83, "WR"], [5, 5, 109, 110, "WR"], [22, 23, 30, 31, "CO"], [22, 23, 49, 50, "CO"]], [], [[92, 93, 22, 23, "CO"], [96, 97, 100, 101, "CO"]], [[115, 115, 57, 57, "WR"], [115, 115, 59, 62, "WR"], [115, 115, 77, 77, "WR"], [115, 115, 83, 83, "WR"], [115, 115, 92, 93, "WR"], [115, 115, 109, 110, "WR"], [115, 115, 122, 123, "RD"], [115, 115, 132, 132, "EX"], [115, 115, 142, 142, "WR"]], [[151, 152, 144, 145, "WR"], [151, 152, 160, 161, "FR"], [151, 152, 163, 163, "FR"], [151, 152, 166, 166, "FR"]], [[171, 172, 179, 179, "WR"], [185, 185, 179, 179, "CO"], [185, 185, 187, 187, "CO"]], [[195, 196, 185, 185, "WR"], [195, 196, 187, 187, "WR"], [195, 196, 199, 199, "WR"], [195, 196, 206, 207, "WR"], [195, 196, 206, 207, "EX"], [195, 196, 210, 211, "ST"], [195, 196, 210, 211, "RF"]], [[217, 217, 206, 207, "RD"], [217, 217, 222, 222, "WR"], [217, 217, 222, 222, "WR"]], [[232, 232, 222, 222, "WR"], [232, 232, 245, 245, "EX"], [249, 250, 245, 245, "RD"], [232, 232, 258, 259, "WR"], [232, 232, 258, 259, "EX"], [249, 250, 258, 259, "WR"], [249, 250, 264, 264, "WR"], [232, 232, 236, 237, "CO"]], [], [[287, 288, 298, 299, "CO"], [287, 288, 293, 294, "CO"]], [[310, 310, 322, 323, "RD"], [310, 310, 264, 264, "WR"], [310, 310, 330, 331, "RD"], [310, 310, 322, 323, "WR"], [310, 310, 330, 331, "WR"], [310, 310, 343, 343, "WR"], [310, 310, 363, 367, "EX"], [310, 310, 376, 376, "WR"], [310, 310, 393, 393, "ST"], [310, 310, 393, 393, "RF"], [310, 310, 477, 477, "RD"], [310, 310, 403, 403, "CO"], [310, 310, 453, 453, "CO"], [310, 310, 496, 496, "CO"]], [], [[343, 343, 357, 357, "CO"], [376, 376, 426, 426, "CO"]], [[403, 403, 412, 413, "WR"], [403, 403, 426, 426, "WR"], [403, 403, 435, 435, "EX"]], [[453, 453, 462, 463, "WR"], [453, 453, 469, 469, "WR"], [453, 453, 477, 477, "WR"]], [], [], [[496, 496, 499, 499, "EX"]], [[509, 509, 393, 393, "ST"], [509, 509, 393, 393, "RF"], [509, 509, 515, 515, "WR"], [517, 518, 515, 515, "RD"], [517, 518, 515, 515, "EX"], [517, 518, 523, 523, "FR"]], [[532, 533, 535, 536, "EX"]], [[539, 540, 542, 543, "EX"]], [[547, 548, 542, 543, "RD"], [547, 548, 551, 551, "ST"], [547, 548, 551, 551, "RF"], [547, 548, 551, 551, "ST"], [547, 548, 551, 551, "RF"]], [[558, 559, 551, 551, "ST"], [558, 559, 551, 551, "RF"], [558, 559, 565, 567, "WR"], [558, 559, 575, 576, "FR"], [575, 576, 570, 570, "EX"], [575, 576, 581, 582, "WR"], [575, 576, 592, 592, "ST"], [575, 576, 592, 592, "RF"], [565, 567, 570, 570, "CO"]], [], [[608, 608, 595, 595, "EX"], [608, 608, 604, 604, "IJ"], [604, 604, 581, 582, "WR"], [604, 604, 592, 592, "ST"], [604, 604, 592, 592, "RF"]], [[615, 615, 625, 626, "RD"], [617, 617, 625, 626, "RD"], [617, 617, 629, 630, "IJ"], [617, 617, 634, 638, "WR"], [617, 617, 640, 642, "WR"], [629, 630, 672, 672, "WR"], [629, 630, 692, 694, "WR"]], [[709, 710, 672, 672, "WR"], [709, 710, 692, 694, "WR"], [709, 710, 719, 719, "WR"], [709, 710, 719, 719, "EX"]], [[738, 738, 744, 744, "WR"], [738, 738, 752, 753, "RD"], [738, 738, 756, 756, "WR"], [756, 756, 788, 788, "CO"]], [], [], [[791, 791, 788, 788, "WR"], [791, 791, 802, 803, "WR"], [806, 807, 802, 803, "WR"], [806, 807, 838, 839, "CO"]], [[834, 834, 838, 839, "UK"]], []]}