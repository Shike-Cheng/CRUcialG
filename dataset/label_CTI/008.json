{"doc_key": "008", "sentences": [["The", "attackers", "use", "malicious", "VBS", "macros", "that", "are", "hidden", "within", "remote", "templates", "to", "gain", "initial", "access", "to", "the", "victim", "'s", "system", "."], ["These", "macros", "are", "triggered", "when", "the", "user", "opens", "the", "document", "and", "they", "then", "download", "RAR", "archives", "containing", "LNK", "files", ",", "which", "typically", "only", "contain", "the", "LNK", "file", "itself", "."], ["The", "LNKs", "then", "attempt", "to", "execute", "MSHTA.EXE", "in", "order", "to", "download", "and", "parse", "a", "remote", "XML", "file", ",", "which", "ultimately", "leads", "to", "the", "execution", "of", "a", "malicious", "PowerShell", "script", "."], ["The", "threat", "actor", "known", "as", "Gamaredon", "is", "associated", "with", "the", "domain", "xsph.ru", "and", "their", "servers", "only", "allow", "access", "from", "IP", "addresses", "inside", "the", "Ukrainian", "address", "space", "."], ["This", "PowerShell", "script", "executed", "by", "the", "LNKs", "decodes", "and", "executes", "a", "second", "PowerShell", "script", "called", "the", "``", "instrumentor", ",", "''", "which", "collects", "the", "victim", "'s", "data", "and", "sends", "it", "back", "to", "a", "remote", "server", "."], ["Additionally", ",", "the", "instrumentor", "script", "enables", "the", "attacker", "to", "send", "a", "PowerShell", "command", "or", "binary", "blob", "containing", "encrypted", "VBScript", "(", "VBS", ")", "code", "for", "local", "execution", "."], ["The", "instrumentor", "script", "runs", "additional", "commands", "and", "payloads", "on", "the", "endpoint", "and", "usually", "includes", "a", "function", "that", "decodes", "the", "encrypted", "response", "from", "the", "command", "and", "control", "(", "C2", ")", "server", "and", "executes", "it", "as", "a", "VBScript", "object", "."], ["The", "PowerShell", "script", "utilized", "by", "the", "attackers", "also", "includes", "a", "feature", "for", "capturing", "the", "victim", "'s", "screen", "."], ["The", "script", "uses", "the", "``", "System.Windows.Forms", "''", "object", "to", "capture", "a", "copy", "of", "the", "virtual", "desktop", ",", "including", "setups", "with", "multiple", "screens", "."], ["This", "function", "is", "executed", "nine", "times", ",", "with", "each", "screenshot", "being", "saved", "to", "``", "%", "TEMP", "%", "\\test.png", "''", "."], ["However", ",", "this", "file", "is", "overwritten", "with", "each", "new", "screenshot", "."], ["The", "resulting", "PNG", "image", "is", "then", "converted", "into", "a", "base64-encoded", "string", ",", "stored", "in", "a", "variable", ",", "and", "the", "original", "file", "is", "removed", "from", "the", "disk", "."], ["After", "the", "screen", "capture", ",", "the", "script", "proceeds", "to", "upload", "the", "victim", "'s", "information", "to", "a", "remote", "server", "."], ["The", "exfiltrated", "data", "includes", "system", "information", "that", "is", "collected", "and", "sent", "to", "a", "hardcoded", "C2", "URL", "."], ["Upon", "receiving", "the", "system", "information", ",", "the", "server", "response", "is", "parsed", "to", "see", "if", "there", "are", "any", "commands", "to", "be", "executed", "."], ["If", "there", "are", ",", "the", "remainder", "of", "the", "response", "is", "expected", "to", "be", "a", "PowerShell", "code", "that", "is", "passed", "directly", "to", "the", "command", "IEX", "."], ["The", "output", "of", "that", "command", "is", "added", "to", "the", "variable", "``", "cmd", "''", "and", "sent", "back", "to", "the", "C2", "server", "."], ["If", "the", "response", "from", "the", "server", "starts", "with", "any", "other", "character", ",", "it", "is", "treated", "as", "an", "encrypted", "blob", "and", "passed", "to", "the", "decoder", "function", "along", "with", "the", "volume", "serial", "number", ",", "which", "is", "decoded", "and", "executed", "as", "VBScript", "."], ["One", "of", "the", "payloads", "served", "to", "the", "instrumentor", "script", "was", "PowerShell", "code", "used", "to", "set", "an", "environmental", "variable", "that", "contained", "PowerShell", "code", "and", "a", "Registry", "RUN", "key", "to", "run", "every", "time", "the", "user", "logs", "in", "."], ["This", "PowerShell", "script", "sets", "up", "the", "RUN", "key", "to", "execute", "another", "PowerShell", "script", "stored", "in", "the", "environmental", "variable", "."], ["Finally", ",", "the", "script", "includes", "the", "Get-IP", "function", ",", "which", "queries", "a", "DNS", "lookup", "service", "for", "an", "attacker-specified", "domain", "and", "uses", "one", "of", "the", "returned", "IP", "addresses", "as", "the", "IP", "to", "download", "the", "next", "payloads", "."], ["The", "next-stage", "payload", "for", "the", "malware", "is", "fetched", "using", "a", "PowerShell", "script", "that", "constructs", "a", "URL", "based", "on", "the", "IP", "address", "."], ["The", "resulting", "PowerShell", "script", "is", "saved", "in", "``", "$", "env", ":", "Include", "''", "."], ["When", "a", "user", "logs", "in", ",", "the", "script", "is", "executed", "through", "the", "HKCU\\Run", "key", ",", "providing", "attackers", "with", "continuous", "access", "to", "the", "infected", "endpoint", "and", "the", "ability", "to", "deploy", "additional", "payloads", "as", "they", "see", "fit", "."], ["To", "attain", "persistence", ",", "the", "script", "obtains", "the", "remote", "location", "'s", "IP", "address", "and", "stores", "it", "in", "an", "environment", "variable", "."], ["The", "PowerShell", "code", "residing", "in", "the", "variable", "uses", "the", "Get-IP", "(", ")", "function", "to", "retrieve", "a", "random", "IP", "assigned", "to", "the", "domain", "and", "queries", "a", "URL", "constructed", "from", "the", "IP", "address", "and", "a", "hardcoded", "extended", "resource", "."], ["As", "with", "the", "previous", "script", ",", "communications", "with", "the", "C2", "server", "use", "the", "computer", "name", "and", "volume", "serial", "number", "."], ["The", "C2", "server", "encodes", "the", "next-stage", "payload", ",", "which", "is", "subsequently", "served", "to", "the", "script", "."], ["If", "the", "response", "begins", "with", "``", "http", "''", ",", "the", "content", "is", "treated", "as", "a", "URL", "that", "leads", "to", "the", "final", "payload", "binary", "."], ["The", "Volume", "Serial", "Number", "and", "Computer", "Name", "are", "passed", "to", "this", "URL", ",", "and", "the", "XorBytes", "function", "decodes", "the", "response", "."], ["The", "decrypted", "binary", "file", "is", "then", "executed", "after", "being", "saved", "to", "the", "``", "%", "TEMP", "%", "''", "folder", "with", "a", "random", "string", "of", "numbers", "and", "the", "``", ".exe", "''", "file", "extension", "."], ["Alternatively", ",", "if", "the", "response", "from", "the", "C2", "does", "not", "begin", "with", "``", "http", "''", ",", "the", "content", "is", "treated", "as", "a", "VBS", "file", ",", "which", "is", "executed", "through", "a", "COM", "object", "."], ["The", "attackers", "employed", "a", "PowerShell", "script", "to", "deploy", "malicious", "executables", "that", "include", "an", "information-stealing", "component", "."], ["This", "component", "exfiltrates", "specific", "file", "types", "from", "the", "infected", "endpoint", ":", ".doc", ",", ".docx", ",", ".xls", ",", ".rtf", ",", ".odt", ",", ".txt", ",", ".jpg", ",", ".jpeg", ",", ".pdf", ",", ".ps1", ",", ".rar", ",", ".zip", ",", ".7z", ",", "and", ".mdb", "."], ["To", "keep", "track", "of", "what", "has", "been", "exfiltrated", ",", "the", "malware", "creates", "a", "file", "named", "``", "profiles_c.ini", "''", "in", "the", "``", "%", "USERPROFILE", "%", "\\Appdata\\Local", "''", "folder", "."], ["The", "file", "contains", "the", "MD5", "hash", "of", "a", "string", "comprising", "the", "filename", ",", "file", "size", ",", "and", "modification", "date", "of", "the", "exfiltrated", "file", "."], ["When", "initiated", ",", "the", "malware", "scans", "all", "storage", "devices", "associated", "with", "the", "device", "for", "files", "with", "the", "specified", "extensions", "."], ["For", "each", "file", "found", ",", "the", "malware", "submits", "a", "POST", "request", "containing", "metadata", "about", "the", "exfiltrated", "file", "and", "its", "content", "."], ["The", "implant", "exfiltrates", "files", "by", "sending", "POST", "data", "that", "includes", "the", "metadata", "and", "raw", "content", "of", "each", "file", "."], ["The", "request", "is", "made", "to", "a", "random", "URI", "under", "the", "parent", "C2", "domain", ",", "with", "the", "implant", "generating", "a", "random", "12-character", "subdomain", "for", "sending", "requests", "to", "."], ["The", "malware", "searches", "fixed", "and", "remote", "drives", "for", "relevant", "file", "extensions", ",", "specifically", "targeting", "files", "in", "the", "``", "C", ":", "\\Users", "''", "folder", "while", "avoiding", "enumeration", "of", "any", "folder", "containing", "specified", "strings", "in", "the", "path", "."], ["This", "likely", "indicates", "an", "effort", "to", "avoid", "exfiltrating", "system", "files", "and", "instead", "focus", "on", "user", "files", "of", "interest", "."], ["For", "each", "file", "exfiltrated", ",", "the", "MD5", "hash", "of", "specific", "information", "is", "calculated", "and", "stored", "in", "the", "``", "%", "LocalAppData", "%", "\\profiles_c.ini", "''", "file", "."], ["The", "implant", "also", "steals", "files", "from", "removable", "drives", "connected", "to", "the", "infected", "endpoint", ",", "creating", "a", "randomly", "named", "folder", "in", "the", "%", "TEMP", "%", "directory", "and", "copying", "the", "original", "file", "there", "."], ["For", "instance", ",", "if", "a", "file", "named", "``", "isengard.doc", "''", "is", "found", "in", "a", "remote", "drive", "``", "E", ":", "''", "located", "at", "path", "``", "E", ":", "\\top_secret_docs", ",", "''", "it", "will", "be", "copied", "to", "``", "%", "temp", "%", "\\randomly_named_folder\\connect", "<", "removable_vol_serial_number", ">", "\\top_secret_docs\\isengard.doc", "''", "."], ["The", "contents", "of", "the", "folder", "in", "the", "temp", "directory", "are", "then", "exfiltrated", "to", "the", "C2", "."], ["This", "binary", ",", "like", "the", "actor", "'s", "previous", "tools", "(", "such", "as", "PS1", "scripts", ")", ",", "downloads", "additional", "payloads", "based", "on", "the", "parsed", "server", "response", "."], ["The", "server", "response", "consists", "of", "a", "flag", "indicating", "how", "the", "data", "should", "be", "treated", ":"], ["1", ")", "EXE", "is", "written", "to", "disk", "and", "executed", ";"], ["2", ")", "VBS", "is", "written", "to", "disk", "and", "executed", "using", "wscript.exe", ";"], ["and", "any", "other", "value", "is", "treated", "as", "a", "blob", "of", "data", ",", "which", "is", "written", "to", "a", "file", "on", "disk", "in", "the", "%", "TEMP", "%", "folder", "."], ["To", "establish", "persistence", ",", "a", "registry", "key", "named", "``", "Windows", "Task", "''", "is", "created", "under", "HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", "."], ["Additionally", ",", "a", "mutex", "is", "created", "with", "the", "name", "Global\\flashupdate_r", "."]], "ner": [[[1, 1, "MP"], [4, 5, "MF"]], [[23, 23, "MF"], [28, 28, "TP"], [31, 31, "MF"], [36, 37, "MF"], [39, 40, "MF"], [47, 48, "MF"]], [[52, 52, "MP"], [57, 57, "MP"], [66, 67, "MF"], [78, 79, "MP"]], [[86, 86, "MP"], [91, 92, "SO"], [95, 95, "SO"]], [[109, 110, "MP"], [114, 114, "MP"], [120, 121, "MP"], [125, 125, "MP"], [133, 133, "SF"], [140, 141, "SO"]], [[147, 147, "MP"], [150, 150, "SO"], [154, 155, "MF"], [157, 158, "MF"], [161, 161, "MF"], [163, 163, "MF"]], [[172, 172, "MP"], [175, 175, "MF"], [177, 177, "MF"], [189, 190, "MF"], [193, 199, "SO"], [202, 202, "MF"], [205, 206, "MF"]], [[209, 210, "MP"], [214, 214, "MP"], [222, 224, "SF"]], [[227, 227, "MP"], [231, 231, "TP"], [237, 241, "SF"]], [[250, 250, "MP"], [263, 267, "TF"]], [], [[281, 283, "TF"], [289, 290, "TF"], [299, 300, "TF"]], [[313, 313, "MP"], [318, 320, "TF"], [323, 324, "SO"]], [[328, 328, "TF"], [340, 341, "SO"]], [[346, 347, "TF"], [350, 350, "SO"]], [[379, 380, "MF"]], [[400, 402, "TP"], [408, 409, "SO"]], [[423, 423, "MF"], [429, 429, "MF"], [434, 435, "MP"], [439, 441, "SF"], [449, 449, "MP"]], [[454, 454, "MP"], [458, 459, "MP"], [461, 462, "MF"], [467, 468, "SF"], [475, 477, "SF"]], [[488, 489, "MP"], [493, 494, "SF"], [498, 499, "MF"]], [[509, 509, "MP"], [512, 513, "MP"], [523, 524, "SO"], [531, 532, "SO"], [535, 535, "SO"], [540, 540, "MF"]], [[544, 544, "MF"], [552, 553, "MP"], [556, 557, "MF"]], [[566, 567, "MP"], [571, 576, "TF"]], [[580, 580, "TP"], [585, 585, "MP"], [594, 594, "MP"], [608, 608, "MF"]], [[619, 619, "MP"], [625, 626, "TF"], [632, 633, "SF"]], [[636, 637, "MP"], [641, 641, "SF"], [644, 647, "MP"], [652, 652, "TF"], [660, 660, "TF"], [664, 665, "SO"]], [[676, 676, "MF"], [681, 682, "SO"], [685, 686, "SF"], [688, 690, "SF"]], [[693, 694, "MP"], [698, 698, "MF"], [706, 706, "MF"]], [[723, 723, "MF"], [728, 730, "MF"]], [[733, 735, "SF"], [737, 738, "SF"], [743, 743, "MF"], [747, 748, "MP"]], [[754, 756, "MF"]], [[807, 808, "MF"], [815, 816, "MP"]], [[819, 819, "MP"], [822, 823, "MP"], [827, 827, "MF"], [831, 832, "MF"]], [[835, 835, "MP"], [845, 873, "SF"]], [[884, 884, "MP"], [889, 891, "TF"]], [[903, 903, "TF"]], [[930, 930, "MP"], [933, 934, "SF"], [940, 940, "SF"]], [[948, 948, "SF"], [952, 952, "MP"]], [[968, 968, "MP"], [970, 970, "SF"]], [[1002, 1002, "MP"]], [[1014, 1014, "MP"], [1022, 1022, "SF"], [1027, 1027, "SF"]], [[1057, 1058, "SF"], [1063, 1064, "SF"]], [[1070, 1070, "SF"], [1085, 1091, "TF"]], [[1094, 1094, "MP"], [1097, 1097, "SF"], [1121, 1122, "SF"]], [[1130, 1130, "SF"], [1154, 1154, "SF"]], [[1171, 1171, "SF"], [1184, 1184, "SO"]], [[1187, 1187, "MP"], [1198, 1199, "MP"], [1204, 1204, "MF"]], [[1213, 1213, "MP"], [1218, 1218, "MF"], [1222, 1222, "SF"]], [[1229, 1229, "MF"]], [[1239, 1239, "MF"], [1247, 1247, "MP"]], [[1257, 1259, "MF"], [1266, 1266, "SF"]], [[1281, 1282, "MF"], [1284, 1286, "MF"], [1291, 1291, "SF"]], [[1296, 1296, "MF"], [1302, 1302, "MF"]]], "relations": [[[1, 1, 4, 5, "EX"], [4, 5, 23, 23, "CO"], [4, 5, 31, 31, "CO"], [1, 1, 214, 214, "CO"], [1, 1, 819, 819, "CO"]], [[28, 28, 31, 31, "RD"], [28, 28, 36, 37, "WR"], [39, 40, 47, 48, "CO"], [39, 40, 36, 37, "CO"], [28, 28, 580, 580, "CO"]], [[52, 52, 47, 48, "EX"], [52, 52, 57, 57, "FR"], [57, 57, 66, 67, "WR"], [57, 57, 78, 79, "FR"], [52, 52, 114, 114, "CO"]], [[86, 86, 66, 67, "RD"], [86, 86, 91, 92, "ST"], [86, 86, 91, 92, "RF"], [86, 86, 91, 92, "ST"], [86, 86, 91, 92, "RF"], [86, 86, 95, 95, "ST"], [86, 86, 95, 95, "RF"]], [[114, 114, 109, 110, "FR"], [109, 110, 91, 92, "ST"], [109, 110, 91, 92, "RF"], [109, 110, 95, 95, "ST"], [109, 110, 95, 95, "RF"], [109, 110, 120, 121, "FR"], [125, 125, 133, 133, "RD"], [125, 125, 140, 141, "ST"], [125, 125, 140, 141, "RF"], [120, 121, 125, 125, "CO"], [120, 121, 172, 172, "CO"], [120, 121, 209, 210, "CO"], [120, 121, 227, 227, "CO"], [120, 121, 250, 250, "CO"], [120, 121, 313, 313, "CO"], [109, 110, 147, 147, "CO"]], [[147, 147, 150, 150, "ST"], [147, 147, 150, 150, "RF"], [147, 147, 154, 155, "WR"], [147, 147, 157, 158, "WR"], [157, 158, 161, 161, "CO"], [157, 158, 163, 163, "CO"]], [[172, 172, 175, 175, "EX"], [172, 172, 177, 177, "EX"], [172, 172, 189, 190, "WR"], [172, 172, 193, 199, "ST"], [172, 172, 193, 199, "RF"], [189, 190, 202, 202, "CO"], [189, 190, 205, 206, "CO"]], [[214, 214, 222, 224, "RD"]], [[227, 227, 231, 231, "FR"], [231, 231, 237, 241, "RD"]], [[250, 250, 263, 267, "WR"], [250, 250, 281, 283, "RD"], [250, 250, 289, 290, "WR"], [250, 250, 299, 300, "UK"], [263, 267, 299, 300, "CO"], [263, 267, 281, 283, "CO"]], [], [], [[313, 313, 318, 320, "RD"], [313, 313, 323, 324, "ST"], [313, 313, 323, 324, "RF"], [313, 313, 328, 328, "RD"], [313, 313, 340, 341, "ST"], [313, 313, 340, 341, "RF"]], [[328, 328, 346, 347, "CO"], [340, 341, 350, 350, "CO"]], [], [], [[400, 402, 379, 380, "EX"], [400, 402, 408, 409, "ST"], [400, 402, 408, 409, "RF"]], [[434, 435, 429, 429, "RD"], [434, 435, 439, 441, "RD"], [434, 435, 449, 449, "FR"], [423, 423, 429, 429, "CO"]], [[458, 459, 467, 468, "RD"], [458, 459, 454, 454, "FR"], [458, 459, 475, 477, "RD"], [458, 459, 467, 468, "WR"], [458, 459, 475, 477, "WR"], [458, 459, 488, 489, "FR"]], [[488, 489, 493, 494, "RD"], [488, 489, 461, 462, "EX"], [488, 489, 493, 494, "WR"], [488, 489, 498, 499, "EX"], [488, 489, 512, 513, "CO"], [488, 489, 509, 509, "CO"]], [[512, 513, 523, 524, "ST"], [512, 513, 523, 524, "RF"], [512, 513, 531, 532, "ST"], [512, 513, 531, 532, "RF"], [512, 513, 540, 540, "WR"], [531, 532, 535, 535, "CO"], [540, 540, 544, 544, "CO"]], [[552, 553, 556, 557, "WR"], [552, 553, 544, 544, "RD"], [552, 553, 632, 633, "RD"], [552, 553, 566, 567, "CO"], [552, 553, 585, 585, "CO"], [552, 553, 619, 619, "CO"]], [[566, 567, 571, 576, "WR"]], [[580, 580, 585, 585, "FR"], [585, 585, 594, 594, "FR"], [594, 594, 608, 608, "WR"]], [[619, 619, 625, 626, "RD"], [619, 619, 632, 633, "WR"], [632, 633, 641, 641, "CO"]], [[636, 637, 625, 626, "EX"], [636, 637, 644, 647, "FR"], [644, 647, 652, 652, "RD"], [644, 647, 660, 660, "RD"], [644, 647, 664, 665, "ST"], [644, 647, 664, 665, "RF"], [644, 647, 676, 676, "WR"], [644, 647, 681, 682, "ST"], [644, 647, 681, 682, "RF"], [644, 647, 685, 686, "RD"], [644, 647, 688, 690, "RD"]], [], [[693, 694, 676, 676, "WR"], [693, 694, 698, 698, "WR"], [693, 694, 706, 706, "WR"], [693, 694, 733, 735, "RD"], [693, 694, 733, 735, "RD"], [693, 694, 733, 735, "WR"], [693, 694, 737, 738, "RD"], [693, 694, 737, 738, "RD"], [693, 694, 737, 738, "WR"]], [[723, 723, 728, 730, "CO"], [723, 723, 743, 743, "CO"], [723, 723, 754, 756, "CO"]], [[747, 748, 706, 706, "WR"], [747, 748, 733, 735, "RD"], [747, 748, 733, 735, "RD"], [747, 748, 733, 735, "WR"], [747, 748, 737, 738, "RD"], [747, 748, 737, 738, "RD"], [747, 748, 737, 738, "WR"], [747, 748, 743, 743, "WR"]], [], [[815, 816, 807, 808, "EX"]], [[819, 819, 822, 823, "FR"], [822, 823, 827, 827, "WR"], [827, 827, 831, 832, "CO"]], [[835, 835, 831, 832, "EX"], [835, 835, 845, 873, "RD"], [835, 835, 845, 873, "RD"], [835, 835, 940, 940, "WR"], [845, 873, 940, 940, "CO"], [845, 873, 948, 948, "CO"]], [[884, 884, 889, 891, "WR"], [889, 891, 903, 903, "CO"], [884, 884, 930, 930, "CO"], [884, 884, 952, 952, "CO"], [884, 884, 1014, 1014, "CO"]], [], [[930, 930, 933, 934, "RD"]], [[952, 952, 968, 968, "FR"]], [[968, 968, 970, 970, "RD"], [968, 968, 1002, 1002, "CO"], [968, 968, 1094, 1094, "CO"]], [[1002, 1002, 1070, 1070, "RD"], [1002, 1002, 1085, 1091, "WR"]], [[1014, 1014, 1022, 1022, "RD"], [1014, 1014, 1027, 1027, "RD"]], [[1063, 1064, 1070, 1070, "CO"], [1057, 1058, 1027, 1027, "CO"]], [[1085, 1091, 1057, 1058, "RD"], [1085, 1091, 1057, 1058, "WR"]], [[1094, 1094, 1097, 1097, "RD"], [1094, 1094, 1121, 1122, "RD"], [1094, 1094, 1171, 1171, "RD"], [1094, 1094, 1184, 1184, "ST"], [1094, 1094, 1184, 1184, "RF"]], [[1130, 1130, 1154, 1154, "CO"]], [[1171, 1171, 1222, 1222, "CO"]], [[1187, 1187, 1204, 1204, "WR"], [1187, 1187, 1198, 1199, "CO"]], [[1213, 1213, 1218, 1218, "WR"], [1213, 1213, 1229, 1229, "WR"]], [], [[1247, 1247, 1229, 1229, "WR"], [1247, 1247, 1239, 1239, "EX"], [1247, 1247, 1239, 1239, "WR"]], [], [[1281, 1282, 1284, 1286, "CO"]], [[1296, 1296, 1302, 1302, "CO"]]]}