{"doc_key": "070", "sentences": [["For", "example", ",", "if", "the", "final", "payload", "was", "a", "CrimsonRAT", "or", "ObliqueRAT", "sample", ",", "we", "would", "attribute", "the", "VBA", "code", "to", "the", "Transparent", "Tribe", "group", "."], ["Their", "initial", "infection", "vector", "is", "usually", "email", ",", "purporting", "to", "come", "from", "official", "sources", "and", "containing", "a", "lure", ",", "which", "can", "be", "a", "Word", "document", "or", "more", "often", ",", "an", "Excel", "spreadsheet", "."], ["The", "code", "establishes", "a", "hardcoded", "destination", "path", "for", "one", "or", "more", "payload", "files", "and", "then", "uses", "a", "Text", "field", "of", "a", "user-defined", "form", "to", "get", "the", "content", "of", "the", "payload", "to", "be", "dropped", "to", "disk", "."], ["The", "string", "needs", "to", "be", "converted", "into", "a", "binary", "byte", "array", "before", "it", "is", "written", "to", "disk", "as", "a", "ZIP", "compressed", "file", "."], ["The", "conversion", "is", "executed", "in", "a", "for-each", "loop", "iterating", "over", "the", "content", "of", "the", "string", "and", "converting", "every", "two", "characters", "into", "a", "binary", "byte", "with", "the", "help", "of", "the", "CByte", "conversion", "function", "."], ["One", "interesting", "aspect", "of", "the", "Donot", "VBA", "code", "is", "that", "it", "often", "contains", "a", "fake", "error", "message", "which", "is", "displayed", "to", "the", "user", "before", "or", "after", "the", "payload", "is", "dropped", "and", "executed", "."], ["Fake", "Powerpoint", "message", "displayed", "by", "the", "Donot", "VBA", "code", "."], ["However", ",", "we", "can", "see", "that", "the", "similarity", "between", "SDuser", "VBA", "code", "and", "Donot", "VBA", "code", "is", "also", "strong", ",", "with", "all", "the", "well", "known", "elements", ":", "Setting", "of", "the", "path", "to", "the", "folder", "for", "the", "payload", "."], ["Using", "VBA", "forms", "to", "store", "the", "payload", "with", "a", "specific", "separator", "character", "."], ["Using", "Cbyte", "to", "convert", "the", "hexadecimal", "strings", "into", "a", "binary", "byte", "array", "."], ["Displaying", "a", "fake", "Excel", "error", "message", "."], ["The", "samples", "are", "found", "on", "Virustotal", "based", "on", "the", "PDB", "path", "``", "C", ":", "\\Users\\SDUSER\\source", "epos", "''", ",", "which", "was", "left", "by", "the", "developers", "in", "the", "payload", "."], ["Overall", ",", "there", "were", "almost", "30", "samples", "uploaded", "to", "VirusTotal", ",", "belonging", "to", "seven", "different", "projects", ":", "Mal", "January", "2021Test", "January", "202112324", "January", "2021Evading____", "-", "February", "2021ConsoleApplication4", "March", "2021Obfuscating", "shellcode", "March", "2021WindowsSecurity", "June", "2021The", "functionality", "of", "the", "payloads", "was", "quite", "similar", "."], ["The", "Windows", "security", "payload", "starts", "with", "the", "following", "anti-sandboxing", "checks", ":", "There", "are", "two", "or", "more", "processor", "cores", "in", "the", "system", "."], ["The", "mouse", "cursor", "has", "moved", "sufficiently", "far", "between", "checking", "of", "two", "positions", "."], ["There", "are", "more", "than", "50", "processes", "running", "on", "the", "infected", "system", "."], ["ConsoleApplication4", ",", "anti", "sandboxing", "checks", "in", "the", "most", "recent", "payload", "."], ["In", "the", "most", "recent", "payload", ",", "ConsoleApplication4", "project", ",", "the", "attackers", "added", "anti-sandboxing", "checks", "to", "check", "for", "the", "sufficient", "capacity", "of", "the", "hard", "drive", "of", "the", "infected", "system", "as", "well", "as", "the", "presence", "of", "Virtual", "Box", "artefacts", "."], ["The", "payload", "also", "checks", "the", "registry", "for", "the", "history", "of", "USB", "devices", "added", "to", "the", "system", "."], ["If", "no", "USB", "devices", "are", "detected", ",", "the", "payload", "will", "simply", "exit", "without", "connecting", "to", "the", "C2", "server", "."], ["A", "similar", "check", "runs", "for", "the", "recently", "opened", "files", "."], ["The", "malware", "will", "continue", "with", "execution", "unless", "there", "are", "at", "least", "two", "recently", "opened", "files", "."], ["The", "objective", "of", "most", "of", "the", "fully", "functioning", "payloads", "is", "to", "launch", "a", "reverse", "shell", "to", "connect", "to", "an", "attacker", "controlled", "C2", "server", "."], ["The", "attackers", "are", "experimenting", "with", "Metasploit", "payloads", "but", "in", "the", "payloads", "dropped", "by", "the", "Sduser", "malicious", "documents", "a", "simple", "redirection", "of", "cmd.exe", "standard", "input", "and", "output", "to", "a", "socket", "connected", "to", "an", "attacker", "controlled", "host", "is", "used", "."], ["Some", "payloads", "also", "employ", "Telegram", "API", "and", "may", "use", "it", "to", "communicate", "with", "the", "attackers", "."], ["Setting", "C2", "channels", "and", "launching", "reverse", "shell", "in", "the", "Main", "function", "of", "WindowsSecurity", "."], ["However", ",", "in", "our", "testing", ",", "for", "all", "comparison", "methods", ",", "we", "decided", "to", "first", "extract", "the", "VBA", "code", "from", "the", "generated", "olevba", "JSON", "output", "."], ["As", "the", "compression", "algorithm", "we", "used", "lzma", "and", "expressed", "NCD", "as", "the", "python", "code", "as", "a", "normalized", "ratio", "of", "lengths", "of", "compressed", "concatenated", "strings", "and", "lengths", "of", "standalone", "compressed", "strings", "."], ["Specifically", ",", "we", "used", "lexers", "for", "vb.net", "and", "vbscript", "and", "obtained", "similar", "results", "."]], "ner": [[[5, 6, "MF"], [9, 9, "MF"], [11, 11, "MF"], [18, 19, "MF"]], [[29, 29, "MP"], [32, 32, "MP"], [49, 50, "MF"], [56, 57, "MF"]], [[60, 60, "MP"], [63, 65, "MF"], [70, 71, "MF"]], [[96, 96, "MF"], [103, 105, "MF"], [114, 116, "MF"]], [[119, 119, "MP"], [136, 137, "MF"], [140, 141, "MF"], [147, 149, "TP"]], [[156, 158, "MP"], [166, 167, "MF"], [178, 178, "MF"]], [[185, 186, "MF"], [190, 192, "MP"]], [[203, 205, "MP"], [207, 209, "MP"]], [[233, 234, "MP"]], [[246, 246, "MP"], [250, 251, "MF"], [254, 256, "MF"]], [[261, 263, "MF"]], [[266, 266, "MF"], [270, 270, "MP"], [277, 280, "MF"]], [[299, 299, "MF"], [302, 302, "MP"]], [[336, 338, "MP"], [343, 344, "MP"]], [], [[375, 375, "MP"], [380, 380, "MP"]], [[382, 382, "MP"], [384, 385, "MP"], [391, 391, "MF"]], [[397, 397, "MP"], [399, 399, "MP"], [403, 403, "MP"], [406, 406, "MP"], [412, 412, "SF"], [429, 429, "SF"]], [[432, 432, "MP"], [436, 436, "SF"]], [[456, 456, "MP"], [464, 465, "SO"]], [[469, 469, "MP"], [474, 475, "MF"]], [[478, 478, "MP"], [490, 491, "MF"]], [[501, 501, "MP"], [507, 507, "TP"], [514, 515, "SO"]], [[518, 518, "MP"], [522, 523, "MP"], [536, 536, "MP"], [551, 551, "SO"]], [[556, 556, "MP"], [559, 560, "TP"], [569, 569, "MP"]], [[572, 573, "MP"], [577, 577, "MP"], [583, 583, "MP"]], [[602, 603, "MF"], [607, 609, "MF"]], [[617, 617, "MP"], [620, 620, "MP"]], [[646, 646, "MP"], [648, 648, "MF"], [650, 650, "MF"]]], "relations": [[[5, 6, 11, 11, "CO"], [5, 6, 9, 9, "CO"]], [[29, 29, 18, 19, "WR"], [29, 29, 32, 32, "FR"], [32, 32, 49, 50, "WR"], [32, 32, 56, 57, "WR"], [29, 29, 96, 96, "RD"], [29, 29, 103, 105, "WR"], [29, 29, 114, 116, "WR"], [29, 29, 119, 119, "FR"]], [[60, 60, 63, 65, "WR"], [60, 60, 70, 71, "WR"]], [], [[119, 119, 70, 71, "WR"], [119, 119, 147, 149, "FR"], [147, 149, 136, 137, "RD"], [147, 149, 140, 141, "WR"]], [[156, 158, 166, 167, "WR"], [156, 158, 178, 178, "WR"]], [[190, 192, 178, 178, "WR"], [190, 192, 185, 186, "WR"]], [[203, 205, 185, 186, "RD"], [203, 205, 261, 263, "WR"], [207, 209, 261, 263, "WR"], [207, 209, 190, 192, "CO"]], [[233, 234, 185, 186, "RD"], [233, 234, 261, 263, "WR"]], [[246, 246, 250, 251, "RD"], [246, 246, 254, 256, "WR"], [246, 246, 261, 263, "WR"]], [], [[270, 270, 261, 263, "WR"], [270, 270, 266, 266, "WR"], [270, 270, 277, 280, "RD"]], [[302, 302, 299, 299, "WR"], [302, 302, 299, 299, "EX"]], [[343, 344, 336, 338, "FR"]], [], [[380, 380, 375, 375, "FR"]], [[382, 382, 391, 391, "RD"], [384, 385, 391, 391, "RD"]], [[397, 397, 399, 399, "FR"], [399, 399, 403, 403, "FR"], [403, 403, 406, 406, "FR"], [406, 406, 412, 412, "RD"], [406, 406, 429, 429, "RD"], [406, 406, 464, 465, "ST"], [406, 406, 464, 465, "RF"], [397, 397, 432, 432, "CO"], [397, 397, 456, 456, "CO"], [406, 406, 469, 469, "CO"]], [[432, 432, 436, 436, "RD"]], [], [[469, 469, 474, 475, "RD"]], [[478, 478, 464, 465, "ST"], [478, 478, 464, 465, "RF"], [478, 478, 474, 475, "RD"], [478, 478, 490, 491, "WR"], [478, 478, 490, 491, "WR"]], [[501, 501, 490, 491, "WR"], [501, 501, 507, 507, "FR"], [507, 507, 514, 515, "ST"], [507, 507, 514, 515, "RF"]], [[518, 518, 522, 523, "FR"], [522, 523, 536, 536, "FR"], [536, 536, 551, 551, "ST"], [536, 536, 551, 551, "RF"]], [[556, 556, 559, 560, "FR"], [559, 560, 569, 569, "FR"], [569, 569, 602, 603, "WR"]], [[583, 583, 572, 573, "FR"], [583, 583, 577, 577, "FR"], [583, 583, 602, 603, "WR"], [583, 583, 607, 609, "WR"]], [], [[617, 617, 602, 603, "WR"], [617, 617, 607, 609, "WR"], [617, 617, 607, 609, "WR"], [620, 620, 607, 609, "WR"]], [[646, 646, 577, 577, "UK"], [646, 646, 648, 648, "RD"], [646, 646, 650, 650, "RD"]]]}