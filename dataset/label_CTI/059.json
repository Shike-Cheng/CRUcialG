{"doc_key": "059", "sentences": [["For", "Word", ",", "the", "add-ins", "need", "to", "be", "dropped", "in", "a", "specific", "location", "specified", "by", "the", "registry", "value", "HKCU\\Software\\Microsoft\\Office\\16", "."], ["If", "an", "attacker", "is", "able", "to", "place", "a", "DLL", "into", "a", "trusted", "location", "using", "the", "filename", "extension", ".wll", ",", "Word", "will", "attempt", "to", "load", "the", "DLL", "into", "its", "own", "process", "space", "."], ["If", "the", "user", "attempts", "to", "open", "a", "file", "with", "the", "filename", "extension", "."], ["XLL", "in", "Windows", "Explorer", ",", "the", "shell", "will", "automatically", "attempt", "to", "launch", "Excel", "to", "open", "the", "."], ["Before", "an", "XLL", "file", "is", "loaded", ",", "Excel", "displays", "a", "warning", "about", "the", "possibility", "of", "malicious", "code", "being", "included", "."], ["Excel", "warning", "about", "a", "potential", "risk", "of", "opening", "an", "XLL", "fileXLL", "files", "can", "be", "sent", "by", "email", ",", "and", "even", "with", "the", "usual", "anti-malware", "scanning", "measures", ",", "users", "may", "be", "able", "to", "open", "them", "not", "knowing", "that", "they", "may", "contain", "malicious", "code", "."], ["In", "order", "to", "automatically", "launch", "code", ",", "malicious", "actors", "using", "Office", "documents", "would", "implement", "one", "or", "more", "event", "handling", "functions", "such", "as", "AutoOpen", ",", "AutoClose", ",", "Document_Open", "and", "Document_Close", "for", "Word", "or", "Worbook_Open", ",", "Workbook_Close", ",", "Auto_Open", ",", "Auto_Close", "for", "Excel", "."], ["Those", "functions", "would", "be", "called", "when", "a", "document", "is", "opened", ",", "closed", "or", "when", "the", "Office", "application", "fired", "an", "event", "handled", "by", "one", "of", "the", "implemented", "functions", "."], ["Using", "auto", "start", "functions", ",", "the", "attackers", "are", "able", "to", "launch", "their", "malicious", "macro", "code", "."], ["The", "intent", "of", "this", "research", "is", "to", "show", "whether", "attackers", "have", "transitioned", "from", "using", "malicious", "VBA", "macros", "to", "using", "XLLs", "as", "the", "infection", "vector", ",", "specifically", "after", "Microsoft", "'", "s", "announcement", "about", "blocking", "VBA", "macros", "."], ["The", "difference", "between", "a", "regular", "DLL", "and", "an", "XLL", "file", "is", "that", "XLLs", "can", "implement", "certain", "exported", "functions", "which", "will", "be", "called", "by", "the", "Excel", "Add-In", "manager", "during", "some", "events", "triggered", "by", "the", "Excel", "application", "."], ["In", "order", "for", "an", "XLL", "add-in", "to", "be", "successfully", "loaded", "by", "the", "add-in", "manager", ",", "the", "XLL", "has", "to", "implement", "at", "least", "one", "exported", "function", ",", "called", "xlAutoOpen", ",", "in", "order", "for", "the", "add-in", "code", "to", "be", "called", "when", "the", "add-in", "is", "loaded", "by", "Excel", "."], ["XLL", "exports", "and", "the", "events", "when", "they", "are", "calledThe", "Excel", "XLL", "SDK", "consists", "of", "C/C++", "header", "files", "and", "libraries", "that", "allow", "XLL", "files", "to", "utilize", "the", "Excel", "API", "to", "access", "workbooks", "data", "and", "call", "Excel", "functions", "."], ["Most", "of", "the", "observed", "XLL", "malware", "samples", "are", "not", "created", "with", "the", "functionality", "to", "access", "Excel", "API", "but", "rather", "to", "execute", "its", "malicious", "code", "when", "the", "Excel", "Add-In", "manager", "calls", "xlAutoOpen", "or", "xlAutoClose", "functions", "."], ["An", "XLL", "file", "written", "in", "a", "."], ["NET", "language", "is", "compiled", "in", "a", "standalone", "file", "containing", "shim", "functions", "which", "map", "native", "exports", "to", "the", "CLR", "functions", "contained", "in", "a", "user-defined", "assembly", "DLL", "embedded", "in", "the", "resource", "section", "of", "the", "file", "generated", "by", "Excel-DNA", "."], ["An", "Excel-DNA", "example", ":", "8KWKF", "is", "a", "user-defined", "."], ["NET", "assembly", "embedded", "within", "the", "resource", "sectionTogether", "with", "the", "user-defined", "assembly", "DLL", ",", "the", "resource", "section", "of", "the", "Excel-DNA", "generated", "add-in", "may", "contain", "a", "number", "of", "DLLs", "used", "to", "translate", "the", "native", "function", "calls", "into", "."], ["NET", "function", "calls", "and", "vice-versa", "."], ["For", "example", ",", "the", "EXCELDNA", "."], ["LOADER", "assembly", "is", "tasked", "with", "loading", "the", "."], ["NET", "framework", "and", "connecting", "it", "with", "the", "user-defined", "DLL", "."], ["Excel-DNA", "requires", "the", "developer", "to", "instantiate", "an", "interface", "IExcelAddIn", "which", "will", "be", "called", "by", "the", "Excel-DNA", "loader", "."], ["The", "developer", "may", "then", "implement", "a", "class", "that", "will", "inherit", "from", "IExcelAddIn", "and", "define", "functions", "to", "overload", "the", "default", "implementations", "of", "functions", "that", "map", "to", "the", "functions", "automatically", "called", "by", "Excel", "."], ["For", "example", ",", "xlAutoOpen", "function", "is", "mapped", "to", "IExcelAddIn", "."], ["Evolution", "of", "malicious", "XLLsHunting", "for", "XLLs", "in", "VirusTotalArmed", "with", "the", "knowledge", "of", "what", "XLL", "files", "are", ",", "it", "will", "not", "be", "very", "difficult", "to", "search", "for", "the", "malicious", "files", "using", "the", "VirusTotal", "interface", "as", "well", "as", "internal", "sample", "repositories", "."], ["On", "VirusTotal", ",", "the", "basic", "way", "to", "search", "for", "malicious", "native", "XLL", "files", "submitted", "for", "the", "first", "time", ",", "for", "example", ",", "in", "November", "is", ":", "exports", ":", "xlAutoOpen", "positives:5+", "fs:2022-11-01+Perhaps", "also", "including", "XLLs", "that", "implement", "xlAutoClose", ":", "exports", ":", "xlAutoClose", "positives", "5+", "fs:2022-11-01+For", "Excel-DNA", "files", ",", "the", "situation", "is", "somewhat", "different", "."], ["Because", "an", "Excel-DNA", "compiled", "file", "is", "a", "shim", ",", "it", "contains", "over", "10,000", "exports", "."], ["This", "means", "that", "the", "standard", "search", "for", "xlAutoOpen", "export", "will", "not", "yield", "any", "Excel-DNA", "files", "in", "the", "search", "result", "."], ["DLLand", "pe.exports", "(", "``", "CalculationCanceled", "''", ")", "and", "pe.exports", "(", "``", "SyncMacro", "''", ")", "and", "new_fileand", "positives", ">", "3", "}", "for", "Excel-DNA", "based", "malicious", "XLLs", "."], ["Monthly", "submissions", "of", "Excel-DNA", "compiled", "malicious", "XLL", "files", "from", "Jan", "2021", "."], ["Our", "search", "on", "VirusTotal", "has", "shown", "that", "malicious", "actors", "were", "well", "aware", "of", "the", "existence", "of", "XLL", "files", "and", "were", "using", "them", "way", "before", "Microsoft", "decided", "to", "start", "blocking", "documents", "containing", "VBA", "macros", "."], ["In", "July", "2017", ",", "a", "test", "sample", "with", "SHA256", "09271afc6f7ac254b4942a14559a0015fb4893d9bb478844ced2f78c0695929e", ",", "used", "to", "launch", "calc.exe", ",", "was", "submitted", "."], ["The", "sample", "a5d46912f0767ae30bc169a85c5bcb309d93c3802a2e32e04165fa25740afac1", "was", "submitted", "to", "VirusTotal", "in", "December", "2017", "and", "it", "contains", "functionality", "to", "inject", "the", "Backdoor", "Anel", "payload", "into", "the", "process", "space", "of", "svchost.exe", "."], ["One", "of", "the", "components", "in", "the", "attack", ",", "a", "process", "injection", "DLL", "named", "onkeytoken_keb.dll", "(", "9dd2425c1a40b8899b2a4ac0a85b047bede642c5dfd3b5a2a2f066a853b49e2d", ")", ",", "also", "contains", "an", "xlAutoOpen", "export", ",", "although", "no", "malicious", "functionality", "is", "executed", "when", "calling", "it", "(", "the", "injector", "is", "triggered", "by", "calling", "the", "exported", "function", "OnKeyT_ContextInit", ")", "."], ["On", "October", "7th", "2022", ",", "a", "DLL", "d8286133d3d21b7e2b83a6c071147b8ef993e963ad6bdb0f95d665869557a444", ",", "with", "the", "name", "1.", "xll", ",", "was", "uploaded", "from", "a", "user", "in", "Pakistan", "."], ["The", "DLL", "contains", "two", "exports", "."], ["The", "second", "export", "name", "is", "xlAutoOpen", ",", "which", "makes", "the", "implant", "a", "fully", "functional", ",", "native-based", "XLL", "payload", "."], ["FIN7", "is", "using", "a", "number", "of", "payloads", "and", "different", "infection", "techniques", ",", "including", "."], ["FIN7", "most", "commonly", "uses", "Carbanak", "malware", "."], ["Earlier", "this", "year", ",", "FIN7", "started", "using", "XLLs", "sent", "as", "attachments", "in", "malicious", "email", "campaigns", "."], ["For", "example", ",", "the", "XLL", "file", "from", "a", "February", "campaign", "was", "7a234d1a2415834290a3a9c7274aadb7253dcfe24edb10b22f1a4a33fd027a08.named", "``", "Quickbooks", "-", "40127.", "xll", "''", "."], ["The", "file", "serves", "as", "a", "downloader", "for", "the", "next", "stage", "."], ["The", "FIN7", "XLL", "downloaders", "are", "interesting", "as", "they", "appear", "to", "have", "been", "created", "with", "the", "Excel-DNA", "."], ["Modified", "FIN7", "Excel-DNA", "shim", "downloader", "connects", "to", "an", "attacker", "controlled", "hostCommodity", "malware", "familiesDridex", "downloaderDridex", "downloaders", ",", "such", "as", "f2c5327b7bf88c65d0552d8664aca2ac542c8d37ae19582ba56690f1df420b53", ",", "are", "responsible", "for", "the", "major", "peak", "in", "the", "number", "of", "XLL", "files", "submitted", "to", "VirusTotal", "in", "late", "2021", "."], ["The", "XLL", "Formbook", "downloader", ",", "55228eec31193a900e8216ab245391f1e40feb742d780caa91fdb1000d8434c2", ",", "arrives", "in", "an", "email", "masquerading", "as", "an", "invoice", "sent", "from", "a", "company", "to", "the", "user", "."], ["When", "the", "user", "opens", "the", "attached", "XLL", "file", ",", "the", "malicious", "downloader", "is", "launched", "."], ["The", "downloader", "is", "rather", "simple", "and", "it", "enumerates", "the", "resource", "section", "of", "the", "file", "in", "a", "search", "for", "a", "specific", "string", "resource", "which", "contains", "the", "URL", "of", "the", "FormBook", "payload", "."], ["FormBook", "finds", "the", "resource", "``", "f", "''", "which", "contains", "the", "payload", "URLOther", "notable", "commodity", "malware", "families", "that", "use", "XLLs", "as", "the", "infection", "vector", "and", "are", "not", "specifically", "described", "in", "this", "post", "include", "AgentTesla", ",", "Ransomware", "Stop", ",", "Vidar", ",", "Buer", "Loader", ",", "Nanocore", ",", "IceID", ",", "Arkei", ",", "AsyncRat", ",", "BazarLoader", "and", "others", "."], ["NET", "based", "XLL", "file", ",", "f5c27b7bdea3861a9414a0dc6b08556ea50423d63297e08eedff69ae9c240cae", ",", "that", "downloads", "the", "payload", "from", "the", "URL", "hxxp", ":", "//172.245.120.8/pdfreader.exe", "."], ["At", "the", "time", "of", "analysis", ",", "the", "URL", "hosted", "the", "Warzone", "payload", "90205826eb40d5d4b454c2cfde44abe49f6c3b471681c700e30b45eb5078eee2", ",", "and", "later", "hosted", "samples", "of", "AgentTesla", "and", "Lokibot", "."], ["Ducktail", "attempts", "to", "steal", "browser", "stored", "credentials", "and", "cookies", "with", "the", "specific", "intent", "to", "steal", "the", "details", "of", "Facebook", "friends", "and", "business", "contacts", "."], ["The", "threat", "actor", "uses", "their", "gained", "access", "to", "run", "ads", "for", "monetary", "gain", "."], ["The", "second", "stage", "of", "the", "Ducktail", "downloader", "is", "stored", "as", "AES", "encrypted", "Base32", "encoded", "blobThe", "Ducktail", "stealer", "payload", "is", "shared", "using", "large", "(", "over", "100", "MB", ")", "compressed", "archives", "containing", "a", "number", "of", "legitimate", "resources", "as", "well", "as", "malicious", "files", "."], ["The", "Base32", "encoded", "blob", "is", "decoded", "and", "loaded", "using", "reflectionThe", "file", "is", "created", "using", "Excel-DNA", "and", "contains", "a", "Base32", "encoded", "and", "encrypted", "data", "blob", "which", "gets", "loaded", "into", "the", "process", "space", "of", "Explorer", "using", "reflection", "."], ["Once", "decoded", ",", "the", "function", "Timer", "is", "called", ",", "which", "drops", "and", "opens", "a", "legitimate", "Excel", "workbook", "containing", "fake", "results", "of", "online", "advertising", "campaigns", "."], ["The", "endpoint", "then", "downloads", "and", "runs", "the", "Ducktail", "stealer", "payload", "from", "a", "publicly", "accessible", "Discord", "URL", "."], ["The", "downloader", "drops", "a", "lure", "Excel", "workbook", "and", "downloads", "the", "Ducktail", "payload", "from", "DiscordSummaryAs", "a", "result", "of", "Microsoft", "'", "s", "decision", "to", "prevent", "execution", "of", "VBA", "macro", "code", "contained", "in", "documents", "downloaded", "from", "the", "Internet", ",", "we", "will", "likely", "see", "a", "gradual", "decline", "in", "the", "number", "of", "newly", "discovered", "malicious", "documents", "."], ["Koobick-9980511-0Orbital", "QueriesCisco", "Secure", "Endpoint", "users", "can", "use", "Orbital", "Advanced", "Search", "to", "run", "complex", "OSqueries", "to", "see", "if", "their", "endpoints", "are", "infected", "with", "this", "specific", "threat", "."]], "ner": [[[1, 1, "TP"], [4, 4, "MF"], [18, 18, "SF"]], [[22, 22, "MP"], [28, 28, "MF"], [39, 39, "TP"], [45, 45, "MF"]], [], [[65, 65, "MF"], [71, 71, "TP"], [77, 77, "TP"]], [[84, 85, "MF"], [89, 89, "TP"]], [[102, 102, "TP"], [111, 111, "MF"], [118, 118, "SO"], [129, 129, "TP"]], [[153, 153, "MP"], [155, 156, "MF"]], [[194, 194, "MF"], [202, 203, "TP"]], [[221, 221, "MP"], [229, 229, "MF"]], [[246, 247, "MF"], [250, 250, "MF"]], [[272, 272, "MF"], [275, 276, "MF"], [279, 279, "MF"], [291, 293, "TP"], [300, 300, "TP"]], [[307, 308, "MF"], [315, 316, "TP"], [319, 319, "MF"], [343, 343, "MF"], [347, 347, "TP"]], [[359, 359, "MF"], [370, 371, "MF"]], [[390, 392, "MF"]], [], [], [], [], [], [], [], [], [], [], [], [], [[684, 685, "MF"]], [], [], [], [[760, 761, "MF"]], [[774, 774, "MP"], [782, 783, "MF"]], [[809, 809, "MF"]], [[821, 821, "MF"], [830, 830, "MP"], [844, 844, "TP"]], [[857, 857, "MF"], [859, 859, "MF"], [861, 861, "MF"]], [[898, 898, "MF"], [899, 899, "MF"], [904, 905, "MF"]], [[916, 916, "MF"]], [], [], [[958, 959, "MF"]], [[965, 965, "MP"], [968, 968, "MF"]], [[981, 982, "MF"], [988, 988, "MF"], [990, 993, "MF"]], [[997, 997, "MF"]], [[1008, 1010, "MF"]], [[1034, 1034, "SO"], [1036, 1038, "MF"], [1042, 1042, "MF"]], [[1064, 1066, "MF"], [1068, 1068, "MF"]], [[1088, 1088, "TP"], [1092, 1093, "MF"], [1097, 1097, "MP"]], [[1102, 1102, "MP"], [1107, 1107, "MP"], [1122, 1122, "SF"]], [[1132, 1132, "MP"], [1137, 1137, "MF"], [1164, 1164, "MF"], [1166, 1167, "MF"], [1169, 1169, "MF"], [1171, 1172, "MF"], [1174, 1174, "MF"], [1176, 1176, "MF"], [1178, 1178, "MF"], [1180, 1180, "MF"], [1182, 1182, "MF"]], [[1186, 1186, "MP"], [1188, 1189, "MF"], [1191, 1191, "MF"], [1196, 1196, "MF"], [1200, 1202, "SO"]], [[1214, 1214, "MF"], [1216, 1216, "MF"], [1223, 1223, "MF"], [1225, 1225, "MF"]], [[1227, 1227, "MP"], [1231, 1231, "SF"], [1245, 1245, "SF"]], [], [[1270, 1271, "MP"], [1279, 1279, "MF"]], [[1309, 1309, "MP"]], [[1357, 1358, "MF"]], [[1368, 1368, "MP"], [1374, 1376, "MF"], [1381, 1382, "SO"]], [[1385, 1385, "MP"], [1389, 1390, "MF"], [1394, 1395, "MF"]], []], "relations": [[[1, 1, 4, 4, "WR"], [1, 1, 4, 4, "WR"], [1, 1, 18, 18, "RD"], [1, 1, 18, 18, "RD"], [1, 1, 18, 18, "WR"]], [[22, 22, 4, 4, "WR"], [22, 22, 18, 18, "RD"], [22, 22, 18, 18, "RD"], [22, 22, 18, 18, "WR"], [22, 22, 28, 28, "WR"], [39, 39, 45, 45, "EX"], [28, 28, 45, 45, "CO"], [22, 22, 774, 774, "CO"]], [], [[71, 71, 77, 77, "FR"], [77, 77, 65, 65, "EX"], [65, 65, 84, 85, "CO"], [77, 77, 89, 89, "CO"], [77, 77, 102, 102, "CO"]], [], [[129, 129, 111, 111, "WR"], [129, 129, 118, 118, "ST"], [129, 129, 118, 118, "RF"], [129, 129, 153, 153, "FR"], [129, 129, 1088, 1088, "CO"]], [[153, 153, 202, 203, "FR"], [155, 156, 194, 194, "CO"], [155, 156, 229, 229, "CO"]], [[202, 203, 155, 156, "WR"], [202, 203, 221, 221, "FR"]], [[221, 221, 229, 229, "EX"], [221, 221, 246, 247, "WR"], [221, 221, 250, 250, "WR"], [221, 221, 272, 272, "WR"]], [[250, 250, 279, 279, "CO"]], [[291, 293, 246, 247, "WR"], [291, 293, 272, 272, "WR"], [291, 293, 279, 279, "EX"], [291, 293, 300, 300, "CO"]], [[315, 316, 307, 308, "EX"], [315, 316, 684, 685, "WR"], [315, 316, 760, 761, "WR"], [319, 319, 343, 343, "CO"], [319, 319, 307, 308, "CO"], [319, 319, 370, 371, "CO"], [319, 319, 359, 359, "CO"], [319, 319, 390, 392, "CO"], [315, 316, 347, 347, "CO"]], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [[774, 774, 684, 685, "WR"], [774, 774, 760, 761, "WR"], [774, 774, 760, 761, "WR"], [774, 774, 782, 783, "WR"], [774, 774, 782, 783, "WR"], [774, 774, 809, 809, "WR"]], [], [[830, 830, 782, 783, "WR"], [830, 830, 809, 809, "WR"], [830, 830, 821, 821, "EX"], [830, 830, 844, 844, "IJ"], [844, 844, 916, 916, "RD"], [844, 844, 916, 916, "WR"], [844, 844, 916, 916, "EX"], [844, 844, 958, 959, "RD"], [844, 844, 958, 959, "WR"], [844, 844, 958, 959, "EX"]], [[857, 857, 859, 859, "CO"], [857, 857, 861, 861, "CO"]], [[898, 898, 904, 905, "CO"], [898, 898, 899, 899, "CO"]], [], [], [], [], [[965, 965, 916, 916, "WR"], [965, 965, 958, 959, "WR"], [965, 965, 958, 959, "WR"], [965, 965, 1034, 1034, "ST"], [965, 965, 1034, 1034, "RF"], [965, 965, 1034, 1034, "ST"], [965, 965, 1034, 1034, "RF"], [968, 968, 990, 993, "CO"], [968, 968, 981, 982, "CO"], [968, 968, 988, 988, "CO"], [968, 968, 997, 997, "CO"], [968, 968, 1008, 1010, "CO"]], [], [], [], [[1036, 1038, 1042, 1042, "CO"]], [[1064, 1066, 1068, 1068, "CO"], [1064, 1066, 1092, 1093, "CO"]], [[1088, 1088, 1034, 1034, "ST"], [1088, 1088, 1034, 1034, "RF"], [1088, 1088, 1097, 1097, "FR"], [1097, 1097, 1092, 1093, "EX"], [1097, 1097, 1164, 1164, "WR"], [1097, 1097, 1166, 1167, "WR"], [1097, 1097, 1169, 1169, "WR"], [1097, 1097, 1171, 1172, "WR"], [1097, 1097, 1174, 1174, "WR"], [1097, 1097, 1176, 1176, "WR"], [1097, 1097, 1178, 1178, "WR"], [1097, 1097, 1180, 1180, "WR"], [1097, 1097, 1182, 1182, "WR"], [1097, 1097, 1107, 1107, "CO"], [1097, 1097, 1102, 1102, "CO"], [1097, 1097, 1132, 1132, "CO"]], [[1107, 1107, 1122, 1122, "RD"]], [[1132, 1132, 1137, 1137, "RD"]], [[1186, 1186, 1164, 1164, "WR"], [1186, 1186, 1166, 1167, "WR"], [1186, 1186, 1169, 1169, "WR"], [1186, 1186, 1171, 1172, "WR"], [1186, 1186, 1174, 1174, "WR"], [1186, 1186, 1176, 1176, "WR"], [1186, 1186, 1178, 1178, "WR"], [1186, 1186, 1180, 1180, "WR"], [1186, 1186, 1182, 1182, "WR"], [1186, 1186, 1188, 1189, "EX"], [1186, 1186, 1196, 1196, "WR"], [1186, 1186, 1200, 1202, "ST"], [1186, 1186, 1200, 1202, "RF"], [1186, 1186, 1223, 1223, "WR"], [1186, 1186, 1225, 1225, "WR"], [1188, 1189, 1191, 1191, "CO"]], [[1214, 1214, 1216, 1216, "CO"]], [[1227, 1227, 1223, 1223, "WR"], [1227, 1227, 1225, 1225, "WR"], [1227, 1227, 1231, 1231, "RD"], [1227, 1227, 1245, 1245, "RD"], [1227, 1227, 1270, 1271, "CO"]], [], [[1270, 1271, 1279, 1279, "WR"], [1270, 1271, 1309, 1309, "FR"]], [[1309, 1309, 1279, 1279, "EX"], [1309, 1309, 1357, 1358, "WR"]], [], [[1368, 1368, 1374, 1376, "WR"], [1368, 1368, 1374, 1376, "EX"], [1368, 1368, 1381, 1382, "ST"], [1368, 1368, 1381, 1382, "RF"], [1368, 1368, 1385, 1385, "CO"]], [[1385, 1385, 1389, 1390, "WR"], [1385, 1385, 1394, 1395, "WR"]], []]}